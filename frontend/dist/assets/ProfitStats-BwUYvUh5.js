var t=Object.defineProperty,e=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(e,a,s)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,n=(t,n)=>{for(var o in n||(n={}))a.call(n,o)&&l(t,o,n[o]);if(e)for(var o of e(n))s.call(n,o)&&l(t,o,n[o]);return t},o=(t,e,a)=>new Promise(((s,l)=>{var n=t=>{try{c(a.next(t))}catch(e){l(e)}},o=t=>{try{c(a.throw(t))}catch(e){l(e)}},c=t=>t.done?s(t.value):Promise.resolve(t.value).then(n,o);c((a=a.apply(t,e)).next())}));import{r as c,_ as r,u as d,a as i,c as u,o as _,b as p,d as v,e as f,w as b,f as y,n as m,t as h,v as x,g,h as k,i as w,j as D,S as C,F as z,k as $,l as S,m as I,T as L}from"./index-CXKZenoA.js";function q(t=""){const e=c(t),a=c(t),s=t=>t instanceof Date&&!isNaN(t)?t.toISOString().split("T")[0]:"",l=t=>t instanceof Date&&!isNaN(t);return{displayValue:a,handleInput:t=>{const s=t.target.value;return e.value=s,a.value=s,s},handleBlur:()=>{if(!e.value)return{isValid:!0,value:""};const t=e.value.trim();if(/^[a-zA-Z]+$/.test(t)){const e=new Date;switch(t.toLowerCase()){case"t":case"today":return a.value=s(e),{isValid:!0,value:a.value};case"y":case"yday":return e.setDate(e.getDate()-1),a.value=s(e),{isValid:!0,value:a.value};case"tm":case"tmr":return e.setDate(e.getDate()+1),a.value=s(e),{isValid:!0,value:a.value}}}if(/^[+-]\d+$/.test(t)){const e=parseInt(t),l=new Date;return l.setDate(l.getDate()+e),a.value=s(l),{isValid:!0,value:a.value}}if(/^\d{3,4}$/.test(t)){const e=(new Date).getFullYear();let n,o;if(3===t.length?(n=parseInt(t[0]),o=parseInt(t.slice(1))):(n=parseInt(t.slice(0,2)),o=parseInt(t.slice(2))),n>=1&&n<=12&&o>=1&&o<=31){const t=new Date(e,n-1,o);if(l(t))return a.value=s(t),{isValid:!0,value:a.value}}}const n=["-",".","/"];for(const e of n)if(t.includes(e)){const[n,o]=t.split(e).map(Number),c=(new Date).getFullYear();if(n>=1&&n<=12&&o>=1&&o<=31){const t=new Date(c,n-1,o);if(l(t))return a.value=s(t),{isValid:!0,value:a.value}}}const o=new Date(t);return l(o)?(a.value=s(o),{isValid:!0,value:a.value}):{isValid:!1,value:e.value}},setToday:()=>{const t=(new Date).toISOString().split("T")[0];return e.value=t,a.value=t,t}}}const N={class:"card"},O={class:"card-header d-flex justify-content-between align-items-center"},j={class:"btn-group"},V=["disabled"],Y={class:"card-body border-bottom"},F={class:"col-auto"},E=["value"],M={class:"col-auto"},T=["value"],H={class:"col-auto"},K={class:"col-auto",style:{"min-width":"200px","max-width":"300px"}},P={class:"col-auto d-flex align-items-end",style:{"min-width":"80px"}},A=["disabled"],B={class:"card-body p-0"},U={class:"table-responsive"},Z={class:"table table-hover table-sm mb-0"},W={class:"market-row"},G=["onClick"],J={class:"text-end"},Q={class:"text-end"},R={class:"text-end text-danger"},X={class:"text-end text-success"},tt={class:"text-end"},et={key:0,class:"holding-stats-row"},at={class:"text-end"},st={class:"text-end text-danger"},lt={class:"text-end text-success"},nt={class:"text-end"},ot={key:1,class:"closed-stats-row"},ct={class:"text-end"},rt={class:"text-end text-danger"},dt={class:"text-end text-success"},it={class:"text-end"},ut={class:"holding-group-row"},_t=["onClick"],pt={class:"stock-row"},vt=["onClick"],ft={class:"company-name",style:{display:"inline-block","font-size":"14px",color:"#6c757d","margin-left":"4px"}},bt={class:"text-end"},yt={class:"text-end"},mt={class:"text-end text-danger"},ht={class:"text-end"},xt={class:"text-end text-success"},gt={class:"text-end"},kt={class:"text-end"},wt={key:0},Dt={colspan:"13",class:"p-0"},Ct={class:"transaction-details"},zt={class:"table table-sm mb-0"},$t={class:"transaction-info"},St={class:"transaction-code"},It={class:"quantity-price"},Lt={class:"text-end amount"},qt={class:"text-end cost"},Nt={class:"text-end amount"},Ot={class:"text-end fees"},jt={class:"text-end"},Vt={key:1},Yt={class:"closed-group-row"},Ft=["onClick"],Et={class:"stock-row"},Mt=["onClick"],Tt={class:"company-name",style:{display:"inline-block","font-size":"14px",color:"#6c757d","margin-left":"4px"}},Ht={class:"text-end"},Kt={class:"text-end"},Pt={class:"text-end text-danger"},At={class:"text-end text-success"},Bt={class:"text-end"},Ut={class:"text-end"},Zt={key:0},Wt={colspan:"13",class:"p-0"},Gt={class:"transaction-details"},Jt={class:"table table-sm mb-0"},Qt={class:"transaction-info"},Rt={class:"transaction-code"},Xt={class:"quantity-price"},te={class:"text-end amount"},ee={class:"text-end cost"},ae={class:"text-end amount"},se={class:"text-end fees"},le={class:"text-end"},ne={key:1},oe=r({__name:"ProfitStats",setup(t){const e=d(),a=c(!1),s=c(!1),l=c(!0),r=c(new Set),oe=c(new Set),ce=c(new Set),re=c(new Set),de=c({}),ie=c({}),ue=c({}),_e=c([]),pe=i({startDate:"",endDate:"",market:"",stockCodes:[]}),ve=c(null),fe=c(null),be=c(null),ye=(t,e)=>{var a,s;switch(t.preventDefault(),e){case"endDate":null==(a=fe.value)||a.focus();break;case"market":null==(s=be.value)||s.focus();break;case"search":je()}},me={calculateMarketStats:(t,e=[])=>{const a={};return Object.entries(t).forEach((([t,s])=>{const[l]=t.split("-"),n=t.split("-")[1];e.length>0&&!e.includes(n)||(a[l]||(a[l]={total_stocks:0,transaction_count:0,total_buy:0,total_sell:0,total_fees:0,realized_profit:0,market_value:0,holding_profit:0,total_profit:0,profit_rate:0,holding_stats:{count:0,total_buy:0,total_sell:0,total_fees:0,realized_profit:0,market_value:0,holding_profit:0,total_profit:0,profit_rate:0},closed_stats:{count:0,total_buy:0,total_sell:0,total_fees:0,realized_profit:0,profit_rate:0}}),a[l].transaction_count+=s.transaction_count||0,a[l].total_buy+=s.total_buy||0,a[l].total_sell+=s.total_sell||0,a[l].total_fees+=s.total_fees||0,a[l].realized_profit+=s.realized_profit||0,a[l].market_value+=s.market_value||0,a[l].holding_profit+=s.holding_profit||0,s.current_quantity>0?(a[l].total_stocks+=1,a[l].holding_stats.count++,a[l].holding_stats.total_buy+=s.total_buy||0,a[l].holding_stats.total_sell+=s.total_sell||0,a[l].holding_stats.total_fees+=s.total_fees||0,a[l].holding_stats.realized_profit+=s.realized_profit||0,a[l].holding_stats.market_value+=s.market_value||0,a[l].holding_stats.holding_profit+=s.holding_profit||0):(a[l].total_stocks+=1,a[l].closed_stats.count++,a[l].closed_stats.total_buy+=s.total_buy||0,a[l].closed_stats.total_sell+=s.total_sell||0,a[l].closed_stats.total_fees+=s.total_fees||0,a[l].closed_stats.realized_profit+=s.realized_profit||0))})),Object.values(a).forEach((t=>{t.holding_stats.total_profit=(t.holding_stats.realized_profit||0)+(t.holding_stats.holding_profit||0),t.holding_stats.profit_rate=t.holding_stats.total_buy>0?(t.holding_stats.total_profit||0)/t.holding_stats.total_buy*100:0,t.closed_stats.profit_rate=t.closed_stats.total_buy>0?(t.closed_stats.realized_profit||0)/t.closed_stats.total_buy*100:0,t.total_profit=(t.realized_profit||0)+(t.holding_profit||0),t.profit_rate=t.total_buy>0?t.total_profit/t.total_buy*100:0})),a},getHoldingStocks:(t,e,a=[])=>Object.entries(t).filter((([t,s])=>{const[l]=t.split("-"),n=t.split("-")[1];return a.length>0?l===e&&s.current_quantity>0&&a.includes(n):l===e&&s.current_quantity>0})).map((([t,e])=>n({code:t.split("-")[1]},e))).sort(((t,e)=>{const a=new Date(t.last_transaction_date||0);return new Date(e.last_transaction_date||0)-a})),getClosedStocks:(t,e,a=[])=>Object.entries(t).filter((([t,s])=>{const[l]=t.split("-"),n=t.split("-")[1];return a.length>0?l===e&&s.current_quantity<=0&&a.includes(n):l===e&&s.current_quantity<=0})).map((([t,e])=>n({code:t.split("-")[1]},e))).sort(((t,e)=>{const a=new Date(t.last_transaction_date||0);return new Date(e.last_transaction_date||0)-a}))},he=u((()=>me.calculateMarketStats(ie.value,pe.stockCodes||[]))),xe=t=>me.getHoldingStocks(ie.value,t,pe.stockCodes||[]),ge=t=>me.getClosedStocks(ie.value,t,pe.stockCodes||[]),ke=u((()=>Object.keys(he.value).sort())),we=(t,e=2)=>null==t?"-":Number(t).toLocaleString("zh-HK",{minimumFractionDigits:e,maximumFractionDigits:e}),De=t=>null==t?"-":t.toFixed(2)+"%",Ce=t=>t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"):"-",ze=t=>t?t>0?"text-success":t<0?"text-danger":"":"",$e=t=>r.value.has(t),Se=t=>oe.value.has(t),Ie=t=>ce.value.has(t),Le=(t,e)=>{const a=`${t}-${e}`;return re.value.has(a)},qe=(t,e)=>{const a=`${t}-${e}`;re.value.has(a)?re.value.delete(a):re.value.add(a)},Ne=()=>{l.value=!l.value},Oe=t=>{const e=new L(Object.assign(document.createElement("div"),{className:"toast position-fixed top-0 end-0 m-3",innerHTML:`\n        <div class="toast-header">\n          <strong class="me-auto">提示</strong>\n          <button type="button" class="btn-close" data-bs-dismiss="toast"></button>\n        </div>\n        <div class="toast-body">${t}</div>\n      `}));document.body.appendChild(e._element),e.show(),setTimeout((()=>{e._element.remove()}),3e3)},je=()=>o(this,null,(function*(){var t;a.value=!0;try{const e={};pe.startDate&&(e.start_date=pe.startDate),pe.endDate&&(e.end_date=pe.endDate),pe.market&&(e.market=pe.market),(null==(t=pe.stockCodes)?void 0:t.length)>0&&(e.stock_codes=pe.stockCodes);const a=yield I.get("/api/profit/",{params:e});a.data.success&&(ie.value=a.data.data.stock_stats||{},ue.value=a.data.data.transaction_details||{},r.value.clear(),oe.value.clear(),ce.value.clear(),re.value.clear(),Object.keys(he.value).forEach((t=>{r.value.add(t),oe.value.add(t)})))}catch(e){Oe("查询失败，请稍后重试")}finally{a.value=!1}})),Ve=()=>{pe.startDate="",pe.endDate="",pe.market="",pe.stockCodes=[],je()},Ye=()=>o(this,null,(function*(){if(!s.value){s.value=!0;try{const t=yield I.post("/api/profit/refresh_prices");if(t.data.success){const{items:e,success_count:a,failed_count:s}=t.data.data;e.forEach((t=>{const e=`${t.market}-${t.code}`;ie.value[e]&&(ie.value[e].current_price=t.current_price,ie.value[e].market_value=t.market_value,ie.value[e].holding_profit=t.holding_profit,ie.value[e].total_profit=t.total_profit,ie.value[e].profit_rate=t.profit_rate)})),de.value=me.calculateMarketStats(ie.value,pe.stockCodes||[]),Oe(`市值更新完成：${a} 个成功，${s} 个失败`)}}catch(t){Oe("刷新市值失败，请稍后重试")}finally{s.value=!1}}})),Fe=()=>{e.push("/transactions/add")};q();const Ee=c(""),Me=c(""),Te=t=>{const e=t.target.value;Ee.value=e,pe.startDate=e},He=()=>{if(!Ee.value)return void(pe.startDate="");const t=Ee.value.trim();let e=null;if(/^[a-zA-Z]+$/.test(t)){const a=new Date;switch(t.toLowerCase()){case"t":case"today":e=Ce(a);break;case"y":case"yday":a.setDate(a.getDate()-1),e=Ce(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),e=Ce(a)}}if(/^[+-]\d+$/.test(t)){const a=parseInt(t),s=new Date;s.setDate(s.getDate()+a),e=Ce(s)}if(/^\d{3,4}$/.test(t)){const a=(new Date).getFullYear();let s,l;if(3===t.length?(s=parseInt(t[0]),l=parseInt(t.slice(1))):(s=parseInt(t.slice(0,2)),l=parseInt(t.slice(2))),s>=1&&s<=12&&l>=1&&l<=31){const t=new Date(a,s-1,l);Ae(t)&&(e=Ce(t))}}const a=["-",".","/"];for(const s of a)if(t.includes(s)){const[a,l]=t.split(s).map(Number),n=(new Date).getFullYear();if(a>=1&&a<=12&&l>=1&&l<=31){const t=new Date(n,a-1,l);if(Ae(t)){e=Ce(t);break}}}if(!e){const a=new Date(t);Ae(a)&&(e=Ce(a))}e&&(Ee.value=e,pe.startDate=e,pe.endDate&&e>pe.endDate&&(pe.endDate=e,Me.value=e))},Ke=t=>{const e=t.target.value;Me.value=e,pe.endDate=e},Pe=()=>{if(!Me.value)return void(pe.endDate="");const t=Me.value.trim();let e=null;if(/^[a-zA-Z]+$/.test(t)){const a=new Date;switch(t.toLowerCase()){case"t":case"today":e=Ce(a);break;case"y":case"yday":a.setDate(a.getDate()-1),e=Ce(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),e=Ce(a)}}if(/^[+-]\d+$/.test(t)){const a=parseInt(t),s=new Date;s.setDate(s.getDate()+a),e=Ce(s)}if(/^\d{3,4}$/.test(t)){const a=(new Date).getFullYear();let s,l;if(3===t.length?(s=parseInt(t[0]),l=parseInt(t.slice(1))):(s=parseInt(t.slice(0,2)),l=parseInt(t.slice(2))),s>=1&&s<=12&&l>=1&&l<=31){const t=new Date(a,s-1,l);Ae(t)&&(e=Ce(t))}}const a=["-",".","/"];for(const s of a)if(t.includes(s)){const[a,l]=t.split(s).map(Number),n=(new Date).getFullYear();if(a>=1&&a<=12&&l>=1&&l<=31){const t=new Date(n,a-1,l);if(Ae(t)){e=Ce(t);break}}}if(!e){const a=new Date(t);Ae(a)&&(e=Ce(a))}e&&(Me.value=e,pe.endDate=e,pe.startDate&&e<pe.startDate&&(pe.startDate=e,Ee.value=e))},Ae=t=>t instanceof Date&&!isNaN(t),Be=t=>{if("sell"!==t.transaction_type.toLowerCase())return 0;const e=Number(t.total_amount),a=Number(t.total_quantity)*Number(t.prev_avg_cost),s=Number(t.total_fees);return Number((e-a-s).toFixed(2))},Ue=t=>{if("sell"!==t.transaction_type.toLowerCase())return 0;const e=Be(t),a=Number(t.total_quantity)*Number(t.prev_avg_cost);return a>0?Number((e/a*100).toFixed(2)):0},Ze=()=>o(this,null,(function*(){try{const t=yield I.get("/api/stock/stocks");t.data.success&&(_e.value=t.data.data.items)}catch(t){}})),We=t=>t?[...t].sort(((t,e)=>{const a=new Date(t.transaction_date).getTime(),s=new Date(e.transaction_date).getTime();return a!==s?s-a:e.id-t.id})):[];return _((()=>{Ze(),je()})),(t,e)=>(v(),p("div",N,[f("div",O,[e[10]||(e[10]=f("h4",{class:"mb-0"},"盈利统计",-1)),f("div",j,[f("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:Ne},[f("i",{class:m(["bi",l.value?"bi-chevron-up":"bi-search"])},null,2),y(" "+h(l.value?"收起":"搜索"),1)]),f("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:Ye,disabled:s.value},[f("i",{class:m(["bi",s.value?"bi-arrow-clockwise bi-spin":"bi-arrow-clockwise"])},null,2),e[8]||(e[8]=y(" 刷新市值 "))],8,V),f("button",{type:"button",class:"btn btn-sm btn-primary",onClick:Fe},e[9]||(e[9]=[f("i",{class:"bi bi-plus-lg"},null,-1),y(" 添加记录 ")]))])]),b(f("div",Y,[f("form",{onSubmit:g(je,["prevent"]),class:"row g-2 align-items-end"},[f("div",F,[e[11]||(e[11]=f("label",{class:"form-label small"},"开始日期",-1)),f("input",{type:"text",class:"form-control form-control-sm",style:{width:"130px"},value:Ee.value,onInput:Te,onBlur:He,onKeydown:[e[0]||(e[0]=k(g((t=>ye(t,"endDate")),["prevent"]),["enter"])),e[1]||(e[1]=k((t=>ye(t,"endDate")),["tab"]))],placeholder:"YYYY-MM-DD",ref_key:"startDate",ref:ve},null,40,E)]),f("div",M,[e[12]||(e[12]=f("label",{class:"form-label small"},"结束日期",-1)),f("input",{type:"text",class:"form-control form-control-sm",style:{width:"130px"},value:Me.value,onInput:Ke,onBlur:Pe,onKeydown:[e[2]||(e[2]=k(g((t=>ye(t,"market")),["prevent"]),["enter"])),e[3]||(e[3]=k((t=>ye(t,"market")),["tab"]))],placeholder:"YYYY-MM-DD",ref_key:"endDate",ref:fe},null,40,T)]),f("div",H,[e[14]||(e[14]=f("label",{class:"form-label small"},"市场",-1)),b(f("select",{class:"form-select form-select-sm",style:{width:"100px"},"onUpdate:modelValue":e[4]||(e[4]=t=>pe.market=t),ref_key:"market",ref:be,onKeydown:[e[5]||(e[5]=k(g((t=>ye(t,"search")),["prevent"]),["enter"])),e[6]||(e[6]=k((t=>ye(t,"search")),["tab"]))]},e[13]||(e[13]=[f("option",{value:""},"全部",-1),f("option",{value:"HK"},"HK",-1),f("option",{value:"USA"},"USA",-1)]),544),[[w,pe.market]])]),f("div",K,[e[15]||(e[15]=f("label",{class:"form-label small"},"股票代码",-1)),D(C,{modelValue:pe.stockCodes,"onUpdate:modelValue":e[7]||(e[7]=t=>pe.stockCodes=t),stocks:_e.value,market:pe.market,class:"stock-selector-sm"},null,8,["modelValue","stocks","market"])]),e[18]||(e[18]=f("div",{class:"col-auto flex-grow-1",style:{"max-width":"50px"}},null,-1)),f("div",P,[f("button",{type:"submit",class:"btn btn-sm btn-primary w-100 border border-primary text-white",style:{"background-color":"#0D6EFD"},disabled:a.value,ref:"searchBtn"},e[16]||(e[16]=[f("i",{class:"bi bi-search me-1"},null,-1),y("查询 ")]),8,A)]),f("div",{class:"col-auto d-flex align-items-end",style:{"min-width":"80px"}},[f("button",{type:"button",class:"btn btn-sm btn-outline-secondary w-100",onClick:Ve},e[17]||(e[17]=[f("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),y("重置 ")]))])],32)],512),[[x,l.value]]),f("div",B,[f("div",U,[f("table",Z,[e[44]||(e[44]=f("thead",{class:"table-light"},[f("tr",null,[f("th"),f("th",null,"市场"),f("th",{class:"text-end"},"股票数量"),f("th",{class:"text-end"},"笔数"),f("th",{class:"text-end"},"买入总额"),f("th",{class:"text-end",title:"移动加权平均价"},"平均价格"),f("th",{class:"text-end"},"卖出总额"),f("th",{class:"text-end"},"费用"),f("th",{class:"text-end"},"已实现盈亏"),f("th",{class:"text-end"},"现价"),f("th",{class:"text-end"},"持仓盈亏"),f("th",{class:"text-end"},"总盈亏"),f("th",{class:"text-end"},"盈亏率")])],-1)),f("tbody",null,[(v(!0),p(z,null,$(ke.value,(t=>(v(),p(z,{key:t},[f("tr",W,[f("td",null,[f("button",{onClick:e=>(t=>{r.value.has(t)?(r.value.delete(t),oe.value.delete(t),ce.value.delete(t),Object.keys(ie.value).filter((e=>e.startsWith(t))).forEach((t=>{re.value.delete(t)}))):(r.value.add(t),oe.value.add(t))})(t),class:"btn btn-sm btn-outline-primary"},[f("i",{class:m(["bi bi-chevron-right",{"rotate-90":$e(t)}])},null,2)],8,G)]),f("td",null,h(t),1),f("td",J,h(we(he.value[t].total_stocks,0)),1),f("td",Q,h(he.value[t].transaction_count),1),f("td",R,h(we(he.value[t].total_buy)),1),e[19]||(e[19]=f("td",{class:"text-end"},"-",-1)),f("td",X,h(we(he.value[t].total_sell)),1),f("td",tt,h(we(he.value[t].total_fees)),1),f("td",{class:m(["text-end",ze(he.value[t].realized_profit)])},h(we(he.value[t].realized_profit)),3),e[20]||(e[20]=f("td",{class:"text-end"},"-",-1)),f("td",{class:m(["text-end",ze(he.value[t].holding_profit)])},h(we(he.value[t].holding_profit)),3),f("td",{class:m(["text-end",ze(he.value[t].total_profit)])},h(we(he.value[t].total_profit)),3),f("td",{class:m(["text-end",ze(he.value[t].profit_rate)])},h(De(he.value[t].profit_rate)),3)]),$e(t)?(v(),p("tr",et,[e[21]||(e[21]=f("td",null,null,-1)),e[22]||(e[22]=f("td",null,[f("strong",null,"持仓统计")],-1)),f("td",at,h(he.value[t].holding_stats.count),1),e[23]||(e[23]=f("td",{class:"text-end"},"-",-1)),f("td",st,h(we(he.value[t].holding_stats.total_buy)),1),e[24]||(e[24]=f("td",{class:"text-end"},"-",-1)),f("td",lt,h(we(he.value[t].holding_stats.total_sell)),1),f("td",nt,h(we(he.value[t].holding_stats.total_fees)),1),f("td",{class:m(["text-end",ze(he.value[t].holding_stats.realized_profit)])},h(we(he.value[t].holding_stats.realized_profit)),3),e[25]||(e[25]=f("td",{class:"text-end"},"-",-1)),f("td",{class:m(["text-end",ze(he.value[t].holding_stats.holding_profit)])},h(we(he.value[t].holding_stats.holding_profit)),3),f("td",{class:m(["text-end",ze(he.value[t].holding_stats.total_profit)])},h(we(he.value[t].holding_stats.total_profit)),3),f("td",{class:m(["text-end",ze(he.value[t].holding_stats.profit_rate)])},h(De(he.value[t].holding_stats.profit_rate)),3)])):S("",!0),$e(t)?(v(),p("tr",ot,[e[26]||(e[26]=f("td",null,null,-1)),e[27]||(e[27]=f("td",null,[f("strong",null,"已清仓统计")],-1)),f("td",ct,h(he.value[t].closed_stats.count),1),e[28]||(e[28]=f("td",{class:"text-end"},"-",-1)),f("td",rt,h(we(he.value[t].closed_stats.total_buy)),1),e[29]||(e[29]=f("td",{class:"text-end"},"-",-1)),f("td",dt,h(we(he.value[t].closed_stats.total_sell)),1),f("td",it,h(we(he.value[t].closed_stats.total_fees)),1),f("td",{class:m(["text-end",ze(he.value[t].closed_stats.realized_profit)])},h(we(he.value[t].closed_stats.realized_profit)),3),e[30]||(e[30]=f("td",{class:"text-end"},"-",-1)),e[31]||(e[31]=f("td",{class:"text-end"},"-",-1)),e[32]||(e[32]=f("td",{class:"text-end"},"-",-1)),f("td",{class:m(["text-end",ze(he.value[t].closed_stats.profit_rate)])},h(De(he.value[t].closed_stats.profit_rate)),3)])):S("",!0),$e(t)?(v(),p(z,{key:2},[f("tr",ut,[f("td",null,[f("button",{onClick:e=>(t=>{oe.value.has(t)?oe.value.delete(t):oe.value.add(t)})(t),class:"btn btn-sm btn-outline-secondary"},[f("i",{class:m(["bi bi-chevron-right",{"rotate-90":Se(t)}])},null,2)],8,_t)]),e[33]||(e[33]=f("td",{colspan:"12"},[f("strong",null,"持仓股票")],-1))]),Se(t)?(v(!0),p(z,{key:0},$(xe(t),(a=>(v(),p(z,{key:a.code},[f("tr",pt,[f("td",null,[f("button",{onClick:e=>qe(t,a.code),class:"btn btn-sm btn-outline-secondary"},[f("i",{class:m(["bi bi-chevron-right",{"rotate-90":Le(t,a.code)}])},null,2)],8,vt)]),f("td",null,[y(h(a.code)+" ",1),f("span",ft,h(a.stock_name),1)]),f("td",bt,h(we(a.current_quantity,0)),1),f("td",yt,h(a.transaction_count),1),f("td",mt,h(we(a.total_buy)),1),f("td",ht,h(we(a.average_cost,3)),1),f("td",xt,h(we(a.total_sell)),1),f("td",gt,h(we(a.total_fees)),1),f("td",{class:m(["text-end",ze(a.realized_profit)])},h(we(a.realized_profit)),3),f("td",kt,h(a.current_quantity>0?we(a.current_price,3):"-"),1),f("td",{class:m(["text-end",ze(a.holding_profit)])},h(a.current_quantity>0?we(a.holding_profit):"-"),3),f("td",{class:m(["text-end",ze(a.total_profit)])},h(we(a.total_profit)),3),f("td",{class:m(["text-end",ze(a.profit_rate)])},h(De(a.profit_rate)),3)]),Le(t,a.code)?(v(),p("tr",wt,[f("td",Dt,[f("div",Ct,[f("table",zt,[e[37]||(e[37]=f("thead",{class:"table-light"},[f("tr",null,[f("th",{class:"transaction-info"},"交易日期"),f("th",{class:"quantity-price"},"数量@单价"),f("th",{class:"text-end amount"},"买入金额"),f("th",{class:"text-end cost",title:"移动加权平均价"},"平均价格"),f("th",{class:"text-end amount"},"卖出金额"),f("th",{class:"text-end fees"},"费用"),f("th",{class:"text-end profit"},"盈亏"),f("th",{class:"text-end current-price"},"盈亏率"),f("th",{class:"text-end holding-value"},"持有人"),f("th",{class:"text-end total-profit"}),f("th",{class:"text-end profit-rate"})])],-1)),f("tbody",null,[ue.value[`${t}-${a.code}`]?(v(!0),p(z,{key:0},$(We(ue.value[`${t}-${a.code}`]),(t=>(v(),p("tr",{key:t.id},[f("td",$t,[y(h(Ce(t.transaction_date))+" ",1),f("span",{class:m(["transaction-type-badge","buy"===t.transaction_type.toLowerCase()?"buy":"sell"])},h("buy"===t.transaction_type.toLowerCase()?"买入":"卖出"),3),f("span",St,h(t.transaction_code.trim()),1)]),f("td",It,h(we(t.total_quantity,0))+" @ "+h(we(t.total_amount/t.total_quantity,3)),1),f("td",Lt,h("buy"===t.transaction_type.toLowerCase()?we(t.total_amount):""),1),f("td",qt,["buy"===t.transaction_type.toLowerCase()?(v(),p(z,{key:0},[y(h(we(t.current_avg_cost,3)),1)],64)):(v(),p(z,{key:1},[y(h(we(t.prev_avg_cost,3)),1)],64))]),f("td",Nt,h("sell"===t.transaction_type.toLowerCase()?we(t.total_amount):""),1),f("td",Ot,h(we(t.total_fees)),1),f("td",{class:m(["text-end",ze(Be(t))])},h("sell"===t.transaction_type.toLowerCase()?we(Be(t)):"-"),3),f("td",{class:m(["text-end",ze(Ue(t))])},h("sell"===t.transaction_type.toLowerCase()?De(Ue(t)):"-"),3),f("td",jt,h(t.holder_name||"-"),1),e[34]||(e[34]=f("td",{class:"text-end"},"-",-1)),e[35]||(e[35]=f("td",{class:"text-end"},"-",-1))])))),128)):(v(),p("tr",Vt,e[36]||(e[36]=[f("td",{colspan:"11",class:"text-center py-2"},[f("small",{class:"text-muted"},"暂无交易明细数据")],-1)])))])])])])])):S("",!0)],64)))),128)):S("",!0),f("tr",Yt,[f("td",null,[f("button",{onClick:e=>(t=>{ce.value.has(t)?ce.value.delete(t):ce.value.add(t)})(t),class:"btn btn-sm btn-outline-secondary"},[f("i",{class:m(["bi bi-chevron-right",{"rotate-90":Ie(t)}])},null,2)],8,Ft)]),e[38]||(e[38]=f("td",{colspan:"12"},[f("strong",null,"已清仓股票")],-1))]),Ie(t)?(v(!0),p(z,{key:1},$(ge(t),(a=>(v(),p(z,{key:a.code},[f("tr",Et,[f("td",null,[f("button",{onClick:e=>qe(t,a.code),class:"btn btn-sm btn-outline-secondary"},[f("i",{class:m(["bi bi-chevron-right",{"rotate-90":Le(t,a.code)}])},null,2)],8,Mt)]),f("td",null,[y(h(a.code)+" ",1),f("span",Tt,h(a.stock_name),1)]),f("td",Ht,h(a.quantity||"-"),1),f("td",Kt,h(a.transaction_count),1),f("td",Pt,h(we(a.total_buy)),1),e[39]||(e[39]=f("td",{class:"text-end"},"-",-1)),f("td",At,h(we(a.total_sell)),1),f("td",Bt,h(we(a.total_fees)),1),f("td",{class:m(["text-end",ze(a.realized_profit)])},h(we(a.realized_profit)),3),f("td",Ut,h(a.current_quantity>0?we(a.current_price,3):"-"),1),f("td",{class:m(["text-end",ze(a.holding_profit)])},h(a.current_quantity>0?we(a.holding_profit):"-"),3),f("td",{class:m(["text-end",ze(a.total_profit)])},h(we(a.total_profit)),3),f("td",{class:m(["text-end",ze(a.profit_rate)])},h(De(a.profit_rate)),3)]),Le(t,a.code)?(v(),p("tr",Zt,[f("td",Wt,[f("div",Gt,[f("table",Jt,[e[43]||(e[43]=f("thead",{class:"table-light"},[f("tr",null,[f("th",{class:"transaction-info"},"交易日期"),f("th",{class:"quantity-price"},"数量@单价"),f("th",{class:"text-end amount"},"买入金额"),f("th",{class:"text-end cost",title:"移动加权平均价"},"平均价格"),f("th",{class:"text-end amount"},"卖出金额"),f("th",{class:"text-end fees"},"费用"),f("th",{class:"text-end profit"},"盈亏"),f("th",{class:"text-end current-price"},"盈亏率"),f("th",{class:"text-end holding-value"},"持有人"),f("th",{class:"text-end total-profit"}),f("th",{class:"text-end profit-rate"})])],-1)),f("tbody",null,[ue.value[`${t}-${a.code}`]?(v(!0),p(z,{key:0},$(We(ue.value[`${t}-${a.code}`]),(t=>(v(),p("tr",{key:t.id},[f("td",Qt,[y(h(Ce(t.transaction_date))+" ",1),f("span",{class:m(["transaction-type-badge","buy"===t.transaction_type.toLowerCase()?"buy":"sell"])},h("buy"===t.transaction_type.toLowerCase()?"买入":"卖出"),3),f("span",Rt,h(t.transaction_code.trim()),1)]),f("td",Xt,h(we(t.total_quantity,0))+" @ "+h(we(t.total_amount/t.total_quantity,3)),1),f("td",te,h("buy"===t.transaction_type.toLowerCase()?we(t.total_amount):""),1),f("td",ee,["buy"===t.transaction_type.toLowerCase()?(v(),p(z,{key:0},[y(h(we(t.current_avg_cost,3)),1)],64)):(v(),p(z,{key:1},[y(h(we(t.prev_avg_cost,3)),1)],64))]),f("td",ae,h("sell"===t.transaction_type.toLowerCase()?we(t.total_amount):""),1),f("td",se,h(we(t.total_fees)),1),f("td",{class:m(["text-end",ze(Be(t))])},h("sell"===t.transaction_type.toLowerCase()?we(Be(t)):"-"),3),f("td",{class:m(["text-end",ze(Ue(t))])},h("sell"===t.transaction_type.toLowerCase()?De(Ue(t)):"-"),3),f("td",le,h(t.holder_name||"-"),1),e[40]||(e[40]=f("td",{class:"text-end"},"-",-1)),e[41]||(e[41]=f("td",{class:"text-end"},"-",-1))])))),128)):(v(),p("tr",ne,e[42]||(e[42]=[f("td",{colspan:"11",class:"text-center py-2"},[f("small",{class:"text-muted"},"暂无交易明细数据")],-1)])))])])])])])):S("",!0)],64)))),128)):S("",!0)],64)):S("",!0)],64)))),128))])])])])]))}},[["__scopeId","data-v-bbd6b550"]]);export{oe as default};
