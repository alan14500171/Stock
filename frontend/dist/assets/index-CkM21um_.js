const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProfitStats-UJCabBAl.js","assets/vendor-BeeV2Y_X.js","assets/TransactionAdd--H8IwfhR.js","assets/TransactionEdit-D4dtyU4c.js","assets/Holder-qx6hFr6R.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,i=(e,t,a)=>new Promise(((l,s)=>{var n=e=>{try{i(a.next(e))}catch(t){s(t)}},o=e=>{try{i(a.throw(e))}catch(t){s(t)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,o);i((a=a.apply(e,t)).next())}));import{d,r,a as c,T as u,o as m,b as v,c as p,e as b,f as y,g as f,h,i as g,t as k,w,j as _,v as x,u as D,k as C,n as I,l as S,p as V,q as P,s as L,x as q,y as M,z as U,A as E,B as N,C as A,F as $,D as T,E as O,G as Y,M as j,H as K,I as z,J as R,K as H,L as F,N as B,O as J,P as W,Q as X,R as Z,S as G,U as Q,V as ee,W as te,X as ae,Y as le,Z as se}from"./vendor-BeeV2Y_X.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const ne={},oe=function(e,t,a){let l=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),a=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));l=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in ne)return;ne[e]=!0;const t=e.endsWith(".css"),l=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${l}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,a&&s.setAttribute("nonce",a),document.head.appendChild(s),t?new Promise(((t,a)=>{s.addEventListener("load",t),s.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return l.then((t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)}))},ie=d("permission",(()=>{const e=r([]),t=r([]),a=r(!1),l=r(!1),s=()=>{e.value=["stock","stock:list","stock:list:view","stock:list:add","stock:list:edit","stock:list:delete","stock:holdings","stock:holdings:view","stock:holdings:export","transaction","transaction:records","transaction:records:view","transaction:records:add","transaction:records:edit","transaction:records:delete","transaction:records:export","transaction:stats","transaction:stats:view","transaction:stats:export","transaction:split","transaction:split:view","transaction:split:add","transaction:split:edit","transaction:split:delete","profit","profit:stats","profit:stats:view","profit:overview","profit:overview:view","profit:overview:export","profit:details","profit:details:view","profit:details:export","exchange","exchange:rates","exchange:rates:view","exchange:rates:add","exchange:rates:edit","exchange:rates:delete","exchange:converter","exchange:converter:use","system","system:user","system:user:view","system:user:add","system:user:edit","system:user:delete","system:user:assign","system:role","system:role:view","system:role:add","system:role:edit","system:role:delete","system:role:assign","system:permission","system:permission:view","system:permission:add","system:permission:edit","system:permission:delete","system:settings","system:settings:view","system:settings:edit","system:holder","system:holder:view","system:holder:add","system:holder:edit","system:holder:delete"],t.value=["admin"],a.value=!0},n=()=>{e.value=[],t.value=[],a.value=!0};return{permissions:e,roles:t,loaded:a,loading:l,loadPermissions:()=>i(void 0,null,(function*(){if(!a.value){l.value=!0;try{let l=!1;try{const e=JSON.parse(localStorage.getItem("user")||"{}");l="alan"===e.username||"admin"===e.username}catch(o){}if(l)return void s();try{const l=yield c.get("/api/system/user/info");if(l.data.success){const s=l.data.data.permissions||[];if(s.length>0){const t=s[0];e.value="string"==typeof t?s.map((e=>({code:e}))):s}else e.value=[];const n=l.data.data.roles||[];t.value=n,a.value=!0}else n()}catch(i){n()}}finally{l.value=!1}}})),hasPermission:t=>{try{const e=JSON.parse(localStorage.getItem("user")||"{}");if("alan"===e.username||"admin"===e.username)return!0}catch(a){}if(!t||0===e.value.length)return!1;return e.value.some((e=>("string"==typeof e?e:e.code)===t))},hasRole:e=>{try{const e=JSON.parse(localStorage.getItem("user")||"{}");if("alan"===e.username||"admin"===e.username)return!0}catch(a){}if(!e||0===t.value.length)return!1;return t.value.some((t=>("string"==typeof t?t:t.name)===e))},resetPermissions:()=>{e.value=[],t.value=[],a.value=!1},setAdminPermissions:s,setDefaultPermissions:n}}));function de(){const e=(e,t="primary",a=3e3)=>{const l=document.createElement("div");l.className=`toast align-items-center text-white bg-${t} border-0`,l.setAttribute("role","alert"),l.setAttribute("aria-live","assertive"),l.setAttribute("aria-atomic","true"),l.innerHTML=`\n      <div class="d-flex">\n        <div class="toast-body">\n          ${e}\n        </div>\n        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n      </div>\n    `;let s=document.getElementById("toast-container");s||(s=document.createElement("div"),s.id="toast-container",s.className="toast-container position-fixed top-0 end-0 p-3",s.style.zIndex="1080",document.body.appendChild(s)),s.appendChild(l);new u(l,{autohide:!0,delay:a}).show(),l.addEventListener("hidden.bs.toast",(()=>{l.remove()}))};return{success:(t,a)=>{e(t,"success",a)},error:(t,a)=>{e(t,"danger",a)},warning:(t,a)=>{e(t,"warning",a)},info:(t,a)=>{e(t,"info",a)}}}r([]);const re=(e,t)=>{const a=e.__vccOpts||e;for(const[l,s]of t)a[l]=s;return a},ce={class:"password-change-modal"},ue={class:"modal fade",id:"passwordChangeModal",tabindex:"-1","aria-labelledby":"passwordChangeModalLabel","aria-hidden":"true"},me={class:"modal-dialog modal-dialog-centered"},ve={class:"modal-content"},pe={class:"modal-body"},be={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},ye={key:1,class:"alert alert-danger alert-dismissible fade show",role:"alert"},fe={class:"form-floating mb-3"},he=["disabled"],ge={class:"form-floating mb-3"},ke=["disabled"],we={class:"form-floating mb-3"},_e=["disabled"],xe={key:0,class:"text-danger mt-1 small"},De={class:"modal-footer"},Ce=["disabled"],Ie={key:0,class:"spinner-border spinner-border-sm me-2"},Se={__name:"PasswordChangeModal",setup(e,{expose:t}){let a=null;const l=r(!0);m((()=>{oe((()=>import("./vendor-BeeV2Y_X.js").then((e=>e.m))),[]).then((e=>{const t=e.default;a=new t(document.getElementById("passwordChangeModal"));const s=document.getElementById("passwordChangeModal");s&&s.addEventListener("show.bs.modal",(e=>{l.value&&(e.preventDefault(),l.value=!1)}))}))}));const s=de(),n=v({currentPassword:"",newPassword:"",confirmPassword:""}),o=r(!1),d=r(""),u=r(""),D=p((()=>n.newPassword&&n.confirmPassword&&n.newPassword!==n.confirmPassword)),C=p((()=>n.currentPassword&&n.newPassword&&n.confirmPassword&&n.newPassword===n.confirmPassword)),I=()=>{a&&a.hide()},S=()=>i(this,null,(function*(){var e,t;if(!o.value)if(d.value="",u.value="",C.value){o.value=!0;try{const e=yield c.post("/api/auth/change_password",{current_password:n.currentPassword,new_password:n.newPassword});e.data.success?(u.value="密码修改成功",s.success("密码修改成功"),n.currentPassword="",n.newPassword="",n.confirmPassword="",setTimeout((()=>{I()}),3e3)):d.value=e.data.message||"密码修改失败"}catch(a){d.value=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"密码修改失败，请稍后重试"}finally{o.value=!1}}else D.value?d.value="两次输入的新密码不一致":d.value="请填写所有必填字段"}));return t({openModal:()=>{a&&(n.currentPassword="",n.newPassword="",n.confirmPassword="",d.value="",u.value="",l.value=!1,a.show())},closeModal:I}),(e,t)=>(y(),b("div",ce,[f("div",ue,[f("div",me,[f("div",ve,[t[10]||(t[10]=f("div",{class:"modal-header"},[f("h5",{class:"modal-title",id:"passwordChangeModalLabel"},"修改密码"),f("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),f("div",pe,[u.value?(y(),b("div",be,[g(k(u.value)+" ",1),f("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=e=>u.value="")})])):h("",!0),d.value?(y(),b("div",ye,[g(k(d.value)+" ",1),f("button",{type:"button",class:"btn-close",onClick:t[1]||(t[1]=e=>d.value="")})])):h("",!0),t[8]||(t[8]=f("div",{class:"alert alert-info mb-4"},[f("i",{class:"bi bi-info-circle me-2"}),g(" 为了保障账户安全，请定期修改密码。建议使用包含字母、数字和特殊字符的强密码。 ")],-1)),f("form",{onSubmit:w(S,["prevent"])},[f("div",fe,[_(f("input",{type:"password",class:"form-control",id:"currentPassword","onUpdate:modelValue":t[2]||(t[2]=e=>n.currentPassword=e),placeholder:"当前密码",autocomplete:"current-password",required:"",disabled:o.value},null,8,he),[[x,n.currentPassword]]),t[5]||(t[5]=f("label",{for:"currentPassword"},"当前密码",-1))]),f("div",ge,[_(f("input",{type:"password",class:"form-control",id:"newPassword","onUpdate:modelValue":t[3]||(t[3]=e=>n.newPassword=e),placeholder:"新密码",autocomplete:"new-password",required:"",disabled:o.value},null,8,ke),[[x,n.newPassword]]),t[6]||(t[6]=f("label",{for:"newPassword"},"新密码",-1))]),f("div",we,[_(f("input",{type:"password",class:"form-control",id:"confirmPassword","onUpdate:modelValue":t[4]||(t[4]=e=>n.confirmPassword=e),placeholder:"确认新密码",autocomplete:"new-password",required:"",disabled:o.value},null,8,_e),[[x,n.confirmPassword]]),t[7]||(t[7]=f("label",{for:"confirmPassword"},"确认新密码",-1)),D.value?(y(),b("div",xe," 两次输入的新密码不一致 ")):h("",!0)])],32)]),f("div",De,[t[9]||(t[9]=f("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),f("button",{type:"button",class:"btn btn-primary",onClick:S,disabled:o.value||!C.value},[o.value?(y(),b("span",Ie)):h("",!0),g(" "+k(o.value?"提交中...":"修改密码"),1)],8,Ce)])])])])]))}},Ve=re(Se,[["__scopeId","data-v-1e2c34ab"]]),Pe={key:0,class:"navbar navbar-expand-lg navbar-dark bg-primary"},Le={class:"container-fluid"},qe={class:"collapse navbar-collapse",id:"navbarNav"},Me={class:"navbar-nav me-auto"},Ue={class:"nav-item"},Ee={key:0,class:"nav-item"},Ne={key:1,class:"nav-item"},Ae={key:2,class:"nav-item"},$e={key:3,class:"nav-item"},Te={key:4,class:"nav-item dropdown"},Oe={class:"dropdown-menu","aria-labelledby":"systemDropdown"},Ye={key:0},je={key:1},Ke={key:2},ze={key:3},Re={class:"navbar-nav"},He={class:"nav-item dropdown"},Fe={class:"nav-link dropdown-toggle",href:"#",id:"userDropdown",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},Be={class:"dropdown-menu dropdown-menu-end","aria-labelledby":"userDropdown"},Je={class:"container-fluid mt-3"},We={__name:"App",setup(e){const t=D(),a=ie(),l=r(null),s=p((()=>{const e="true"===localStorage.getItem("isLoggedIn");let t=!1;try{const e=localStorage.getItem("user");if(t=e&&"undefined"!==e&&"null"!==e,t){const a=JSON.parse(e);t=a&&a.username}}catch(a){t=!1,localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn")}return e&&t})),n=e=>a.hasPermission(e),o=p((()=>{try{return JSON.parse(localStorage.getItem("user")||"{}").username||""}catch(e){return""}}));p((()=>{try{const e=JSON.parse(localStorage.getItem("user")||"{}");return"alan"===e.username||"admin"===e.username}catch(e){return!1}}));const i=p((()=>a.hasPermission("system:user:view")||a.hasPermission("system:role:view")||a.hasPermission("system:permission:view"))),d=()=>{localStorage.removeItem("isLoggedIn"),localStorage.removeItem("user"),a.resetPermissions(),I((()=>{window.location.href="/login"}))},c=()=>{l.value.openModal()},u=()=>{if("undefined"!=typeof window)if(window.bootstrap||"undefined"==typeof bootstrap||(window.bootstrap=bootstrap),window.bootstrap)try{const e=document.querySelector(".navbar");if(!e)return;if("none"===getComputedStyle(e).display)return;const t=document.querySelectorAll(".dropdown-toggle");if(0===t.length)return;t.forEach(((e,t)=>{const a=window.bootstrap.Dropdown.getInstance(e);a&&a.dispose(),new window.bootstrap.Dropdown(e)}))}catch(e){}else setTimeout((()=>{window.bootstrap&&u()}),500)};return C(s,(e=>{e&&(a.loaded||a.loadPermissions(),I((()=>{setTimeout(u,300)})))})),m((()=>{oe((()=>import("./vendor-BeeV2Y_X.js").then((e=>e.U))),[]).then((e=>{window.bootstrap=e,s.value&&!a.loaded&&a.loadPermissions(),I((()=>{setTimeout(u,300)})),setTimeout((()=>{u()}),1e3),setTimeout((()=>{u()}),2e3)})).catch((e=>{})),t.beforeEach(((e,t,a)=>{a()})),t.afterEach(((e,t)=>{e.path.includes("/login")||t.path.includes("/login")?setTimeout((()=>{"true"===localStorage.getItem("isLoggedIn")&&"/login"!==e.path&&I((()=>{setTimeout(u,300)}))}),500):s.value&&I((()=>{setTimeout(u,300)}))}))})),(e,t)=>{const a=S("router-link"),r=S("router-view");return y(),b("div",null,[s.value?(y(),b("nav",Pe,[f("div",Le,[t[13]||(t[13]=f("a",{class:"navbar-brand",href:"#"},"股票交易系统",-1)),t[14]||(t[14]=f("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[f("span",{class:"navbar-toggler-icon"})],-1)),f("div",qe,[f("ul",Me,[f("li",Ue,[P(a,{to:"/home",class:"nav-link"},{default:L((()=>t[0]||(t[0]=[f("i",{class:"bi bi-house-door"},null,-1),g(" 首页 ")]))),_:1})]),n("profit:stats:view")?(y(),b("li",Ee,[P(a,{to:"/profit/stats",class:"nav-link"},{default:L((()=>t[1]||(t[1]=[f("i",{class:"bi bi-bar-chart"},null,-1),g(" 收益统计 ")]))),_:1})])):h("",!0),n("transaction:records:view")?(y(),b("li",Ne,[P(a,{to:"/transaction/list",class:"nav-link"},{default:L((()=>t[2]||(t[2]=[f("i",{class:"bi bi-list-ul"},null,-1),g(" 交易记录 ")]))),_:1})])):h("",!0),n("exchange:rates:view")?(y(),b("li",Ae,[P(a,{to:"/exchange/rate",class:"nav-link"},{default:L((()=>t[3]||(t[3]=[f("i",{class:"bi bi-currency-exchange"},null,-1),g(" 汇率管理 ")]))),_:1})])):h("",!0),n("stock:list:view")?(y(),b("li",$e,[P(a,{to:"/stock",class:"nav-link"},{default:L((()=>t[4]||(t[4]=[f("i",{class:"bi bi-graph-up"},null,-1),g(" 股票管理 ")]))),_:1})])):h("",!0),i.value?(y(),b("li",Te,[t[9]||(t[9]=f("a",{class:"nav-link dropdown-toggle",href:"#",id:"systemDropdown",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[f("i",{class:"bi bi-gear"}),g(" 系统管理 ")],-1)),f("ul",Oe,[n("system:user:view")?(y(),b("li",Ye,[P(a,{to:"/system/user",class:"dropdown-item"},{default:L((()=>t[5]||(t[5]=[f("i",{class:"bi bi-people"},null,-1),g(" 用户管理 ")]))),_:1})])):h("",!0),n("system:role:view")?(y(),b("li",je,[P(a,{to:"/system/role",class:"dropdown-item"},{default:L((()=>t[6]||(t[6]=[f("i",{class:"bi bi-person-badge"},null,-1),g(" 角色管理 ")]))),_:1})])):h("",!0),n("system:permission:view")?(y(),b("li",Ke,[P(a,{to:"/system/permission",class:"dropdown-item"},{default:L((()=>t[7]||(t[7]=[f("i",{class:"bi bi-shield-lock"},null,-1),g(" 权限管理 ")]))),_:1})])):h("",!0),n("system:holder:view")?(y(),b("li",ze,[P(a,{to:"/system/holder",class:"dropdown-item"},{default:L((()=>t[8]||(t[8]=[f("i",{class:"bi bi-person-vcard"},null,-1),g(" 持有人管理 ")]))),_:1})])):h("",!0)])])):h("",!0)]),f("ul",Re,[f("li",He,[f("a",Fe,[t[10]||(t[10]=f("i",{class:"bi bi-person-circle"},null,-1)),g(" "+k(o.value),1)]),f("ul",Be,[f("li",null,[f("a",{href:"#",class:"dropdown-item",onClick:w(c,["prevent"])},t[11]||(t[11]=[f("i",{class:"bi bi-key"},null,-1),g(" 修改密码 ")]))]),f("li",null,[f("a",{href:"#",class:"dropdown-item",onClick:w(d,["prevent"])},t[12]||(t[12]=[f("i",{class:"bi bi-box-arrow-right"},null,-1),g(" 退出登录 ")]))])])])])])])])):h("",!0),f("div",Je,[P(r)]),s.value?(y(),V(Ve,{key:1,ref_key:"passwordChangeModal",ref:l},null,512)):h("",!0)])}}},Xe={class:"welcome-container"},Ze={class:"welcome-content text-center"},Ge={class:"d-grid gap-3 d-sm-flex justify-content-sm-center"},Qe={__name:"Welcome",setup(e){return D(),m((()=>i(this,null,(function*(){if("true"===localStorage.getItem("isLoggedIn"))window.location.href="/home";else try{const e=yield c.get("/api/auth/check_login");e.data.is_authenticated&&(localStorage.setItem("isLoggedIn","true"),e.data.user&&localStorage.setItem("user",JSON.stringify(e.data.user)),window.location.href="/home")}catch(e){}})))),(e,t)=>{const a=S("router-link");return y(),b("div",Xe,[f("div",Ze,[t[1]||(t[1]=f("h1",{class:"display-4 mb-3"},"欢迎使用股票交易记录系统",-1)),t[2]||(t[2]=f("p",{class:"lead mb-4"},"这是一个简单的股票交易记录管理系统，帮助您追踪港股和美股的交易记录。",-1)),f("div",Ge,[P(a,{to:"/login",class:"btn btn-primary btn-lg px-4"},{default:L((()=>t[0]||(t[0]=[g(" 登录 ")]))),_:1})])])])}}},et=re(Qe,[["__scopeId","data-v-fa60d1d0"]]),tt={class:"login-container"},at={class:"login-box"},lt={class:"card shadow-sm"},st={class:"card-body p-4"},nt={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},ot={class:"form-floating mb-3"},it=["disabled"],dt={class:"form-floating mb-4"},rt=["disabled"],ct={class:"d-grid gap-2"},ut=["disabled"],mt={key:0,class:"spinner-border spinner-border-sm me-2"},vt={__name:"Login",emits:["login-success"],setup(e,{emit:t}){D();const a=q(),l=de(),s=r({username:"",password:""}),n=r(!1),o=r(""),d=()=>i(this,null,(function*(){var e,t;if(!n.value){o.value="",n.value=!0;try{const e=yield c.post("/api/auth/login",{username:s.value.username,password:s.value.password},{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(e.data.success){l.success("登录成功"),e.data.user&&localStorage.setItem("user",JSON.stringify(e.data.user)),localStorage.setItem("isLoggedIn","true");const t=ie();try{yield t.loadPermissions()}catch(i){}("admin"===s.value.username||"alan"===s.value.username)&&t.setAdminPermissions();const n=a.query.redirect||"/home";setTimeout((()=>{window.location.href=n}),500)}}catch(d){d.value=(null==(t=null==(e=d.response)?void 0:e.data)?void 0:t.message)||"登录失败，请检查用户名和密码",l.error(d.value)}finally{n.value=!1}}}));return(e,t)=>(y(),b("div",tt,[f("div",at,[f("div",lt,[f("div",st,[t[5]||(t[5]=f("h4",{class:"text-center mb-4"},"欢迎登录",-1)),o.value?(y(),b("div",nt,[g(k(o.value)+" ",1),f("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=e=>o.value="")})])):h("",!0),f("form",{onSubmit:w(d,["prevent"])},[f("div",ot,[_(f("input",{type:"text",class:"form-control",id:"username","onUpdate:modelValue":t[1]||(t[1]=e=>s.value.username=e),placeholder:"用户名",required:"",disabled:n.value},null,8,it),[[x,s.value.username]]),t[3]||(t[3]=f("label",{for:"username"},"用户名",-1))]),f("div",dt,[_(f("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>s.value.password=e),placeholder:"密码",required:"",disabled:n.value},null,8,rt),[[x,s.value.password]]),t[4]||(t[4]=f("label",{for:"password"},"密码",-1))]),f("div",ct,[f("button",{type:"submit",class:"btn btn-primary btn-lg",disabled:n.value||!s.value.username||!s.value.password},[n.value?(y(),b("span",mt)):h("",!0),g(" "+k(n.value?"登录中...":"登录"),1)],8,ut)])],32)])])])]))}},pt=re(vt,[["__scopeId","data-v-20beafb7"]]),bt={class:"home-container","data-testid":"home-container"},yt={class:"content-wrapper"},ft={class:"row"},ht={class:"col-12 mb-4"},gt={class:"row g-4"},kt={class:"col-md-6"},wt={class:"card h-100","data-testid":"profit-stats-card"},_t={class:"card-body"},xt={class:"col-md-6"},Dt={class:"card h-100","data-testid":"transactions-card"},Ct={class:"card-body"},It={class:"btn-group"},St={class:"col-md-6"},Vt={class:"card h-100","data-testid":"stocks-card"},Pt={class:"card-body"},Lt={class:"col-md-6"},qt={class:"card h-100","data-testid":"exchange-rates-card"},Mt={class:"card-body"},Ut={__name:"Home",setup:e=>(e,t)=>{const a=S("router-link");return y(),b("div",bt,[f("div",yt,[f("div",ft,[f("div",ht,[t[13]||(t[13]=f("h2",{class:"section-title","data-testid":"home-section-title"},"快速操作",-1)),f("div",gt,[f("div",kt,[f("div",wt,[f("div",_t,[t[1]||(t[1]=f("h5",{class:"card-title","data-testid":"profit-stats-title"},[f("i",{class:"bi bi-graph-up text-primary"}),g(" 盈利统计 ")],-1)),t[2]||(t[2]=f("p",{class:"card-text"},"查看您的交易盈亏情况，分析投资表现。",-1)),P(a,{to:"/profit/stats",class:"btn btn-primary","data-testid":"view-profit-stats-btn"},{default:L((()=>t[0]||(t[0]=[g(" 查看统计 ")]))),_:1})])])]),f("div",xt,[f("div",Dt,[f("div",Ct,[t[5]||(t[5]=f("h5",{class:"card-title","data-testid":"transactions-title"},[f("i",{class:"bi bi-journal-text text-success"}),g(" 交易记录 ")],-1)),t[6]||(t[6]=f("p",{class:"card-text"},"管理您的所有交易记录，添加新的交易。",-1)),f("div",It,[P(a,{to:"/transaction/list",class:"btn btn-success","data-testid":"view-transactions-btn"},{default:L((()=>t[3]||(t[3]=[g(" 查看记录 ")]))),_:1}),P(a,{to:"/transaction/add",class:"btn btn-outline-success","data-testid":"add-transaction-btn"},{default:L((()=>t[4]||(t[4]=[g(" 添加交易 ")]))),_:1})])])])]),f("div",St,[f("div",Vt,[f("div",Pt,[t[8]||(t[8]=f("h5",{class:"card-title","data-testid":"stocks-title"},[f("i",{class:"bi bi-briefcase text-info"}),g(" 股票管理 ")],-1)),t[9]||(t[9]=f("p",{class:"card-text"},"管理您的股票列表，添加新的股票。",-1)),P(a,{to:"/stock",class:"btn btn-info text-white","data-testid":"manage-stocks-btn"},{default:L((()=>t[7]||(t[7]=[g(" 管理股票 ")]))),_:1})])])]),f("div",Lt,[f("div",qt,[f("div",Mt,[t[11]||(t[11]=f("h5",{class:"card-title","data-testid":"exchange-rates-title"},[f("i",{class:"bi bi-currency-exchange text-warning"}),g(" 汇率管理 ")],-1)),t[12]||(t[12]=f("p",{class:"card-text"},"更新和管理港币、美元等货币汇率。",-1)),P(a,{to:"/exchange/rate",class:"btn btn-warning text-white","data-testid":"manage-exchange-rates-btn"},{default:L((()=>t[10]||(t[10]=[g(" 管理汇率 ")]))),_:1})])])])])])])])])}},Et=re(Ut,[["__scopeId","data-v-eec8756f"]]),Nt={key:0},At={class:"modal-dialog"},$t={class:"modal-content"},Tt={class:"modal-header"},Ot={class:"modal-title","data-testid":"dialog-title"},Yt={class:"modal-body"},jt={class:"mb-3"},Kt=["onKeydown","readonly"],zt={class:"invalid-feedback","data-testid":"stock-code-error"},Rt={class:"mb-3"},Ht={class:"invalid-feedback","data-testid":"stock-market-error"},Ft={class:"mb-3"},Bt=["readonly"],Jt={class:"invalid-feedback","data-testid":"stock-name-error"},Wt={class:"mb-3"},Xt=["readonly"],Zt={class:"mb-3"},Gt=["value"],Qt={class:"modal-footer"},ea=["disabled"],ta={key:0,class:"spinner-border spinner-border-sm me-1"},aa={__name:"StockAddDialog",props:{modelValue:Boolean,editData:{type:Object,default:()=>null}},emits:["update:modelValue","success"],setup(e,{emit:t}){const a=e,l=t,s=de(),n=r(!1),o=r({}),d=r(""),u=r(!1),m=r({market:"",code:"",code_name:"",google_code:"",current_price:null}),v=()=>{const e=m.value.code;m.value={market:"",code:e,code_name:"",google_code:"",current_price:null},o.value={}};p((()=>d.value&&(d.value.includes("已存在")||d.value.includes("添加失败")))),p((()=>m.value.current_price||""));const D=e=>i(this,null,(function*(){if(e.preventDefault(),m.value.code){o.value={},d.value="";try{const e=yield c.get(`/api/stock/search_stock?code=${encodeURIComponent(m.value.code)}`);if(e.data.success&&e.data.data.length>0){const t=e.data.data[0];t.market="HK"===t.market||"HKG"===t.exchange?"HK":"USA";const a=yield c.get("/api/stock/stocks",{params:{search:m.value.code}});if(a.data.success&&a.data.data.items.length>0){if(a.data.data.items.find((e=>e.code===m.value.code)))return d.value="该股票代码已存在",void v()}m.value.current_price=t.price,m.value.google_code=t.query,m.value.code_name=t.code_name||t.name||"",m.value.market=t.market,m.value.code_name?u.value=!0:o.value.code_name="未能获取公司名称"}else d.value="未找到股票信息，请检查股票代码是否正确",v()}catch(t){d.value="查询失败，请检查股票代码是否正确",v()}}}));C((()=>m.value.code),(e=>{e?u.value&&(u.value=!1):I()}));const I=()=>{m.value={market:"",code:"",code_name:"",google_code:"",current_price:null},o.value={},d.value="",u.value=!1},S=()=>{l("update:modelValue",!1),I()};C((()=>a.editData),(e=>{e?(m.value={code:e.code,market:e.market,code_name:e.code_name,google_code:e.google_name,current_price:e.current_price},u.value=!0):I()}),{immediate:!0});const V=()=>i(this,null,(function*(){if((()=>{o.value={};let e=!0;return m.value.code&&m.value.code.trim()||(o.value.code="请输入股票代码",e=!1),m.value.market&&m.value.market.trim()||(o.value.market="请选择市场",e=!1),m.value.code_name&&m.value.code_name.trim()||(o.value.code_name="请输入股票名称",e=!1),m.value.google_code&&m.value.google_code.trim()||(o.value.google_code="请输入谷歌查询代码",e=!1),e})()&&!n.value)try{if(n.value=!0,!m.value.code_name||!m.value.code_name.trim())throw new Error("股票名称不能为空");const e={code:m.value.code.trim(),market:m.value.market.trim(),code_name:m.value.code_name.trim(),google_name:m.value.google_code.trim(),currency:"HK"===m.value.market?"HKD":"USD"},t=a.editData?`/api/stock/stocks/${a.editData.id}`:"/api/stock/stocks",o=a.editData?"put":"post",i=yield c[o](t,e);if(!i.data.success)throw new Error(i.data.message||"操作失败");s.success(a.editData?"股票更新成功":"股票添加成功"),l("success"),S()}catch(e){s.error(e.message||"操作失败，请重试"),o.value.code_name=e.message}finally{n.value=!1}}));return(t,a)=>{const l=M("permission");return e.modelValue?(y(),b("div",Nt,[f("div",{class:E(["modal fade",{show:e.modelValue}]),tabindex:"-1","data-testid":"stock-add-dialog"},[f("div",At,[f("div",$t,[f("div",Tt,[f("h5",Ot,k(e.editData?"编辑股票":"添加新股票"),1),f("button",{type:"button",class:"btn-close",onClick:S,"data-testid":"close-btn"})]),_((y(),b("div",Yt,[f("form",{onSubmit:w(V,["prevent"])},[f("div",jt,[a[4]||(a[4]=f("label",{class:"form-label","data-testid":"stock-code-label"},"股票代码",-1)),_(f("input",{type:"text",class:E(["form-control",{"is-invalid":o.value.code}]),"onUpdate:modelValue":a[0]||(a[0]=e=>m.value.code=e),placeholder:"输入股票代码后将自动查询股票信息",onKeydown:[U(w(D,["prevent"]),["enter"]),U(w(D,["prevent"]),["tab"])],readonly:!!e.editData,"data-testid":"stock-code-input"},null,42,Kt),[[x,m.value.code]]),f("div",zt,k(o.value.code),1)]),f("div",Rt,[a[5]||(a[5]=f("label",{class:"form-label","data-testid":"stock-market-label"},"市场",-1)),_(f("input",{type:"text",class:E(["form-control",{"is-invalid":o.value.market}]),"onUpdate:modelValue":a[1]||(a[1]=e=>m.value.market=e),readonly:!0,"data-testid":"stock-market-input"},null,2),[[x,m.value.market]]),f("div",Ht,k(o.value.market),1)]),f("div",Ft,[a[6]||(a[6]=f("label",{class:"form-label","data-testid":"stock-name-label"},"股票名称",-1)),_(f("input",{type:"text",class:E(["form-control",{"is-invalid":o.value.code_name}]),"onUpdate:modelValue":a[2]||(a[2]=e=>m.value.code_name=e),readonly:!e.editData,"data-testid":"stock-name-input"},null,10,Bt),[[x,m.value.code_name]]),f("div",Jt,k(o.value.code_name),1)]),f("div",Wt,[a[7]||(a[7]=f("label",{class:"form-label","data-testid":"google-code-label"},"谷歌查询代码",-1)),_(f("input",{type:"text",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>m.value.google_code=e),readonly:!e.editData,"data-testid":"google-code-input"},null,8,Xt),[[x,m.value.google_code]])]),f("div",Zt,[a[8]||(a[8]=f("label",{class:"form-label","data-testid":"current-price-label"},"当前股价",-1)),f("input",{type:"text",class:"form-control",value:m.value.current_price,readonly:"","data-testid":"current-price-input"},null,8,Gt),d.value?(y(),b("div",{key:0,class:E({"text-danger":d.value.includes("已存在"),"text-primary":d.value.includes("查询失败")}),"data-testid":"alert-message"},k(d.value),3)):h("",!0)])],32)])),[[l,e.editData?"stock:list:edit":"stock:list:add"]]),f("div",Qt,[f("button",{type:"button",class:"btn btn-secondary",onClick:S,"data-testid":"cancel-btn"},"取消"),_((y(),b("button",{type:"button",class:"btn btn-primary",onClick:V,disabled:n.value,"data-testid":"submit-btn"},[n.value?(y(),b("span",ta)):h("",!0),g(" "+k(e.editData?"保存修改":"确认添加"),1)],8,ea)),[[l,e.editData?"stock:list:edit":"stock:list:add"]])])])])],2),a[9]||(a[9]=f("div",{class:"modal-backdrop fade show","data-testid":"modal-backdrop"},null,-1))])):h("",!0)}}},la=re(aa,[["__scopeId","data-v-f5939394"]]),sa={class:"container-fluid py-3"},na={class:"card"},oa={class:"card-header d-flex justify-content-between align-items-center"},ia={class:"btn-group"},da={class:"card-body border-bottom"},ra={class:"col-md-3"},ca={class:"col-md-6"},ua={class:"col-md-3"},ma={class:"card-body p-0"},va={class:"table-responsive","data-testid":"stock-table-container"},pa={class:"table table-hover align-middle mb-0"},ba=["data-testid"],ya={class:"text-center"},fa={class:"font-monospace"},ha={class:"d-flex justify-content-end gap-1"},ga=["onClick","data-testid"],ka=["onClick","data-testid"],wa={key:1},_a={key:1},xa={key:0,class:"card-footer d-flex justify-content-between align-items-center py-2"},Da={class:"small text-muted"},Ca={class:"pagination pagination-sm mb-0"},Ia={key:0,class:"page-link"},Sa=["onClick","data-testid"],Va={class:"modal fade",id:"deleteConfirmModal",tabindex:"-1","aria-hidden":"true"},Pa={class:"modal-dialog modal-dialog-centered"},La={class:"modal-content"},qa={class:"modal-body"},Ma={__name:"StockManager",setup(e){const t=r(!1),a=r(!1),l=r(null),s=r([]),n=r(1),o=r(1),d=r(0),u=r(!1),v=r({market:"",keyword:""}),D=()=>{l.value=null,a.value=!0},C=()=>{n.value=1,I()},I=()=>i(this,null,(function*(){if(!t.value){t.value=!0;try{const e=new URLSearchParams;v.value.market&&e.append("market",v.value.market),v.value.keyword&&e.append("keyword",v.value.keyword),e.append("page",n.value),e.append("per_page",15);const t=yield c.get("/api/stock/stocks",{params:e});t.data.success&&(s.value=t.data.data.items,o.value=Math.ceil(t.data.data.total/15),d.value=t.data.data.total,n.value=t.data.data.page)}catch(e){}finally{t.value=!1}}})),S=e=>i(this,null,(function*(){var a,l;if(confirm(`确定要删除股票 ${e.code} - ${e.code_name} 吗？`))try{t.value=!0;const a=yield c.delete(`/api/stock/stocks/${e.id}`);if(!a.data.success)throw new Error(a.data.message||"删除失败");alert("删除成功"),1===s.value.length&&n.value>1&&n.value--,yield I()}catch(o){alert((null==(l=null==(a=o.response)?void 0:a.data)?void 0:l.message)||o.message||"删除失败，请重试")}finally{t.value=!1}})),V=e=>{e<1||e>o.value||(n.value=e,I())},L=p((()=>{const e=[];if(o.value<=5)for(let t=1;t<=o.value;t++)e.push(t);else{e.push(1);let t=n.value-1,a=n.value+1;t<=2?(t=2,a=t+2):a>=o.value-1&&(a=o.value-1,t=a-2),t>2&&e.push("...");for(let l=t;l<=a;l++)e.push(l);a<o.value-1&&e.push("..."),e.push(o.value)}return e})),q=(e,t)=>{if(!e)return"-";return`${e} ${"HK"===t?"HKD":"USD"}`};m((()=>{I()}));const O=()=>{u.value=!u.value},Y=()=>{I()},j=()=>{I()},K=()=>{I()};return(e,i)=>{var r,c;const m=M("permission");return y(),b("div",sa,[f("div",na,[f("div",oa,[i[6]||(i[6]=f("h5",{class:"mb-0","data-testid":"stock-manager-title"},"股票管理",-1)),f("div",ia,[_((y(),b("button",{class:"btn btn-primary btn-sm",onClick:D,"data-testid":"add-stock-btn"},i[5]||(i[5]=[f("i",{class:"bi bi-plus-lg"},null,-1),g(" 添加股票 ")]))),[[m,"stock:list:add"]]),f("button",{class:"btn btn-outline-secondary btn-sm",onClick:O,"data-testid":"toggle-search-btn"},[f("i",{class:E(["bi",u.value?"bi-chevron-up":"bi-search"])},null,2),g(" "+k(u.value?"收起":"搜索"),1)])])]),_((y(),b("div",da,[f("form",{onSubmit:w(C,["prevent"]),class:"row g-2 align-items-end"},[f("div",ra,[_(f("select",{class:"form-select form-select-sm","onUpdate:modelValue":i[0]||(i[0]=e=>v.value.market=e),onChange:C,"data-testid":"stock-market-select"},i[7]||(i[7]=[f("option",{value:""},"市场",-1),f("option",{value:"HK"},"香港",-1),f("option",{value:"US"},"美国",-1)]),544),[[A,v.value.market]])]),f("div",ca,[_(f("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":i[1]||(i[1]=e=>v.value.keyword=e),placeholder:"搜索股票代码或名称",onKeyup:U(C,["enter"]),"data-testid":"stock-search-input"},null,544),[[x,v.value.keyword]])]),f("div",ua,[_((y(),b("button",{class:"btn btn-primary btn-sm px-4",type:"button",onClick:C,"data-testid":"stock-search-btn"},i[8]||(i[8]=[g(" 查询 ")]))),[[m,"stock:list:view"]])])],32)])),[[N,u.value],[m,"stock:list:view"]]),_((y(),b("div",ma,[f("div",va,[f("table",pa,[i[13]||(i[13]=f("thead",null,[f("tr",null,[f("th",{style:{width:"60px"}},"市场"),f("th",{style:{width:"80px"}},"代码"),f("th",{style:{width:"120px"}},"名称"),f("th",{style:{width:"200px"}},"谷歌查询代码"),f("th",{style:{width:"100px"}},"当前股价"),f("th",{style:{width:"140px"}},"更新时间"),f("th",{style:{width:"80px"},class:"text-end"},"操作")])],-1)),f("tbody",null,[t.value?(y(),b("tr",_a,i[12]||(i[12]=[f("td",{colspan:"7",class:"text-center py-3"},[f("div",{class:"spinner-border spinner-border-sm text-primary me-2"}),g(" 加载中... ")],-1)]))):(y(),b($,{key:0},[s.value.length?(y(!0),b($,{key:0},T(s.value,(e=>{return y(),b("tr",{key:e.id,"data-testid":"stock-row-"+e.code},[f("td",ya,[f("span",{class:E(["badge","HK"===e.market?"bg-danger":"bg-primary"])},k(e.market),3)]),f("td",fa,k(e.code),1),f("td",null,k(e.code_name),1),f("td",null,k(e.google_name||"-"),1),f("td",null,k(q(e.current_price,e.market)),1),f("td",null,k((t=e.price_updated_at,t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):"-")),1),f("td",null,[f("div",ha,[_((y(),b("button",{class:"btn btn-link btn-xs p-0 text-primary",title:"编辑",onClick:t=>(e=>{l.value=e,a.value=!0})(e),"data-testid":"edit-stock-btn-"+e.code},i[9]||(i[9]=[g(" 编辑 ")]),8,ga)),[[m,"stock:list:edit"]]),_((y(),b("button",{class:"btn btn-link btn-xs p-0 text-danger ms-2",title:"删除",onClick:t=>S(e),"data-testid":"delete-stock-btn-"+e.code},i[10]||(i[10]=[g(" 删除 ")]),8,ka)),[[m,"stock:list:delete"]])])])],8,ba);var t})),128)):(y(),b("tr",wa,i[11]||(i[11]=[f("td",{colspan:"7",class:"text-center py-3"},[f("div",{class:"text-muted"},"暂无数据")],-1)])))],64))])])]),o.value>1?_((y(),b("div",xa,[f("div",Da," 共 "+k(d.value)+" 条记录 ",1),f("nav",null,[f("ul",Ca,[f("li",{class:E(["page-item",{disabled:1===n.value}])},[f("a",{class:"page-link",href:"#",onClick:i[2]||(i[2]=w((e=>V(n.value-1)),["prevent"])),title:"上一页","data-testid":"prev-page-btn"},i[14]||(i[14]=[f("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(y(!0),b($,null,T(L.value,(e=>(y(),b("li",{key:e,class:E(["page-item",{active:n.value===e,disabled:"..."===e}])},["..."===e?(y(),b("span",Ia,k(e),1)):(y(),b("a",{key:1,class:"page-link",href:"#",onClick:w((t=>V(e)),["prevent"]),"data-testid":"page-btn-"+e},k(e),9,Sa))],2)))),128)),f("li",{class:E(["page-item",{disabled:n.value===o.value}])},[f("a",{class:"page-link",href:"#",onClick:i[3]||(i[3]=w((e=>V(n.value+1)),["prevent"])),title:"下一页","data-testid":"next-page-btn"},i[15]||(i[15]=[f("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])),[[m,"stock:list:view"]]):h("",!0)])),[[m,"stock:list:view"]]),P(la,{modelValue:a.value,"onUpdate:modelValue":i[4]||(i[4]=e=>a.value=e),"edit-data":l.value,onSubmit:Y,onClose:j},null,8,["modelValue","edit-data"]),f("div",Va,[f("div",Pa,[f("div",La,[i[20]||(i[20]=f("div",{class:"modal-header"},[f("h5",{class:"modal-title"},"确认删除"),f("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),f("div",qa,[f("p",null,[i[16]||(i[16]=g("确定要删除股票 ")),f("strong",null,k(null==(r=e.selectedStock)?void 0:r.name)+" ("+k(null==(c=e.selectedStock)?void 0:c.code)+")",1),i[17]||(i[17]=g(" 吗？"))]),i[18]||(i[18]=f("div",{class:"alert alert-warning"},[f("i",{class:"bi bi-exclamation-triangle-fill me-2"}),g(" 此操作将删除该股票的所有相关交易记录，且不可恢复！ ")],-1))]),f("div",{class:"modal-footer"},[i[19]||(i[19]=f("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),f("button",{type:"button",class:"btn btn-danger",onClick:K},"确认删除")])])])])])])}}},Ua=re(Ma,[["__scopeId","data-v-9ea2b7f4"]]),Ea={class:"date-input"},Na=["value","placeholder"],Aa={__name:"DateInput",props:{modelValue:String,placeholder:{type:String,default:"YYYY-MM-DD"}},emits:["update:modelValue","enter","blur"],setup(e,{emit:t}){const a=e,l=t,s=r(a.modelValue||""),n=e=>{const t=e.target.value;s.value=t,l("update:modelValue",t)},o=()=>{if(!s.value)return void l("blur","");const e=s.value.trim();let t=null;if(/^[a-zA-Z]+$/.test(e)){const a=new Date;switch(e.toLowerCase()){case"t":case"today":t=i(a);break;case"y":case"yday":a.setDate(a.getDate()-1),t=i(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),t=i(a)}}if(/^[+-]\d+$/.test(e)){const a=parseInt(e),l=new Date;l.setDate(l.getDate()+a),t=i(l)}if(/^\d{3,4}$/.test(e)){const a=(new Date).getFullYear();let l,s;if(3===e.length?(l=parseInt(e[0]),s=parseInt(e.slice(1))):(l=parseInt(e.slice(0,2)),s=parseInt(e.slice(2))),l>=1&&l<=12&&s>=1&&s<=31){const e=new Date(a,l-1,s);d(e)&&(t=i(e))}}const a=["-",".","/"];for(const l of a)if(e.includes(l)){const[a,s]=e.split(l).map(Number),n=(new Date).getFullYear();if(a>=1&&a<=12&&s>=1&&s<=31){const e=new Date(n,a-1,s);if(d(e)){t=i(e);break}}}if(!t){const a=new Date(e);d(a)&&(t=i(a))}t&&(s.value=t,l("update:modelValue",t)),l("blur",s.value)},i=e=>{if(!(e instanceof Date)||isNaN(e))return"";return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},d=e=>e instanceof Date&&!isNaN(e),c=e=>{e.preventDefault(),l("enter",e)};return C((()=>a.modelValue),(e=>{e!==s.value&&(s.value=e)})),m((()=>{if(!a.modelValue){const e=i(new Date);s.value=e,l("update:modelValue",e)}})),(t,a)=>{var l;return y(),b("div",Ea,[f("input",{type:"text",class:E(["form-control",{"is-invalid":null==(l=t.$attrs.class)?void 0:l.includes("is-invalid")}]),value:s.value,onInput:n,onBlur:o,onKeydown:U(c,["enter"]),placeholder:e.placeholder,ref:"input"},null,42,Na)])}}},$a=re(Aa,[["__scopeId","data-v-4521997b"]]),Ta={class:"stock-selector","data-testid":"stock-selector-container"},Oa=["data-testid"],Ya=["onClick","data-testid"],ja={class:"search-container"},Ka=["value","onKeydown","placeholder"],za={class:"dropdown-header d-flex justify-content-between align-items-center","data-testid":"dropdown-header"},Ra={class:"select-all"},Ha=["checked","indeterminate"],Fa={class:"d-flex align-items-center gap-3"},Ba={class:"text-muted","data-testid":"selected-count"},Ja={class:"stock-list","data-testid":"stock-list"},Wa=["onClick","onMouseover","data-testid"],Xa=["checked","data-testid"],Za=["data-testid"],Ga=["data-testid"],Qa={key:1,class:"dropdown-item text-muted","data-testid":"no-results"},el={__name:"StockSelector",props:{modelValue:{type:Array,default:()=>[]},stocks:{type:Array,default:()=>[]},market:{type:String,default:""},placeholder:{type:String,default:"输入代码或名称搜索"}},emits:["update:modelValue","enter"],setup(e,{emit:t}){const a=e,l=t,s=r(""),n=r(!1),o=r(null),d=r(-1),u=r([]),v=r(null),x=()=>i(this,null,(function*(){try{const e=yield c.get("/api/stock/stocks",{params:{market:a.market,per_page:1e3}});e.data.success&&(u.value=e.data.data.items)}catch(e){}})),D=()=>{v.value&&(clearInterval(v.value),v.value=null)},I=p((()=>{let e=u.value;if(a.market&&(e=e.filter((e=>e.market===a.market))),s.value){const t=s.value.toLowerCase();e=e.filter((e=>e.code.toLowerCase().includes(t)||e.name&&e.name.toLowerCase().includes(t)))}return e})),S=p((()=>I.value.length>0&&I.value.every((e=>L(e.code))))),V=p((()=>{const e=I.value.filter((e=>L(e.code))).length;return e>0&&e<I.value.length})),P=e=>{const t=a.stocks.find((t=>t.code===e));if(!t)return e;const l=t.code_name||t.name||"";return`${t.code} - ${l}`},L=e=>a.modelValue.includes(e),q=()=>{const e=[...a.modelValue];S.value?I.value.forEach((t=>{const a=e.indexOf(t.code);-1!==a&&e.splice(a,1)})):I.value.forEach((t=>{e.includes(t.code)||e.push(t.code)})),l("update:modelValue",e)},M=()=>{l("update:modelValue",[]),s.value="",n.value=!1},A=()=>{n.value=!0,nextTick((()=>{var e;null==(e=o.value)||e.focus()}))},Y=e=>{e.stopPropagation(),n.value=!0},j=e=>{const t=e.target.value;if(s.value=t,n.value=!0,d.value=-1,/^\d+$/.test(t)){const e=t.padStart(4,"0"),l=a.stocks.find((t=>"HK"===t.market&&t.code===e));l&&(d.value=I.value.findIndex((e=>e.code===l.code)))}},K=e=>{n.value&&I.value.length>0?(e.preventDefault(),d.value>=0?z(I.value[d.value]):1===I.value.length&&z(I.value[0])):l("enter",e)},z=e=>{const t=[...a.modelValue],i=t.indexOf(e.code);-1===i?t.push(e.code):t.splice(i,1),l("update:modelValue",t),s.value="",n.value=!0,nextTick((()=>{var e;null==(e=o.value)||e.focus()}))},R=e=>{n.value&&0!==I.value.length&&(d.value="up"===e?d.value<=0?I.value.length-1:d.value-1:d.value>=I.value.length-1?0:d.value+1,nextTick((()=>{const e=document.querySelector(".stock-list"),t=null==e?void 0:e.querySelector(".dropdown-item.active");t&&t.scrollIntoView({block:"nearest"})})))},H=e=>{e.target.closest(".stock-selector")||(n.value=!1,s.value="")};return C(n,(e=>{e||(d.value=-1,s.value="")})),m((()=>{x(),D(),v.value=setInterval(x,6e4),document.addEventListener("click",H)})),O((()=>{D(),document.removeEventListener("click",H)})),(t,i)=>(y(),b("div",Ta,[f("div",{class:"selected-items form-control","data-testid":"selected-items-container",onClick:A},[(y(!0),b($,null,T(e.modelValue,(e=>(y(),b("div",{key:e,class:"selected-tag","data-testid":"selected-tag-"+e},[g(k(P(e))+" ",1),f("button",{type:"button",class:"btn-close",onClick:w((t=>(e=>{const t=a.modelValue.filter((t=>t!==e));l("update:modelValue",t)})(e)),["stop"]),"data-testid":"remove-stock-btn-"+e},null,8,Ya)],8,Oa)))),128)),_(f("div",ja,[f("input",{type:"text",class:"search-input",value:s.value,onInput:j,onKeydown:[U(w(K,["prevent"]),["enter"]),i[0]||(i[0]=U(w((e=>R("up")),["prevent"]),["up"])),i[1]||(i[1]=U(w((e=>R("down")),["prevent"]),["down"]))],placeholder:e.placeholder,ref_key:"input",ref:o,onClick:w(Y,["stop"]),"data-testid":"stock-search-input"},null,40,Ka)],512),[[N,n.value||0===e.modelValue.length]])]),f("div",{class:E(["dropdown-menu",{show:n.value}]),"data-testid":"dropdown-menu"},[f("div",za,[f("div",Ra,[f("input",{type:"checkbox",class:"form-check-input me-2",checked:S.value,onChange:q,indeterminate:V.value,"data-testid":"select-all-checkbox"},null,40,Ha),i[2]||(i[2]=f("span",{"data-testid":"select-all-text"},"全选",-1))]),f("div",Fa,[f("small",Ba,"已选 "+k(e.modelValue.length)+" 项",1),e.modelValue.length>0?(y(),b("button",{key:0,type:"button",class:"btn btn-link btn-sm p-0 text-danger",onClick:M,"data-testid":"clear-selected-btn"}," 清空选择 ")):h("",!0)])]),f("div",Ja,[I.value.length>0?(y(!0),b($,{key:0},T(I.value,((e,t)=>(y(),b("a",{key:e.code,class:E(["dropdown-item",{active:t===d.value}]),href:"#",onClick:w((t=>z(e)),["prevent"]),onMouseover:e=>d.value=t,"data-testid":"stock-item-"+e.code},[f("input",{type:"checkbox",class:"form-check-input me-2",checked:L(e.code),"data-testid":"stock-checkbox-"+e.code},null,8,Xa),f("span",{class:"stock-code","data-testid":"stock-code-"+e.code},k(e.code),9,Za),f("span",{class:"stock-name","data-testid":"stock-name-"+e.code},k(e.code_name||e.name||""),9,Ga)],42,Wa)))),128)):(y(),b("div",Qa," 无匹配结果 "))])],2)]))}},tl=re(el,[["__scopeId","data-v-c75b30d1"]]),al={class:"modal fade",id:"transactionSplitModal",tabindex:"-1","aria-labelledby":"transactionSplitModalLabel","aria-hidden":"true"},ll={class:"modal-dialog modal-xl"},sl={class:"modal-content"},nl={class:"modal-body"},ol={key:0,class:"card mb-3"},il={class:"card-body"},dl={class:"row"},rl={class:"col-md-6"},cl={class:"mb-3 row"},ul={class:"col-sm-8"},ml={class:"form-control-plaintext"},vl={class:"mb-3 row"},pl={class:"col-sm-8"},bl={class:"form-control-plaintext"},yl={class:"mb-3 row"},fl={class:"col-sm-8"},hl={class:"form-control-plaintext"},gl={class:"mb-3 row"},kl={class:"col-sm-8"},wl={class:"form-control-plaintext"},_l={class:"col-md-6"},xl={class:"mb-3 row"},Dl={class:"col-sm-8"},Cl={class:"form-control-plaintext"},Il={class:"mb-3 row"},Sl={class:"col-sm-8"},Vl={class:"form-control-plaintext"},Pl={class:"mb-3 row"},Ll={class:"col-sm-8"},ql={class:"form-control-plaintext"},Ml={class:"mb-3 row"},Ul={class:"col-sm-8"},El={class:"form-control-plaintext"},Nl={key:1,class:"card mb-3"},Al={class:"card-body"},$l={class:"table-responsive"},Tl={class:"table table-bordered"},Ol=["onUpdate:modelValue","onChange"],Yl=["value"],jl={class:"input-group"},Kl=["onUpdate:modelValue","onInput"],zl=["onUpdate:modelValue","max","onInput"],Rl={class:"form-control-plaintext text-end"},Hl={class:"form-control-plaintext text-end"},Fl=["onClick","disabled"],Bl={class:"table-light"},Jl={class:"text-end fw-bold"},Wl={class:"text-end fw-bold"},Xl={key:0,class:"alert alert-warning"},Zl={key:1,class:"alert alert-warning"},Gl={key:2,class:"card"},Ql={class:"card-body p-0"},es={class:"table-responsive"},ts={class:"table table-bordered mb-0"},as={key:3,class:"text-center py-5"},ls={key:4,class:"alert alert-warning"},ss={class:"modal-footer"},ns=["disabled"],os={key:0,class:"spinner-border spinner-border-sm me-1"},is={__name:"TransactionSplitModal",props:{transactionId:{type:[Number,String],default:null},transactionCode:{type:String,default:""}},emits:["saved"],setup(e,{expose:t,emit:a}){const l=e,s=a,n=Y(),o=r(null),d=r([]),u=r([]),v=r([]),w=r(!1),D=r(!1),I=r(!1),S=r(null),V=e=>null==e?"-":Number(e).toLocaleString(),P=e=>null==e?"-":Number(e).toLocaleString("zh-HK",{minimumFractionDigits:2,maximumFractionDigits:2}),L=p((()=>d.value.reduce(((e,t)=>e+Number(t.ratio||0)),0))),q=p((()=>d.value.reduce(((e,t)=>e+Number(t.quantity||0)),0))),M=p((()=>d.value.reduce(((e,t)=>e+Number(t.amount||0)),0))),U=p((()=>d.value.reduce(((e,t)=>e+Number(t.fees||0)),0))),N=p((()=>{var e;return!o.value||Math.abs(L.value-100)>.01||q.value!==(null==(e=o.value)?void 0:e.total_quantity)||d.value.some((e=>!e.holder_id))})),O=()=>{const e=document.getElementById("transactionSplitModal");e&&(S.value&&S.value.dispose(),S.value=new j(e,{backdrop:"static",keyboard:!1}),e.addEventListener("hidden.bs.modal",(()=>{o.value=null,d.value=[]})))},K=()=>{S.value&&S.value.hide()},z=(e=null)=>i(this,null,(function*(){const t=e||l.transactionCode,a=l.transactionId;if(t||a){w.value=!0,D.value=!1,o.value=null,d.value=[];try{let e;t?e=yield c.get("/api/transaction/get_by_code",{params:{transaction_code:t}}):a&&(e=yield c.get(`/api/transaction/${a}`)),e&&e.data.success&&(o.value=e.data.data,o.value.has_splits?(H(),n.info("该交易已有分单记录，请查看分单历史")):(F(),H()))}catch(s){s.response&&404===s.response.status?(D.value=!0,n.error("未找到交易记录，请检查交易编号是否正确")):n.error("查询交易记录失败，请稍后重试")}finally{w.value=!1}}})),R=()=>i(this,null,(function*(){try{const e=yield c.get("/api/transaction/get_users");e.data.success&&(u.value=e.data.data)}catch(e){n.error("加载持有人列表失败，请稍后重试")}})),H=()=>i(this,null,(function*(){if(o.value&&o.value.id)try{const e=yield c.get("/api/transaction/splits",{params:{transaction_id:o.value.id}});e.data.success&&(v.value=e.data.splits)}catch(e){n.error("加载分单历史失败，请稍后重试")}})),F=()=>{const e=100-L.value,t=o.value?o.value.total_quantity-q.value:0,a={holder_id:"",holder_name:"",ratio:e>0?e:0,quantity:t>0?t:0,amount:0,fees:0};B(a),d.value.push(a)},B=e=>{if(!o.value)return;const t=Number(e.ratio)/100;e.amount=Number((o.value.total_amount*t).toFixed(2)),e.fees=Number((o.value.total_fees*t).toFixed(2))},J=()=>i(this,null,(function*(){var e,t;if(!N.value){I.value=!0;try{const e={transaction_id:o.value.id,splits:d.value.map((e=>({holder_id:e.holder_id,holder_name:e.holder_name,ratio:e.ratio/100,quantity:e.quantity,amount:e.amount,fees:e.fees})))},t=yield c.post("/api/transaction/split",e);t.data.success?(n.success("分单保存成功"),H(),d.value=[],s("saved"),K()):n.error(`保存失败: ${t.data.message}`)}catch(a){a.response,n.error(`保存分单失败: ${(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"未知错误"}`)}finally{I.value=!1}}}));return C(o,(()=>{o.value&&d.value.forEach((e=>{B(e)}))}),{deep:!0}),C((()=>[l.transactionId,l.transactionCode]),(()=>{(l.transactionId||l.transactionCode)&&z()}),{immediate:!0}),m((()=>{setTimeout((()=>{O(),R()}),100)})),t({showModal:()=>{S.value||O(),0===u.value.length&&R(),S.value&&S.value.show()},hideModal:K,loadTransaction:z,loadUsers:R}),(e,t)=>(y(),b("div",al,[f("div",ll,[f("div",sl,[f("div",{class:"modal-header"},[t[0]||(t[0]=f("h5",{class:"modal-title"},"交易分单",-1)),f("button",{type:"button",class:"btn-close",onClick:K})]),f("div",nl,[o.value?(y(),b("div",ol,[t[9]||(t[9]=f("div",{class:"card-header bg-light"},[f("h5",{class:"mb-0"},"交易详情")],-1)),f("div",il,[f("div",dl,[f("div",rl,[f("div",cl,[t[1]||(t[1]=f("label",{class:"col-sm-4 col-form-label"},"交易编号",-1)),f("div",ul,[f("p",ml,k(o.value.transaction_code),1)])]),f("div",vl,[t[2]||(t[2]=f("label",{class:"col-sm-4 col-form-label"},"交易日期",-1)),f("div",pl,[f("p",bl,k(o.value.transaction_date),1)])]),f("div",yl,[t[3]||(t[3]=f("label",{class:"col-sm-4 col-form-label"},"股票代码",-1)),f("div",fl,[f("p",hl,[f("span",{class:E(["badge me-1","HK"===o.value.market?"bg-danger":"bg-primary"])},k(o.value.market),3),g(" "+k(o.value.stock_code),1)])])]),f("div",gl,[t[4]||(t[4]=f("label",{class:"col-sm-4 col-form-label"},"股票名称",-1)),f("div",kl,[f("p",wl,k(o.value.stock_name),1)])])]),f("div",_l,[f("div",xl,[t[5]||(t[5]=f("label",{class:"col-sm-4 col-form-label"},"交易类型",-1)),f("div",Dl,[f("p",Cl,[f("span",{class:E(["badge","buy"===o.value.transaction_type.toLowerCase()?"bg-success":"bg-danger"])},k("buy"===o.value.transaction_type.toLowerCase()?"买入":"卖出"),3)])])]),f("div",Il,[t[6]||(t[6]=f("label",{class:"col-sm-4 col-form-label"},"总数量",-1)),f("div",Sl,[f("p",Vl,k(V(o.value.total_quantity)),1)])]),f("div",Pl,[t[7]||(t[7]=f("label",{class:"col-sm-4 col-form-label"},"总金额",-1)),f("div",Ll,[f("p",ql,k(P(o.value.total_amount)),1)])]),f("div",Ml,[t[8]||(t[8]=f("label",{class:"col-sm-4 col-form-label"},"总费用",-1)),f("div",Ul,[f("p",El,k(P(o.value.total_fees)),1)])])])])])])):h("",!0),o.value?(y(),b("div",Nl,[f("div",{class:"card-header bg-light d-flex justify-content-between align-items-center"},[t[11]||(t[11]=f("h5",{class:"mb-0"},"分单设置",-1)),f("button",{class:"btn btn-sm btn-outline-primary",onClick:F},t[10]||(t[10]=[f("i",{class:"bi bi-plus-circle"},null,-1),g(" 添加持有人 ")]))]),f("div",Al,[f("div",$l,[f("table",Tl,[t[17]||(t[17]=f("thead",{class:"table-light"},[f("tr",null,[f("th",{style:{width:"30%"}},"持有人"),f("th",{style:{width:"15%"}},"分配比例 (%)"),f("th",{style:{width:"15%"}},"数量"),f("th",{style:{width:"15%"}},"金额"),f("th",{style:{width:"15%"}},"费用"),f("th",{style:{width:"10%"}},"操作")])],-1)),f("tbody",null,[(y(!0),b($,null,T(d.value,((e,a)=>(y(),b("tr",{key:a},[f("td",null,[_(f("select",{class:"form-select","onUpdate:modelValue":t=>e.holder_id=t,onChange:t=>(e=>{if(e.holder_id){const t=u.value.find((t=>t.id===e.holder_id));e.holder_name=t?t.display_name:`持有人ID: ${e.holder_id}`}else e.holder_name=""})(e)},[t[12]||(t[12]=f("option",{value:""},"请选择持有人",-1)),(y(!0),b($,null,T(u.value,(e=>(y(),b("option",{key:e.id,value:e.id},k(e.display_name),9,Yl)))),128))],40,Ol),[[A,e.holder_id]])]),f("td",null,[f("div",jl,[_(f("input",{type:"number",class:"form-control","onUpdate:modelValue":t=>e.ratio=t,min:"0",max:"100",step:"0.01",onInput:t=>(e=>{e.ratio<0&&(e.ratio=0),e.ratio>100&&(e.ratio=100),o.value&&(e.quantity=Math.round(o.value.total_quantity*(e.ratio/100))),B(e)})(e)},null,40,Kl),[[x,e.ratio]]),t[13]||(t[13]=f("span",{class:"input-group-text"},"%",-1))])]),f("td",null,[_(f("input",{type:"number",class:"form-control","onUpdate:modelValue":t=>e.quantity=t,min:"0",max:o.value.total_quantity,onInput:t=>(e=>{e.quantity<0&&(e.quantity=0),o.value&&e.quantity>o.value.total_quantity&&(e.quantity=o.value.total_quantity),o.value&&o.value.total_quantity>0&&(e.ratio=e.quantity/o.value.total_quantity*100),B(e)})(e)},null,40,zl),[[x,e.quantity]])]),f("td",null,[f("p",Rl,k(P(e.amount)),1)]),f("td",null,[f("p",Hl,k(P(e.fees)),1)]),f("td",null,[f("button",{class:"btn btn-sm btn-outline-danger",onClick:e=>(e=>{d.value.length<=1||(d.value.splice(e,1),d.value.forEach((e=>{B(e)})))})(a),disabled:d.value.length<=1},t[14]||(t[14]=[f("i",{class:"bi bi-trash"},null,-1)]),8,Fl)])])))),128)),f("tr",Bl,[t[15]||(t[15]=f("td",{class:"fw-bold"},"合计",-1)),f("td",{class:E(["text-end fw-bold",Math.abs(L.value-100)>.01?"text-danger":""])},k(L.value.toFixed(2))+"% ",3),f("td",{class:E(["text-end fw-bold",q.value!==o.value.total_quantity?"text-danger":""])},k(V(q.value)),3),f("td",Jl,k(P(M.value)),1),f("td",Wl,k(P(U.value)),1),t[16]||(t[16]=f("td",null,null,-1))])])])]),Math.abs(L.value-100)>.01?(y(),b("div",Xl,t[18]||(t[18]=[f("i",{class:"bi bi-exclamation-triangle"},null,-1),g(" 分配比例总和必须等于100% ")]))):h("",!0),q.value!==o.value.total_quantity?(y(),b("div",Zl,t[19]||(t[19]=[f("i",{class:"bi bi-exclamation-triangle"},null,-1),g(" 分配数量总和必须等于交易总数量 ")]))):h("",!0)])])):h("",!0),o.value&&v.value.length>0?(y(),b("div",Gl,[t[21]||(t[21]=f("div",{class:"card-header bg-light"},[f("h5",{class:"mb-0"},"分单历史")],-1)),f("div",Ql,[f("div",es,[f("table",ts,[t[20]||(t[20]=f("thead",{class:"table-light"},[f("tr",null,[f("th",null,"持有人"),f("th",null,"分配比例"),f("th",null,"数量"),f("th",null,"金额"),f("th",null,"费用"),f("th",null,"创建时间")])],-1)),f("tbody",null,[(y(!0),b($,null,T(v.value,((e,t)=>(y(),b("tr",{key:t},[f("td",null,k(e.holder_name),1),f("td",null,k(e.split_ratio)+"%",1),f("td",null,k(V(e.total_quantity)),1),f("td",null,k(P(e.total_amount)),1),f("td",null,k(P(e.total_fees)),1),f("td",null,k(e.created_at),1)])))),128))])])])])])):h("",!0),w.value?(y(),b("div",as,t[22]||(t[22]=[f("div",{class:"spinner-border text-primary",role:"status"},[f("span",{class:"visually-hidden"},"加载中...")],-1),f("p",{class:"mt-2"},"正在加载交易数据...",-1)]))):h("",!0),D.value?(y(),b("div",ls,t[23]||(t[23]=[f("i",{class:"bi bi-exclamation-triangle"},null,-1),g(" 未找到交易记录，请检查交易编号是否正确 ")]))):h("",!0)]),f("div",ss,[f("button",{type:"button",class:"btn btn-secondary",onClick:K},"关闭"),o.value?(y(),b("button",{key:0,type:"button",class:"btn btn-primary",onClick:J,disabled:N.value||I.value},[I.value?(y(),b("span",os)):h("",!0),t[24]||(t[24]=g(" 保存分单 "))],8,ns)):h("",!0)])])])]))}},ds=re(is,[["__scopeId","data-v-11e9bffb"]]),rs={class:"card"},cs={class:"card-header d-flex justify-content-between align-items-center"},us={class:"btn-group"},ms={class:"card-body border-bottom","data-testid":"search-form-container"},vs={class:"col-auto",style:{width:"160px"}},ps=["value"],bs={class:"col-auto",style:{width:"160px"}},ys=["value"],fs={class:"col-auto",style:{width:"100px"}},hs={class:"col-auto",style:{width:"160px"}},gs=["onKeydown"],ks={class:"col",style:{"min-width":"200px"}},ws={class:"col-auto"},_s=["disabled"],xs={class:"card-body p-0","data-testid":"transaction-table-container"},Ds={class:"table-responsive"},Cs={class:"table table-hover table-sm mb-0"},Is=["data-testid"],Ss=["onClick"],Vs={class:"text-center"},Ps={class:"text-muted"},Ls={class:"text-end"},qs={class:"text-end"},Ms={class:"text-end"},Us={class:"text-end"},Es={class:"text-end"},Ns={class:"text-end"},As={class:"text-end"},$s={class:"text-end"},Ts={class:"text-end"},Os={class:"d-flex justify-content-end gap-1"},Ys=["onClick","data-testid"],js=["onClick","data-testid"],Ks=["onClick","data-testid"],zs=["onClick","data-testid"],Rs=["onClick","data-testid"],Hs={class:"badge bg-light text-dark"},Fs={class:"text-muted"},Bs={class:"text-end"},Js={class:"text-end"},Ws={class:"text-end"},Xs={class:"text-end"},Zs={class:"text-end"},Gs={class:"text-end"},Qs={class:"text-end"},en={class:"text-end"},tn={class:"text-end"},an={key:1},ln={key:2},sn={key:0,class:"card-footer d-flex justify-content-center"},nn={class:"pagination pagination-sm mb-0"},on={key:0,class:"page-link"},dn=["onClick"],rn=re({__name:"TransactionList",setup(e){const d=D(),{message:u}=de(),v=r(!1);r(!1),r(null);const C=r([]),S=r([]),V=r(1),L=r(1);r(0);const q=r(!0),O=r({startDate:"",endDate:"",market:"",stockCodes:[],transactionCode:""}),Y=r(""),j=r(""),K=r(null),z=r(null),R=r(null),H=r(null),F=r(null),B=(e,t)=>{var a,l,s,n;switch(e.preventDefault(),t){case"endDate":null==(a=z.value)||a.focus();break;case"market":null==(l=H.value)||l.focus();break;case"transactionCode":null==(s=R.value)||s.focus();break;case"search":null==(n=F.value)||n.focus(),ae()}},J=e=>{const t=e.target.value;Y.value=t,O.value.startDate=t},W=()=>{if(!Y.value)return void(O.value.startDate="");const e=Y.value.trim();let t=null;if(/^[a-zA-Z]+$/.test(e)){const a=new Date;switch(e.toLowerCase()){case"t":case"today":t=re(a);break;case"y":case"yday":a.setDate(a.getDate()-1),t=re(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),t=re(a)}}if(/^[+-]\d+$/.test(e)){const a=parseInt(e),l=new Date;l.setDate(l.getDate()+a),t=re(l)}if(/^\d{3,4}$/.test(e)){const a=(new Date).getFullYear();let l,s;if(3===e.length?(l=parseInt(e[0]),s=parseInt(e.slice(1))):(l=parseInt(e.slice(0,2)),s=parseInt(e.slice(2))),l>=1&&l<=12&&s>=1&&s<=31){const e=new Date(a,l-1,s);G(e)&&(t=re(e))}}const a=["-",".","/"];for(const l of a)if(e.includes(l)){const[a,s]=e.split(l).map(Number),n=(new Date).getFullYear();if(a>=1&&a<=12&&s>=1&&s<=31){const e=new Date(n,a-1,s);if(G(e)){t=re(e);break}}}if(!t){const a=new Date(e);G(a)&&(t=re(a))}t&&(Y.value=t,O.value.startDate=t,O.value.endDate&&t>O.value.endDate&&(O.value.endDate=t,j.value=t))},X=e=>{const t=e.target.value;j.value=t,O.value.endDate=t},Z=()=>{if(!j.value)return void(O.value.endDate="");const e=j.value.trim();let t=null;if(/^[a-zA-Z]+$/.test(e)){const a=new Date;switch(e.toLowerCase()){case"t":case"today":t=re(a);break;case"y":case"yday":a.setDate(a.getDate()-1),t=re(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),t=re(a)}}if(/^[+-]\d+$/.test(e)){const a=parseInt(e),l=new Date;l.setDate(l.getDate()+a),t=re(l)}if(/^\d{3,4}$/.test(e)){const a=(new Date).getFullYear();let l,s;if(3===e.length?(l=parseInt(e[0]),s=parseInt(e.slice(1))):(l=parseInt(e.slice(0,2)),s=parseInt(e.slice(2))),l>=1&&l<=12&&s>=1&&s<=31){const e=new Date(a,l-1,s);G(e)&&(t=re(e))}}const a=["-",".","/"];for(const l of a)if(e.includes(l)){const[a,s]=e.split(l).map(Number),n=(new Date).getFullYear();if(a>=1&&a<=12&&s>=1&&s<=31){const e=new Date(n,a-1,s);if(G(e)){t=re(e);break}}}if(!t){const a=new Date(e);G(a)&&(t=re(a))}t&&(j.value=t,O.value.endDate=t,O.value.startDate&&t<O.value.startDate&&(O.value.startDate=t,Y.value=t))},G=e=>e instanceof Date&&!isNaN(e),Q=()=>i(this,null,(function*(){try{const e=yield c.get("/api/stock/stocks");e.data.success&&(S.value=e.data.data.items)}catch(e){}})),ee=(e=!1)=>i(this,null,(function*(){var i;if(!v.value||e){v.value=!0;try{const e=new URLSearchParams;O.value.startDate&&e.append("start_date",O.value.startDate),O.value.endDate&&e.append("end_date",O.value.endDate),O.value.market&&e.append("market",O.value.market),O.value.stockCodes.length>0&&O.value.stockCodes.forEach((t=>e.append("stock_codes[]",t))),O.value.transactionCode&&e.append("transaction_code",O.value.transactionCode),e.append("page",V.value),e.append("per_page",15),e.append("_t",Date.now()+Math.random());const i=yield c.get("/api/stock/transactions/",{params:e,withCredentials:!0});if(i.data.success&&(C.value=i.data.data.items.map((e=>{return e.splits&&e.splits.length>0&&(e.splits=e.splits.map((e=>(e.holder_name,e)))),i=((e,t)=>{for(var a in t||(t={}))s.call(t,a)&&o(e,a,t[a]);if(l)for(var a of l(t))n.call(t,a)&&o(e,a,t[a]);return e})({},e),d={transaction_type:e.transaction_type.toLowerCase()},t(i,a(d));var i,d})),L.value=i.data.data.pages,V.value>L.value&&L.value>0))return V.value=L.value,void(yield ee(!0))}catch(r){if(401===(null==(i=r.response)?void 0:i.status))return u.error("登录已过期，请重新登录"),void d.push("/login");u.error("获取交易记录失败，请稍后重试")}finally{v.value=!1}}})),te=()=>{q.value=!q.value},ae=()=>{V.value=1,ee()},le=()=>{ae(),O.value.transactionCode=""},se=()=>{O.value={startDate:"",endDate:"",market:"",stockCodes:[],transactionCode:""},Y.value="",j.value="",ae()},ne=e=>i(this,null,(function*(){var t,a;if(window.confirm("确定要删除这条交易记录吗？"))try{v.value=!0;const l=e.id,s=yield c.delete(`/api/stock/transactions/${l}`,{withCredentials:!0});if(!s.data||!s.data.success)throw new Error((null==(a=s.data)?void 0:a.message)||"删除交易记录失败");u.success((null==(t=s.data)?void 0:t.message)||"交易记录删除成功"),yield new Promise((e=>setTimeout(e,1500))),1===C.value.length&&V.value>1&&V.value--,C.value=[],yield ee(!0),setTimeout((()=>{ee(!0)}),1e3)}catch(l){let e="删除失败，请稍后重试";if(l&&l.response){const t=l.response.status;if(401===t)return e="登录已过期，请重新登录",u.error(e),void d.push("/login");404===t?e="交易记录不存在或已被删除":l.response.data&&"string"==typeof l.response.data.message&&(e=l.response.data.message)}else l&&"string"==typeof l.message&&(e=l.message);u.error(e)}finally{v.value=!1;try{yield ee(!0)}catch(s){}}})),oe=e=>i(this,null,(function*(){try{if(!(yield c.get(`/api/stock/transactions/${e.id}`)).data.success)throw new Error("交易记录不存在或已被删除");d.push(`/transactions/edit/${e.id}`)}catch(t){u.error(t.message||"编辑交易记录失败，请稍后重试")}})),ie=()=>{d.push("/transactions/add")},re=e=>e?new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"):"-",ce=(e,t=2)=>null==e?"-":Number(e).toLocaleString("zh-HK",{minimumFractionDigits:t,maximumFractionDigits:t}),ue=e=>{e<1||e>L.value||e===V.value||(V.value=e,ee())},me=p((()=>{const e=[];let t=V.value-2,a=V.value+2+1;t<1&&(t=1,a=Math.min(5,L.value+1)),a>L.value&&(a=L.value+1,t=Math.max(1,L.value-4));for(let l=t;l<a;l++)e.push(l);return t>1&&(e.unshift("..."),e.unshift(1)),a<=L.value&&(e.push("..."),e.push(L.value)),e})),ve=p((()=>[...C.value].sort(((e,t)=>{const a=new Date(e.transaction_date).getTime(),l=new Date(t.transaction_date).getTime();if(a!==l)return l-a;const s=new Date(e.created_at).getTime(),n=new Date(t.created_at).getTime();return s!==n?n-s:t.id-e.id})))),pe=r([]),be=e=>{const t=pe.value.indexOf(e);-1===t?pe.value.push(e):pe.value.splice(t,1)},ye=r(null);return m((()=>{Q(),ee(),I((()=>{ye.value&&ye.value.loadUsers()}))})),(e,t)=>{const a=M("permission");return y(),b($,null,[f("div",rs,[f("div",cs,[t[13]||(t[13]=f("h5",{class:"mb-0","data-testid":"transaction-list-title"},"交易记录",-1)),f("div",us,[_((y(),b("button",{class:"btn btn-primary btn-sm",onClick:ie,"data-testid":"add-transaction-btn"},t[12]||(t[12]=[f("i",{class:"fas fa-plus me-1"},null,-1),g("添加记录 ")]))),[[a,"transaction:records:add"]]),f("button",{class:"btn btn-outline-secondary btn-sm",onClick:te,"data-testid":"toggle-search-btn"},[f("i",{class:E([["fas",q.value?"fa-chevron-up":"fa-search"],"me-1"])},null,2),g(" "+k(q.value?"收起":"搜索"),1)])])]),_(f("div",ms,[f("form",{onSubmit:w(ae,["prevent"]),class:"row g-2 align-items-end"},[f("div",vs,[t[14]||(t[14]=f("label",{class:"form-label small","data-testid":"start-date-label"},"开始日期",-1)),f("input",{type:"text",class:"form-control form-control-sm",value:Y.value,onInput:J,onBlur:W,onKeydown:[t[0]||(t[0]=U(w((e=>B(e,"endDate")),["prevent"]),["enter"])),t[1]||(t[1]=U((e=>B(e,"endDate")),["tab"]))],placeholder:"YYYY-MM-DD",ref_key:"startDate",ref:K,"data-testid":"start-date-input"},null,40,ps)]),f("div",bs,[t[15]||(t[15]=f("label",{class:"form-label small","data-testid":"end-date-label"},"结束日期",-1)),f("input",{type:"text",class:"form-control form-control-sm",value:j.value,onInput:X,onBlur:Z,onKeydown:[t[2]||(t[2]=U(w((e=>B(e,"market")),["prevent"]),["enter"])),t[3]||(t[3]=U((e=>B(e,"market")),["tab"]))],placeholder:"YYYY-MM-DD",ref_key:"endDate",ref:z,"data-testid":"end-date-input"},null,40,ys)]),f("div",fs,[t[17]||(t[17]=f("label",{class:"form-label small","data-testid":"market-label"},"市场",-1)),_(f("select",{class:"form-select form-select-sm","onUpdate:modelValue":t[4]||(t[4]=e=>O.value.market=e),ref_key:"market",ref:H,onKeydown:[t[5]||(t[5]=U(w((e=>B(e,"transactionCode")),["prevent"]),["enter"])),t[6]||(t[6]=U((e=>B(e,"transactionCode")),["tab"]))],"data-testid":"market-select"},t[16]||(t[16]=[f("option",{value:""},"全部",-1),f("option",{value:"HK"},"HK",-1),f("option",{value:"USA"},"USA",-1)]),544),[[A,O.value.market]])]),f("div",hs,[t[18]||(t[18]=f("label",{class:"form-label small","data-testid":"transaction-code-label"},"交易编号",-1)),_(f("input",{type:"text",class:"form-control form-control-sm","onUpdate:modelValue":t[7]||(t[7]=e=>O.value.transactionCode=e),ref_key:"transactionCode",ref:R,onKeydown:[U(w(le,["prevent"]),["enter"]),t[8]||(t[8]=U((e=>B(e,"search")),["tab"]))],placeholder:"输入交易编号","data-testid":"transaction-code-input"},null,40,gs),[[x,O.value.transactionCode]])]),f("div",ks,[t[19]||(t[19]=f("label",{class:"form-label small","data-testid":"stock-codes-label"},"股票代码",-1)),P(tl,{modelValue:O.value.stockCodes,"onUpdate:modelValue":t[9]||(t[9]=e=>O.value.stockCodes=e),stocks:S.value,market:O.value.market,"data-testid":"stock-selector"},null,8,["modelValue","stocks","market"])]),f("div",ws,[f("button",{type:"submit",class:"btn btn-sm btn-primary",style:{width:"80px"},disabled:v.value,ref_key:"searchBtn",ref:F,"data-testid":"search-btn"},t[20]||(t[20]=[f("i",{class:"fas fa-search"},null,-1),g(" 查询 ")]),8,_s)]),f("div",{class:"col-auto"},[f("button",{type:"button",class:"btn btn-sm btn-outline-secondary",style:{width:"80px"},onClick:se,"data-testid":"reset-btn"},t[21]||(t[21]=[f("i",{class:"fas fa-undo"},null,-1),g(" 重置 ")]))])],32)],512),[[N,q.value]]),_((y(),b("div",xs,[f("div",Ds,[f("table",Cs,[t[38]||(t[38]=f("thead",{class:"table-light"},[f("tr",null,[f("th",{style:{width:"100px"},class:"text-center"},"日期"),f("th",{style:{width:"40px"},class:"text-center"},"市场"),f("th",{style:{width:"120px"},class:"text-center"},"股票代码"),f("th",{style:{width:"100px"},class:"text-center"},"交易编号"),f("th",{style:{width:"50px"},class:"text-center"},"买卖"),f("th",{style:{width:"90px"},class:"text-center"},"成交明细"),f("th",{style:{width:"70px"},class:"text-center"},"总股数"),f("th",{style:{width:"70px"},class:"text-end"},"平均价"),f("th",{style:{width:"80px"},class:"text-end"},"总金额"),f("th",{style:{width:"70px"},class:"text-end"},"经纪佣金"),f("th",{style:{width:"70px"},class:"text-end"},"交易征费"),f("th",{style:{width:"70px"},class:"text-end"},"印花税"),f("th",{style:{width:"70px"},class:"text-end"},"交易费"),f("th",{style:{width:"70px"},class:"text-end"},"存入证券费"),f("th",{style:{width:"70px"},class:"text-end"},"手续费"),f("th",{style:{width:"80px"},class:"text-end"},"净金额"),f("th",{style:{width:"70px"},class:"text-center"},"操作")])],-1)),f("tbody",null,[!v.value&&C.value.length>0?(y(!0),b($,{key:0},T(ve.value,(e=>(y(),b($,{key:e.id},[f("tr",{"data-testid":"transaction-row-"+e.id,class:E({"has-splits":e.splits&&e.splits.length>=2})},[f("td",null,[g(k(re(e.transaction_date))+" ",1),e.splits&&e.splits.length>=2?(y(),b("span",{key:0,class:"ms-1 badge bg-info",style:{cursor:"pointer"},onClick:t=>be(e.id)},[f("i",{class:E(["fas",pe.value.includes(e.id)?"fa-chevron-down":"fa-chevron-right"])},null,2),t[22]||(t[22]=g(" 分单 "))],8,Ss)):h("",!0)]),f("td",null,k(e.market),1),f("td",Vs,[g(k(e.stock_code)+" ",1),t[23]||(t[23]=f("br",null,null,-1)),f("small",Ps,k(e.stock_name),1)]),f("td",null,k(e.transaction_code.trim()),1),f("td",null,[f("span",{class:E(["badge","buy"===e.transaction_type.toLowerCase()?"bg-danger":"bg-success"])},k("buy"===e.transaction_type.toLowerCase()?"买入":"卖出"),3)]),f("td",null,[e.details&&e.details.length?(y(!0),b($,{key:0},T(e.details,((e,t)=>(y(),b("div",{key:t,class:"text-nowrap"},k(ce(e.quantity,0))+"股@"+k(ce(e.price,3)),1)))),128)):(y(),b($,{key:1},[g(k(ce(e.total_quantity,0))+"股@"+k(ce(e.total_amount/e.total_quantity,3)),1)],64))]),f("td",Ls,k(ce(e.total_quantity,0)),1),f("td",qs,k(ce(e.total_amount/e.total_quantity,3)),1),f("td",Ms,k(ce(e.total_amount)),1),f("td",Us,k(ce(e.broker_fee)),1),f("td",Es,k(ce(e.transaction_levy)),1),f("td",Ns,k(ce(e.stamp_duty)),1),f("td",As,k(ce(e.trading_fee)),1),f("td",$s,k(ce(e.deposit_fee)),1),f("td",Ts,k(ce(e.total_fees)),1),f("td",{class:E(["text-end",{"text-danger":"buy"===e.transaction_type.toLowerCase(),"text-success":"sell"===e.transaction_type.toLowerCase()}])},[g(k("buy"===e.transaction_type.toLowerCase()?"-":"")+k(ce(e.net_amount))+" ",1),e.deposit_fee>0?(y(),b($,{key:0},[t[24]||(t[24]=f("br",null,null,-1)),f("small",{class:E({"text-danger":"buy"===e.transaction_type.toLowerCase(),"text-success":"sell"===e.transaction_type.toLowerCase()})}," ("+k("buy"===e.transaction_type.toLowerCase()?"-":"")+k(ce(e.net_amount-e.deposit_fee))+") ",3)],64)):h("",!0)],2),f("td",null,[f("div",Os,[!e.splits||e.splits.length<2?_((y(),b("button",{key:0,class:"btn btn-link btn-xs text-info",onClick:t=>(e=>{ye.value&&(ye.value.loadUsers(),ye.value.loadTransaction(e.transaction_code),ye.value.showModal())})(e),title:"分单",style:{"min-width":"32px",padding:"0.15rem 0.5rem","font-size":"0.75rem","border-radius":"0.2rem"},"data-testid":"split-transaction-btn-"+e.id},t[25]||(t[25]=[g(" 分单 ")]),8,Ys)),[[a,"transaction:split:add"]]):h("",!0),e.splits&&e.splits.length>=2?_((y(),b("button",{key:1,class:"btn btn-link btn-xs text-info",onClick:t=>(e=>{be(e.id)})(e),title:"查看分单",style:{"min-width":"32px",padding:"0.15rem 0.5rem","font-size":"0.75rem","border-radius":"0.2rem"},"data-testid":"view-split-btn-"+e.id},t[26]||(t[26]=[g(" 查看 ")]),8,js)),[[a,"transaction:split:view"]]):h("",!0),e.splits&&e.splits.length>=2?_((y(),b("button",{key:2,class:"btn btn-link btn-xs text-warning",onClick:t=>(e=>{ye.value&&(ye.value.loadUsers(),ye.value.loadTransaction(e.transaction_code),ye.value.showModal())})(e),title:"编辑分单",style:{"min-width":"32px",padding:"0.15rem 0.5rem","font-size":"0.75rem","border-radius":"0.2rem"},"data-testid":"edit-split-btn-"+e.id},t[27]||(t[27]=[g(" 重分 ")]),8,Ks)),[[a,"transaction:split:edit"]]):h("",!0),_((y(),b("button",{class:"btn btn-link btn-xs text-primary",onClick:t=>oe(e),title:"编辑",style:{"min-width":"32px",padding:"0.15rem 0.5rem","font-size":"0.75rem","border-radius":"0.2rem"},"data-testid":"edit-transaction-btn-"+e.id},t[28]||(t[28]=[g(" 编辑 ")]),8,zs)),[[a,"transaction:records:edit"]]),_((y(),b("button",{class:"btn btn-link btn-xs text-danger",onClick:t=>ne(e),title:"删除",style:{"min-width":"32px",padding:"0.15rem 0.5rem","font-size":"0.75rem","border-radius":"0.2rem"},"data-testid":"delete-transaction-btn-"+e.id},t[29]||(t[29]=[g(" 删除 ")]),8,Rs)),[[a,"transaction:records:delete"]])])])],10,Is),e.splits&&e.splits.length>=2&&pe.value.includes(e.id)?(y(!0),b($,{key:0},T(e.splits,((a,l)=>{return y(),b("tr",{key:`split-${e.id}-${l}`,class:"split-row"},[t[31]||(t[31]=f("td",{class:"ps-4"},[f("i",{class:"fas fa-long-arrow-alt-right me-1 text-muted"})],-1)),t[32]||(t[32]=f("td",null,null,-1)),t[33]||(t[33]=f("td",null,null,-1)),f("td",null,[f("span",Hs,k(a.holder_name||(s=a.holder_id,s?`持有人ID: ${s}`:"未知持有人")||"未知持有人"),1),t[30]||(t[30]=f("br",null,null,-1)),f("small",Fs,k((100*a.split_ratio).toFixed(1))+"%",1),h("",!0)]),t[34]||(t[34]=f("td",null,null,-1)),f("td",null,k(ce(a.total_quantity,0))+"股@"+k(ce(a.total_amount/a.total_quantity,3)),1),f("td",Bs,k(ce(a.total_quantity,0)),1),f("td",Js,k(ce(a.total_amount/a.total_quantity,3)),1),f("td",Ws,k(ce(a.total_amount)),1),f("td",Xs,k(ce(a.broker_fee)),1),f("td",Zs,k(ce(a.transaction_levy)),1),f("td",Gs,k(ce(a.stamp_duty)),1),f("td",Qs,k(ce(a.trading_fee)),1),f("td",en,k(ce(a.deposit_fee)),1),f("td",tn,k(ce(a.total_fees)),1),f("td",{class:E(["text-end",{"text-danger":"buy"===a.transaction_type.toLowerCase(),"text-success":"sell"===a.transaction_type.toLowerCase()}])},k("buy"===a.transaction_type.toLowerCase()?"-":"")+k(ce(a.net_amount)),3),t[35]||(t[35]=f("td",null,null,-1))]);var s})),128)):h("",!0)],64)))),128)):v.value||0!==C.value.length?(y(),b("tr",ln,t[37]||(t[37]=[f("td",{colspan:"14",class:"text-center py-3"},[f("div",{class:"spinner-border spinner-border-sm text-primary me-2"}),g(" 加载中... ")],-1)]))):(y(),b("tr",an,t[36]||(t[36]=[f("td",{colspan:"14",class:"text-center py-3"},[f("div",{class:"text-muted"},"暂无数据")],-1)])))])])]),L.value>1?(y(),b("div",sn,[f("nav",null,[f("ul",nn,[f("li",{class:E(["page-item",{disabled:1===V.value}])},[f("a",{class:"page-link",href:"#",onClick:t[10]||(t[10]=w((e=>ue(V.value-1)),["prevent"]))},t[39]||(t[39]=[f("i",{class:"bi bi-chevron-left"},null,-1)]))],2),(y(!0),b($,null,T(me.value,(e=>(y(),b("li",{key:e,class:E(["page-item",{active:V.value===e,disabled:"..."===e}])},["..."===e?(y(),b("span",on,k(e),1)):(y(),b("a",{key:1,class:"page-link",href:"#",onClick:w((t=>ue(e)),["prevent"])},k(e),9,dn))],2)))),128)),f("li",{class:E(["page-item",{disabled:V.value===L.value}])},[f("a",{class:"page-link",href:"#",onClick:t[11]||(t[11]=w((e=>ue(V.value+1)),["prevent"]))},t[40]||(t[40]=[f("i",{class:"bi bi-chevron-right"},null,-1)]))],2)])])])):h("",!0)])),[[a,"transaction:records:view"]])]),P(ds,{ref_key:"splitModal",ref:ye,onSaved:e.refreshData},null,8,["onSaved"])],64)}}},[["__scopeId","data-v-94199036"]]),cn={class:"card"},un={class:"card-header d-flex justify-content-between align-items-center"},mn={class:"btn-group"},vn={class:"card-body border-bottom"},pn={class:"col-md-3"},bn=["value"],yn={class:"col-md-3"},fn=["value"],hn={class:"col-md-2"},gn={class:"col-md-2 d-flex align-items-end"},kn=["disabled"],wn={class:"card-body p-0"},_n={class:"table-responsive"},xn={class:"table table-hover table-sm mb-0"},Dn={class:"text-end"},Cn={class:"d-flex gap-1"},In=["onClick"],Sn=["onClick"],Vn={key:1},Pn={key:2},Ln={key:0,class:"card-footer d-flex justify-content-center"},qn={class:"pagination pagination-sm mb-0"},Mn={key:0,class:"page-link"},Un=["onClick"],En={class:"modal fade",id:"rateModal",tabindex:"-1"},Nn={class:"modal-dialog"},An={class:"modal-content"},$n={class:"modal-header"},Tn={class:"modal-title"},On={class:"modal-body"},Yn={class:"mb-3"},jn={class:"invalid-feedback"},Kn={class:"mb-3"},zn={class:"invalid-feedback"},Rn={class:"mb-3"},Hn={class:"invalid-feedback"},Fn={class:"mb-3"},Bn={class:"modal-footer"},Jn=["disabled"],Wn=re({__name:"ExchangeRateManager",setup(e){const t=r(!1),a=r(!1),l=r(!1),s=r(!1),n=r([]),o=r(1),d=r(1);let u=null;const D=v({startDate:"",endDate:"",currency:""}),C=v({id:null,rateDate:"",currency:"",rate:"",source:""}),I=v({rateDate:"",currency:"",rate:""}),S=p((()=>{const e=[];if(d.value<=7)for(let t=1;t<=d.value;t++)e.push(t);else if(o.value<=5){for(let t=1;t<=5;t++)e.push(t);e.push("..."),e.push(d.value)}else if(o.value>=d.value-4){e.push(1),e.push("...");for(let t=d.value-4;t<=d.value;t++)e.push(t)}else{e.push(1),e.push("...");for(let t=o.value-2;t<=o.value+2;t++)e.push(t);e.push("..."),e.push(d.value)}return e})),V=()=>i(this,null,(function*(){if(!t.value){t.value=!0;try{const e=new URLSearchParams;D.startDate&&e.append("start_date",D.startDate),D.endDate&&e.append("end_date",D.endDate),D.currency&&e.append("currency",D.currency),e.append("page",o.value),e.append("per_page",15);const t=yield c.get(`/api/stock/exchange_rates?${e.toString()}`);t.data.success&&(n.value=t.data.data.items,d.value=Math.ceil(t.data.data.total/15))}catch(e){}finally{t.value=!1}}})),L=()=>i(this,null,(function*(){if(!t.value){t.value=!0;try{const e=yield c.post("/api/stock/exchange_rates/fetch_missing");e.data.success&&(alert(`成功更新 ${e.data.data.updated_count} 条临时汇率记录`),yield V())}catch(e){alert("更新临时汇率失败，请稍后重试")}finally{t.value=!1}}})),q=()=>{l.value=!l.value},M=()=>{o.value=1,V()},O=()=>{D.startDate="",D.endDate="",D.currency="",o.value=1,V()},Y=e=>{e>=1&&e<=d.value&&(o.value=e,V())},j=()=>{s.value=!1,z(),u.show()},z=()=>{C.id=null,C.rateDate="",C.currency="",C.rate="",C.source="MANUAL",Object.keys(I).forEach((e=>I[e]=""))},R=()=>i(this,null,(function*(){var e,t;if(a.value)return;let l=!0;if(C.rateDate||(I.rateDate="请选择日期",l=!1),C.currency||(I.currency="请选择货币",l=!1),C.rate||(I.rate="请输入汇率",l=!1),l){a.value=!0;try{let e;e=s.value?yield c.put(`/api/stock/exchange_rates/${C.id}`,{rate:C.rate,source:C.source}):yield c.post("/api/stock/exchange_rates",{rate_date:C.rateDate,currency:C.currency,rate:C.rate,source:C.source}),e.data.success?(u.hide(),yield V()):alert(e.data.message||"操作失败")}catch(n){alert((null==(t=null==(e=n.response)?void 0:e.data)?void 0:t.message)||"保存失败，请稍后重试")}finally{a.value=!1}}})),H=e=>i(this,null,(function*(){var t,a;if(confirm("确定要删除这条汇率记录吗？"))try{const t=yield c.delete(`/api/stock/exchange_rates/${e.id}`);t.data.success?yield V():alert(t.data.message||"删除失败")}catch(l){alert((null==(a=null==(t=l.response)?void 0:t.data)?void 0:a.message)||"删除失败，请稍后重试")}})),F=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"),B=(e,t=2)=>null==e?"-":Number(e).toLocaleString("zh-HK",{minimumFractionDigits:t,maximumFractionDigits:t}),J=e=>{if(!e)return"-";return{TEMPORARY:"临时数据",MANUAL:"手动修改",EXCHANGE_RATES_API:"自动更新"}[e]||e},W=r(""),X=r(""),Z=r(null),G=r(null),Q=r(null),ee=r(null),te=(e,t)=>{var a,l,s;switch(e.preventDefault(),t){case"endDate":null==(a=G.value)||a.focus();break;case"currency":null==(l=Q.value)||l.focus();break;case"search":null==(s=ee.value)||s.focus(),M()}},ae=e=>{const t=e.target.value;W.value=t,D.startDate=t},le=()=>{if(!W.value)return void(D.startDate="");const e=W.value.trim();let t=null;if(/^[a-zA-Z]+$/.test(e)){const a=new Date;switch(e.toLowerCase()){case"t":case"today":t=F(a);break;case"y":case"yday":a.setDate(a.getDate()-1),t=F(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),t=F(a)}}if(/^[+-]\d+$/.test(e)){const a=parseInt(e),l=new Date;l.setDate(l.getDate()+a),t=F(l)}if(/^\d{3,4}$/.test(e)){const a=(new Date).getFullYear();let l,s;if(3===e.length?(l=parseInt(e[0]),s=parseInt(e.slice(1))):(l=parseInt(e.slice(0,2)),s=parseInt(e.slice(2))),l>=1&&l<=12&&s>=1&&s<=31){const e=new Date(a,l-1,s);oe(e)&&(t=F(e))}}const a=["-",".","/"];for(const l of a)if(e.includes(l)){const[a,s]=e.split(l).map(Number),n=(new Date).getFullYear();if(a>=1&&a<=12&&s>=1&&s<=31){const e=new Date(n,a-1,s);if(oe(e)){t=F(e);break}}}if(!t){const a=new Date(e);oe(a)&&(t=F(a))}t&&(W.value=t,D.startDate=t,D.endDate&&t>D.endDate&&(D.endDate=t,X.value=t))},se=e=>{const t=e.target.value;X.value=t,D.endDate=t},ne=()=>{if(!X.value)return void(D.endDate="");const e=X.value.trim();let t=null;if(/^[a-zA-Z]+$/.test(e)){const a=new Date;switch(e.toLowerCase()){case"t":case"today":t=F(a);break;case"y":case"yday":a.setDate(a.getDate()-1),t=F(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),t=F(a)}}if(/^[+-]\d+$/.test(e)){const a=parseInt(e),l=new Date;l.setDate(l.getDate()+a),t=F(l)}if(/^\d{3,4}$/.test(e)){const a=(new Date).getFullYear();let l,s;if(3===e.length?(l=parseInt(e[0]),s=parseInt(e.slice(1))):(l=parseInt(e.slice(0,2)),s=parseInt(e.slice(2))),l>=1&&l<=12&&s>=1&&s<=31){const e=new Date(a,l-1,s);oe(e)&&(t=F(e))}}const a=["-",".","/"];for(const l of a)if(e.includes(l)){const[a,s]=e.split(l).map(Number),n=(new Date).getFullYear();if(a>=1&&a<=12&&s>=1&&s<=31){const e=new Date(n,a-1,s);if(oe(e)){t=F(e);break}}}if(!t){const a=new Date(e);oe(a)&&(t=F(a))}t&&(X.value=t,D.endDate=t,D.startDate&&t<D.startDate&&(D.startDate=t,W.value=t))},oe=e=>e instanceof Date&&!isNaN(e);return m((()=>{u=new K.Modal(document.getElementById("rateModal")),V()})),(e,i)=>(y(),b("div",cn,[f("div",un,[i[15]||(i[15]=f("h4",{class:"mb-0"},"汇率管理",-1)),f("div",mn,[f("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:q},[f("i",{class:E(["fas",l.value?"fa-chevron-up":"fa-search"])},null,2),g(" "+k(l.value?"收起":"搜索"),1)]),f("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:L},i[13]||(i[13]=[f("i",{class:"fas fa-sync-alt"},null,-1),g(" 更新临时汇率 ")])),f("button",{type:"button",class:"btn btn-sm btn-primary",onClick:j},i[14]||(i[14]=[f("i",{class:"fas fa-plus"},null,-1),g(" 添加汇率 ")]))])]),_(f("div",vn,[f("form",{onSubmit:w(M,["prevent"]),class:"row g-3"},[f("div",pn,[i[16]||(i[16]=f("label",{class:"form-label small"},[g("开始日期 "),f("i",{class:"fas fa-question-circle text-muted ms-1","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"支持快速输入：\nt 或 today: 今天\ny 或 yday: 昨天\ntm 或 tmr: 明天\n+n/-n: n天后/前\n日期格式：\nMMDD: 0315\nMM-DD: 03-15\nM.D: 3.15\nDD: 15"})],-1)),f("input",{type:"text",class:"form-control",value:W.value,onInput:ae,onBlur:le,onKeydown:[i[0]||(i[0]=U(w((e=>te(e,"endDate")),["prevent"]),["enter"])),i[1]||(i[1]=U((e=>te(e,"endDate")),["tab"]))],placeholder:"YYYY-MM-DD",ref_key:"startDate",ref:Z},null,40,bn)]),f("div",yn,[i[17]||(i[17]=f("label",{class:"form-label small"},"结束日期",-1)),f("input",{type:"text",class:"form-control",value:X.value,onInput:se,onBlur:ne,onKeydown:[i[2]||(i[2]=U(w((e=>te(e,"currency")),["prevent"]),["enter"])),i[3]||(i[3]=U((e=>te(e,"currency")),["tab"]))],placeholder:"YYYY-MM-DD",ref_key:"endDate",ref:G},null,40,fn)]),f("div",hn,[i[19]||(i[19]=f("label",{class:"form-label small"},"货币",-1)),_(f("select",{class:"form-select form-select-sm","onUpdate:modelValue":i[4]||(i[4]=e=>D.currency=e),ref_key:"currency",ref:Q,onKeydown:[i[5]||(i[5]=U(w((e=>te(e,"search")),["prevent"]),["enter"])),i[6]||(i[6]=U((e=>te(e,"search")),["tab"]))]},i[18]||(i[18]=[f("option",{value:""},"全部",-1),f("option",{value:"USD"},"USD",-1),f("option",{value:"CNY"},"CNY",-1)]),544),[[A,D.currency]])]),f("div",gn,[f("button",{type:"submit",class:"btn btn-sm btn-primary w-100",disabled:t.value,ref_key:"searchBtn",ref:ee},i[20]||(i[20]=[f("i",{class:"fas fa-search"},null,-1),g(" 查询 ")]),8,kn)]),f("div",{class:"col-md-2 d-flex align-items-end"},[f("button",{type:"button",class:"btn btn-sm btn-outline-secondary w-100",onClick:O},i[21]||(i[21]=[f("i",{class:"fas fa-undo"},null,-1),g(" 重置 ")]))])],32)],512),[[N,l.value]]),f("div",wn,[f("div",_n,[f("table",xn,[i[26]||(i[26]=f("thead",{class:"table-light"},[f("tr",null,[f("th",null,"日期"),f("th",null,"货币"),f("th",{class:"text-end"},"汇率"),f("th",null,"数据来源"),f("th",null,"更新时间"),f("th",null,"操作")])],-1)),f("tbody",null,[t.value?(y(),b("tr",Vn,i[24]||(i[24]=[f("td",{colspan:"6",class:"text-center py-3"},[f("div",{class:"spinner-border spinner-border-sm text-primary me-2"}),g(" 加载中... ")],-1)]))):(y(!0),b($,{key:0},T(n.value,(e=>{return y(),b("tr",{key:e.id},[f("td",null,k(F(e.rate_date)),1),f("td",null,k(e.currency)+"/HKD",1),f("td",Dn,k(B(e.rate,4)),1),f("td",null,k(J(e.source)),1),f("td",null,k((t=e.created_at,new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/\//g,"-"))),1),f("td",null,[f("div",Cn,[f("button",{class:"btn btn-outline-primary btn-xs",onClick:t=>(e=>{s.value=!0,z(),C.id=e.id,C.rateDate=e.rate_date,C.currency=e.currency,C.rate=e.rate,C.source=e.source||"",u.show()})(e)},i[22]||(i[22]=[f("i",{class:"fas fa-edit text-primary"},null,-1),g(" 编辑 ")]),8,In),f("button",{class:"btn btn-outline-danger btn-xs",onClick:t=>H(e)},i[23]||(i[23]=[f("i",{class:"fas fa-trash text-danger"},null,-1),g(" 删除 ")]),8,Sn)])])]);var t})),128)),t.value||0!==n.value.length?h("",!0):(y(),b("tr",Pn,[f("td",{colspan:"6",class:"text-center py-4"},[i[25]||(i[25]=f("p",{class:"text-muted mb-2"},"暂无汇率记录",-1)),f("button",{class:"btn btn-primary btn-sm",onClick:j}," 添加第一条记录 ")])]))])])]),d.value>1?(y(),b("div",Ln,[f("nav",null,[f("ul",qn,[f("li",{class:E(["page-item",{disabled:1===o.value}])},[f("a",{class:"page-link",href:"#",onClick:i[7]||(i[7]=w((e=>Y(o.value-1)),["prevent"]))},i[27]||(i[27]=[f("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(y(!0),b($,null,T(S.value,(e=>(y(),b("li",{key:e,class:E(["page-item",{active:o.value===e,disabled:"..."===e}])},["..."===e?(y(),b("span",Mn,k(e),1)):(y(),b("a",{key:1,class:"page-link",href:"#",onClick:w((t=>Y(e)),["prevent"])},k(e),9,Un))],2)))),128)),f("li",{class:E(["page-item",{disabled:o.value===d.value}])},[f("a",{class:"page-link",href:"#",onClick:i[8]||(i[8]=w((e=>Y(o.value+1)),["prevent"]))},i[28]||(i[28]=[f("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])):h("",!0)]),f("div",En,[f("div",Nn,[f("div",An,[f("div",$n,[f("h5",Tn,k(s.value?"编辑汇率":"添加汇率"),1),i[29]||(i[29]=f("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),f("div",On,[f("form",{onSubmit:w(R,["prevent"])},[f("div",Yn,[i[30]||(i[30]=f("label",{class:"form-label"},"日期",-1)),P($a,{modelValue:C.rateDate,"onUpdate:modelValue":i[9]||(i[9]=e=>C.rateDate=e),class:E({"is-invalid":I.rateDate})},null,8,["modelValue","class"]),f("div",jn,k(I.rateDate),1)]),f("div",Kn,[i[32]||(i[32]=f("label",{class:"form-label"},"货币",-1)),_(f("select",{class:E(["form-select",{"is-invalid":I.currency}]),"onUpdate:modelValue":i[10]||(i[10]=e=>C.currency=e)},i[31]||(i[31]=[f("option",{value:""},"请选择货币",-1),f("option",{value:"USD"},"USD",-1),f("option",{value:"CNY"},"CNY",-1)]),2),[[A,C.currency]]),f("div",zn,k(I.currency),1)]),f("div",Rn,[i[33]||(i[33]=f("label",{class:"form-label"},"汇率",-1)),_(f("input",{type:"number",class:E(["form-control",{"is-invalid":I.rate}]),"onUpdate:modelValue":i[11]||(i[11]=e=>C.rate=e),step:"0.0001",min:"0"},null,2),[[x,C.rate]]),f("div",Hn,k(I.rate),1)]),f("div",Fn,[i[35]||(i[35]=f("label",{class:"form-label"},"数据来源",-1)),_(f("select",{class:"form-select","onUpdate:modelValue":i[12]||(i[12]=e=>C.source=e)},i[34]||(i[34]=[f("option",{value:"MANUAL"},"手动修改",-1),f("option",{value:"TEMPORARY"},"临时数据",-1),f("option",{value:"EXCHANGE_RATES_API"},"自动更新",-1)]),512),[[A,C.source]])])],32)]),f("div",Bn,[i[36]||(i[36]=f("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),f("button",{type:"button",class:"btn btn-primary",onClick:R,disabled:a.value},k(a.value?"保存中...":"保存"),9,Jn)])])])])]))}},[["__scopeId","data-v-7ef1c4d4"]]),Xn={class:"not-found-container"},Zn={class:"not-found-content"},Gn=re({__name:"NotFound",setup:e=>(e,t)=>{const a=S("router-link");return y(),b("div",Xn,[f("div",Zn,[t[1]||(t[1]=f("h1",null,"404",-1)),t[2]||(t[2]=f("h2",null,"页面未找到",-1)),t[3]||(t[3]=f("p",null,"抱歉，您访问的页面不存在或已被移除。",-1)),P(a,{to:"/",class:"btn btn-primary"},{default:L((()=>t[0]||(t[0]=[g("返回首页")]))),_:1})])])}},[["__scopeId","data-v-4e339e26"]]),Qn={class:"container mt-3"},eo={class:"card"},to={class:"card-header d-flex justify-content-between align-items-center"},ao={class:"d-flex"},lo={class:"input-group me-2"},so={class:"card-body","data-testid":"user-table-container"},no={class:"table-responsive"},oo={class:"table table-striped table-hover"},io=["data-testid"],ro=["data-testid"],co=["data-testid"],uo={class:"btn-group"},mo=["onClick","data-testid"],vo=["onClick","data-testid"],po=["onClick","data-testid"],bo=["onClick","data-testid"],yo={key:0},fo={key:0,"data-testid":"pagination-container"},ho={class:"pagination justify-content-center"},go=["onClick","data-testid"],ko={class:"modal-dialog"},wo={class:"modal-content"},_o={class:"modal-header"},xo={class:"modal-title"},Do={class:"modal-body"},Co={class:"mb-3"},Io=["disabled"],So={class:"mb-3"},Vo={class:"mb-3"},Po={key:0,class:"mb-3"},Lo={class:"form-check"},qo={key:1,class:"mb-3"},Mo={for:"password",class:"form-label"},Uo=["required"],Eo={class:"mb-3"},No={class:"form-check"},Ao={class:"form-check"},$o={class:"modal-dialog"},To={class:"modal-content"},Oo={class:"modal-body"},Yo={class:"mb-3"},jo={class:"form-label"},Ko={class:"mb-3"},zo=["id","value"],Ro=["for"],Ho={class:"modal-dialog"},Fo={class:"modal-content"},Bo={class:"modal-body"},Jo={class:"container mt-3"},Wo={class:"card"},Xo={class:"card-header d-flex justify-content-between align-items-center"},Zo={class:"d-flex"},Go={class:"input-group me-2"},Qo={class:"card-body"},ei={class:"table-responsive"},ti={class:"table table-striped table-hover"},ai={class:"btn-group"},li=["onClick"],si=["onClick"],ni=["onClick"],oi={key:0},ii={key:0},di={class:"pagination justify-content-center"},ri=["onClick"],ci={class:"modal-dialog"},ui={class:"modal-content"},mi={class:"modal-header"},vi={class:"modal-title"},pi={class:"modal-body"},bi={class:"mb-3"},yi={class:"mb-3"},fi={class:"modal-dialog modal-lg"},hi={class:"modal-content"},gi={class:"modal-body"},ki={class:"mb-3"},wi={class:"form-label"},_i={class:"mb-3"},xi={class:"permission-tree"},Di={class:"form-check"},Ci=["id","value","onChange"],Ii=["for"],Si={class:"ms-4 mt-2"},Vi={class:"form-check"},Pi=["id","value","onChange"],Li=["for"],qi={key:0,class:"ms-4 mt-1"},Mi=["id","value"],Ui=["for"],Ei={class:"modal-dialog"},Ni={class:"modal-content"},Ai={class:"modal-body"},$i={class:"container mt-3"},Ti={class:"card"},Oi={class:"card-header d-flex justify-content-between align-items-center"},Yi={class:"d-flex"},ji={class:"card-body"},Ki={class:"permission-tree-container"},zi={class:"custom-tree-node"},Ri={class:"node-content"},Hi={class:"node-label"},Fi={class:"permission-code"},Bi={class:"node-actions"},Ji={class:"el-form-item-helper"},Wi={class:"dialog-footer"},Xi={class:"dialog-footer"},Zi=[{path:"/",name:"Welcome",component:et,meta:{title:"欢迎",requiresAuth:!1}},{path:"/login",name:"Login",component:pt,meta:{title:"登录",requiresAuth:!1}},{path:"/auth/change-password",name:"ChangePassword",redirect:"/home",meta:{title:"修改密码",requiresAuth:!0}},{path:"/home",name:"Home",component:Et,meta:{requiresAuth:!0,title:"首页"}},{path:"/profit/stats",component:()=>oe((()=>import("./ProfitStats-UJCabBAl.js")),__vite__mapDeps([0,1])),meta:{title:"收益统计",requiresAuth:!0,permission:"profit:stats:view"}},{path:"/transaction/list",component:rn,meta:{title:"交易记录",requiresAuth:!0,permission:"transaction:records:view"}},{path:"/transactions/add",component:()=>oe((()=>import("./TransactionAdd--H8IwfhR.js")),__vite__mapDeps([2,1])),meta:{title:"添加交易",requiresAuth:!0,permission:"transaction:records:add"}},{path:"/transactions/edit/:id",component:()=>oe((()=>import("./TransactionEdit-D4dtyU4c.js")),__vite__mapDeps([3,1])),meta:{title:"编辑交易",requiresAuth:!0,permission:"transaction:records:edit"}},{path:"/exchange/rate",component:Wn,meta:{title:"汇率管理",requiresAuth:!0,permission:"exchange:rates:view"}},{path:"/stock",component:Ua,meta:{title:"股票管理",requiresAuth:!0,permission:"stock:list:view"}},{path:"/system/user",component:re({__name:"User",setup(e){const t=de(),a=r([]),l=r(""),s=r(1),n=r(10),o=r(0),d=p((()=>Math.ceil(o.value/n.value))),u=p((()=>{const e=[];if(d.value<=5)for(let t=1;t<=d.value;t++)e.push(t);else{let t=Math.max(1,s.value-Math.floor(2.5)),a=t+5-1;a>d.value&&(a=d.value,t=Math.max(1,a-5+1));for(let l=t;l<=a;l++)e.push(l)}return e})),v=r(null),D=r(null),C=r(null),I=r({username:"",password:"",name:"",email:"",status:"1",changePassword:!1}),S=r(!1),V=r(null),P=r([]),L=r([]),q=()=>i(this,null,(function*(){var e,i;try{const e={page:s.value,size:n.value};l.value&&(e.name=l.value);const t=yield c.get("/api/system/user/list",{params:e});a.value=t.data.data.items,o.value=t.data.data.total}catch(d){t.error("加载用户列表失败: "+((null==(i=null==(e=d.response)?void 0:e.data)?void 0:i.message)||d.message))}})),N=()=>i(this,null,(function*(){var e,a;try{const e=yield c.get("/api/system/role/all");P.value=e.data.data}catch(l){t.error("加载角色列表失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message))}})),A=()=>{S.value=!1,I.value={username:"",password:"",name:"",email:"",status:"1"},new j(v.value).show()},O=e=>i(this,null,(function*(){V.value=e,yield N(),L.value=e.roles.map((e=>e.id)),new j(D.value).show()})),Y=()=>i(this,null,(function*(){var e,a;try{const e={username:I.value.username,name:I.value.name,email:I.value.email,is_active:"1"===I.value.status};if(!S.value||I.value.changePassword){if(!I.value.password)return void t.error("请输入密码");e.password=I.value.password}S.value?(yield c.put(`/api/system/user/update/${I.value.id}`,e),t.success("更新用户成功")):(yield c.post("/api/system/user/add",e),t.success("添加用户成功"));try{if(v.value){const e=j.getInstance(v.value);if(e)e.hide();else{v.value.classList.remove("show"),v.value.style.display="none",document.body.classList.remove("modal-open");const e=document.querySelector(".modal-backdrop");e&&e.parentNode&&e.parentNode.removeChild(e)}}}catch(l){}yield q()}catch(s){t.error((S.value?"更新用户失败":"添加用户失败")+": "+((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message))}})),K=()=>i(this,null,(function*(){var e,a;try{yield c.post(`/api/system/user/assign-roles/${V.value.id}`,{role_ids:L.value}),t.success("角色分配成功");try{if(D.value){const e=j.getInstance(D.value);if(e)e.hide();else{D.value.classList.remove("show"),D.value.style.display="none",document.body.classList.remove("modal-open");const e=document.querySelector(".modal-backdrop");e&&e.parentNode&&e.parentNode.removeChild(e)}}}catch(l){}q()}catch(s){t.error("角色分配失败: "+((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message))}})),H=()=>i(this,null,(function*(){var e,a;try{yield c.delete(`/api/system/user/delete/${V.value.id}`),t.success("用户删除成功");try{if(C.value){const e=j.getInstance(C.value);if(e)e.hide();else{C.value.classList.remove("show"),C.value.style.display="none",document.body.classList.remove("modal-open");const e=document.querySelector(".modal-backdrop");e&&e.parentNode&&e.parentNode.removeChild(e)}}}catch(l){}q()}catch(s){t.error("删除失败: "+((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message))}})),F=e=>i(this,null,(function*(){var a,l;try{const a=1===e.status?0:1;yield c.put(`/api/system/user/update/${e.id}`,{status:a}),t.success(`用户${1===a?"启用":"禁用"}成功`),q()}catch(s){t.error("操作失败: "+((null==(l=null==(a=s.response)?void 0:a.data)?void 0:l.message)||s.message))}})),B=e=>{e<1||e>d.value||(s.value=e,q())},J=e=>{if(!e)return"";return new Date(e).toLocaleString()};return m((()=>{q()})),(e,t)=>{var n,o;const i=M("permission");return y(),b("div",Qn,[f("div",eo,[f("div",to,[t[13]||(t[13]=f("h5",{"data-testid":"user-management-title"},"用户管理",-1)),f("div",ao,[f("div",lo,[_(f("input",{type:"text",class:"form-control",placeholder:"搜索用户名/姓名","onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),onKeyup:U(q,["enter"]),"data-testid":"user-search-input"},null,544),[[x,l.value]]),_((y(),b("button",{class:"btn btn-outline-secondary",type:"button",onClick:q,"data-testid":"user-search-btn"},t[11]||(t[11]=[f("i",{class:"bi bi-search"},null,-1)]))),[[i,"system:user:view"]])]),_((y(),b("button",{class:"btn btn-primary",onClick:A,"data-testid":"add-user-btn"},t[12]||(t[12]=[f("i",{class:"bi bi-plus-lg"},null,-1),g(" 添加用户 ")]))),[[i,"system:user:add"]])])]),_((y(),b("div",so,[f("div",no,[f("table",oo,[t[18]||(t[18]=f("thead",null,[f("tr",null,[f("th",null,"ID"),f("th",null,"用户名"),f("th",null,"姓名"),f("th",null,"邮箱"),f("th",null,"角色"),f("th",null,"状态"),f("th",null,"创建时间"),f("th",null,"操作")])],-1)),f("tbody",null,[(y(!0),b($,null,T(a.value,(e=>(y(),b("tr",{key:e.id,"data-testid":"user-row-"+e.id},[f("td",null,k(e.id),1),f("td",null,k(e.username),1),f("td",null,k(e.name),1),f("td",null,k(e.email),1),f("td",null,[(y(!0),b($,null,T(e.roles,(t=>(y(),b("span",{key:t.id,class:"badge bg-primary me-1","data-testid":"user-role-badge-"+e.id+"-"+t.id},k(t.name),9,ro)))),128))]),f("td",null,[f("span",{class:E(1===e.status?"badge bg-success":"badge bg-danger"),"data-testid":"user-status-badge-"+e.id},k(1===e.status?"启用":"禁用"),11,co)]),f("td",null,k(J(e.created_at)),1),f("td",null,[f("div",uo,[_((y(),b("button",{class:"btn btn-sm btn-outline-primary",onClick:t=>(e=>{S.value=!0,V.value=e,I.value={id:e.id,username:e.username,name:e.display_name||"",email:e.email||"",status:e.is_active?"1":"0",password:"",changePassword:!1},new j(v.value).show()})(e),"data-testid":"edit-user-btn-"+e.id},t[14]||(t[14]=[f("i",{class:"bi bi-pencil"},null,-1)]),8,mo)),[[i,"system:user:edit"]]),_((y(),b("button",{class:"btn btn-sm btn-outline-danger",onClick:t=>(e=>{V.value=e,new j(C.value).show()})(e),"data-testid":"delete-user-btn-"+e.id},t[15]||(t[15]=[f("i",{class:"bi bi-trash"},null,-1)]),8,vo)),[[i,"system:user:delete"]]),_((y(),b("button",{class:"btn btn-sm btn-outline-success",onClick:t=>O(e),"data-testid":"assign-roles-btn-"+e.id},t[16]||(t[16]=[f("i",{class:"bi bi-people"},null,-1)]),8,po)),[[i,"system:user:assign"]]),_((y(),b("button",{class:"btn btn-sm btn-outline-warning",onClick:t=>F(e),"data-testid":"toggle-status-btn-"+e.id},[f("i",{class:E(1===e.status?"bi bi-x-circle":"bi bi-check-circle")},null,2)],8,bo)),[[i,"system:user:edit"]])])])],8,io)))),128)),0===a.value.length?(y(),b("tr",yo,t[17]||(t[17]=[f("td",{colspan:"8",class:"text-center","data-testid":"no-users-message"},"暂无数据",-1)]))):h("",!0)])])]),d.value>1?(y(),b("nav",fo,[f("ul",ho,[f("li",{class:E(["page-item",{disabled:1===s.value}])},[f("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=w((e=>B(s.value-1)),["prevent"])),"data-testid":"prev-page-btn"},"上一页")],2),(y(!0),b($,null,T(u.value,(e=>(y(),b("li",{key:e,class:E(["page-item",{active:s.value===e}])},[f("a",{class:"page-link",href:"#",onClick:w((t=>B(e)),["prevent"]),"data-testid":"page-btn-"+e},k(e),9,go)],2)))),128)),f("li",{class:E(["page-item",{disabled:s.value===d.value}])},[f("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=w((e=>B(s.value+1)),["prevent"])),"data-testid":"next-page-btn"},"下一页")],2)])])):h("",!0)])),[[i,"system:user:view"]])]),f("div",{class:"modal fade",id:"userModal",tabindex:"-1",ref_key:"userModal",ref:v},[f("div",ko,[f("div",wo,[f("div",_o,[f("h5",xo,k(S.value?"编辑用户":"添加用户"),1),t[19]||(t[19]=f("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),f("div",Do,[f("form",{onSubmit:w(Y,["prevent"])},[f("div",Co,[t[20]||(t[20]=f("label",{for:"username",class:"form-label"},"用户名",-1)),_(f("input",{type:"text",class:"form-control",id:"username","onUpdate:modelValue":t[3]||(t[3]=e=>I.value.username=e),disabled:S.value,required:""},null,8,Io),[[x,I.value.username]])]),f("div",So,[t[21]||(t[21]=f("label",{for:"name",class:"form-label"},"姓名",-1)),_(f("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[4]||(t[4]=e=>I.value.name=e),required:""},null,512),[[x,I.value.name]])]),f("div",Vo,[t[22]||(t[22]=f("label",{for:"email",class:"form-label"},"邮箱",-1)),_(f("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":t[5]||(t[5]=e=>I.value.email=e)},null,512),[[x,I.value.email]])]),S.value?(y(),b("div",Po,[f("div",Lo,[_(f("input",{type:"checkbox",class:"form-check-input",id:"changePassword","onUpdate:modelValue":t[6]||(t[6]=e=>I.value.changePassword=e)},null,512),[[z,I.value.changePassword]]),t[23]||(t[23]=f("label",{class:"form-check-label",for:"changePassword"},"修改密码",-1))])])):h("",!0),!S.value||I.value.changePassword?(y(),b("div",qo,[f("label",Mo,k(S.value?"新密码":"密码"),1),_(f("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":t[7]||(t[7]=e=>I.value.password=e),required:!S.value},null,8,Uo),[[x,I.value.password]])])):h("",!0),f("div",Eo,[t[26]||(t[26]=f("label",{class:"form-label"},"状态",-1)),f("div",No,[_(f("input",{type:"radio",class:"form-check-input",id:"statusActive",value:"1","onUpdate:modelValue":t[8]||(t[8]=e=>I.value.status=e)},null,512),[[R,I.value.status]]),t[24]||(t[24]=f("label",{class:"form-check-label",for:"statusActive"},"启用",-1))]),f("div",Ao,[_(f("input",{type:"radio",class:"form-check-input",id:"statusInactive",value:"0","onUpdate:modelValue":t[9]||(t[9]=e=>I.value.status=e)},null,512),[[R,I.value.status]]),t[25]||(t[25]=f("label",{class:"form-check-label",for:"statusInactive"},"禁用",-1))])]),t[27]||(t[27]=f("div",{class:"modal-footer"},[f("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消"),f("button",{type:"submit",class:"btn btn-primary"},"保存")],-1))],32)])])])],512),f("div",{class:"modal fade",id:"assignRolesModal",tabindex:"-1",ref_key:"assignRolesModal",ref:D},[f("div",$o,[f("div",To,[t[30]||(t[30]=f("div",{class:"modal-header"},[f("h5",{class:"modal-title"},"分配角色"),f("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),f("div",Oo,[f("div",Yo,[f("label",jo,"用户: "+k(null==(n=V.value)?void 0:n.username),1)]),f("div",Ko,[t[28]||(t[28]=f("label",{class:"form-label"},"角色列表",-1)),(y(!0),b($,null,T(P.value,(e=>(y(),b("div",{class:"form-check",key:e.id},[_(f("input",{class:"form-check-input",type:"checkbox",id:"role-"+e.id,value:e.id,"onUpdate:modelValue":t[10]||(t[10]=e=>L.value=e)},null,8,zo),[[z,L.value]]),f("label",{class:"form-check-label",for:"role-"+e.id},k(e.name)+" - "+k(e.description),9,Ro)])))),128))]),f("div",{class:"text-end"},[t[29]||(t[29]=f("button",{type:"button",class:"btn btn-secondary me-2","data-bs-dismiss":"modal"},"取消",-1)),f("button",{type:"button",class:"btn btn-primary",onClick:K},"保存")])])])])],512),f("div",{class:"modal fade",id:"deleteConfirmModal",tabindex:"-1",ref_key:"deleteConfirmModal",ref:C},[f("div",Ho,[f("div",Fo,[t[32]||(t[32]=f("div",{class:"modal-header"},[f("h5",{class:"modal-title"},"确认删除"),f("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),f("div",Bo,[f("p",null,'确定要删除用户 "'+k(null==(o=V.value)?void 0:o.username)+'" 吗？此操作不可撤销。',1)]),f("div",{class:"modal-footer"},[t[31]||(t[31]=f("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),f("button",{type:"button",class:"btn btn-danger",onClick:H},"删除")])])])],512)])}}},[["__scopeId","data-v-73253e31"]]),meta:{requiresAuth:!0,permission:"system:user:view"}},{path:"/system/role",component:re({__name:"Role",setup(e){const t=de(),a=r([]),l=r(""),s=r(1),n=r(10),o=r(0),d=p((()=>Math.ceil(o.value/n.value))),u=p((()=>{const e=[];if(d.value<=5)for(let t=1;t<=d.value;t++)e.push(t);else{let t=Math.max(1,s.value-Math.floor(2.5)),a=t+5-1;a>d.value&&(a=d.value,t=Math.max(1,a-5+1));for(let l=t;l<=a;l++)e.push(l)}return e})),v=r(null),D=r(null),C=r(null),I=r({name:"",description:""}),S=r(!1),V=r(null),P=r([]),L=r([]),q=()=>i(this,null,(function*(){var e,i;try{const e={page:s.value,page_size:n.value};l.value&&(e.name=l.value);const i=yield c.get("/api/system/role/list",{params:e});i.data.success?(a.value=i.data.data.items,o.value=i.data.data.total):t.error("加载角色列表失败: "+i.data.message)}catch(d){t.error("加载角色列表失败: "+((null==(i=null==(e=d.response)?void 0:e.data)?void 0:i.message)||d.message))}})),M=()=>i(this,null,(function*(){var e,a;try{const e=yield c.get("/api/system/permission/tree");e.data.success?P.value=e.data.data:t.error("加载权限树失败: "+e.data.message)}catch(l){t.error("加载权限树失败: "+((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||l.message))}})),N=()=>{S.value=!1,I.value={name:"",description:""},new j(v.value).show()},A=e=>i(this,null,(function*(){var a,l;V.value=e,yield M();try{const a=yield c.get(`/api/system/role/detail/${e.id}`);if(!a.data.success)return void t.error("获取角色详情失败: "+a.data.message);{const e=a.data.data;L.value=e.permissions.map((e=>e.id))}}catch(s){return void t.error("获取角色详情失败: "+((null==(l=null==(a=s.response)?void 0:a.data)?void 0:l.message)||s.message))}new j(D.value).show()})),O=()=>i(this,null,(function*(){var e,a;try{if(S.value){const e=yield c.put(`/api/system/role/update/${I.value.id}`,I.value);if(!e.data.success)return void t.error("角色更新失败: "+e.data.message);t.success("角色更新成功")}else{const e=yield c.post("/api/system/role/add",I.value);if(!e.data.success)return void t.error("角色添加失败: "+e.data.message);t.success("角色添加成功")}try{if(v.value){const e=j.getInstance(v.value);e&&e.hide()}}catch(l){}q()}catch(s){t.error("操作失败: "+((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message))}})),Y=()=>i(this,null,(function*(){var e,a;try{const e=yield c.post(`/api/system/role/assign-permissions/${V.value.id}`,{permission_ids:L.value});if(e.data.success){t.success("权限分配成功");try{if(D.value){const e=j.getInstance(D.value);e&&e.hide()}}catch(l){}q()}else t.error("权限分配失败: "+e.data.message)}catch(s){t.error("权限分配失败: "+((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message))}})),K=()=>i(this,null,(function*(){var e,a;try{const e=yield c.delete(`/api/system/role/delete/${V.value.id}`);if(e.data.success){t.success("角色删除成功");try{if(C.value){const e=j.getInstance(C.value);e&&e.hide()}}catch(l){}q()}else t.error("删除失败: "+e.data.message)}catch(s){t.error("删除失败: "+((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message))}})),R=e=>{e<1||e>d.value||(s.value=e,q())},H=e=>{if(!e)return"";return new Date(e).toLocaleString()};return m((()=>{q()})),(e,t)=>{var n,o;return y(),b("div",Jo,[f("div",Wo,[f("div",Xo,[t[10]||(t[10]=f("h5",null,"角色管理",-1)),f("div",Zo,[f("div",Go,[_(f("input",{type:"text",class:"form-control",placeholder:"搜索角色名称","onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),onKeyup:U(q,["enter"])},null,544),[[x,l.value]]),f("button",{class:"btn btn-outline-secondary",type:"button",onClick:q},t[8]||(t[8]=[f("i",{class:"bi bi-search"},null,-1)]))]),f("button",{class:"btn btn-primary",onClick:N},t[9]||(t[9]=[f("i",{class:"bi bi-plus-lg"},null,-1),g(" 添加角色 ")]))])]),f("div",Qo,[f("div",ei,[f("table",ti,[t[15]||(t[15]=f("thead",null,[f("tr",null,[f("th",null,"ID"),f("th",null,"角色名称"),f("th",null,"描述"),f("th",null,"创建时间"),f("th",null,"操作")])],-1)),f("tbody",null,[(y(!0),b($,null,T(a.value,(e=>(y(),b("tr",{key:e.id},[f("td",null,k(e.id),1),f("td",null,k(e.name),1),f("td",null,k(e.description),1),f("td",null,k(H(e.created_at)),1),f("td",null,[f("div",ai,[f("button",{class:"btn btn-sm btn-outline-primary",onClick:t=>(e=>{S.value=!0,V.value=e,I.value={id:e.id,name:e.name,description:e.description||""},new j(v.value).show()})(e)},t[11]||(t[11]=[f("i",{class:"bi bi-pencil"},null,-1)]),8,li),f("button",{class:"btn btn-sm btn-outline-success",onClick:t=>A(e)},t[12]||(t[12]=[f("i",{class:"bi bi-key"},null,-1)]),8,si),f("button",{class:"btn btn-sm btn-outline-danger",onClick:t=>(e=>{V.value=e,new j(C.value).show()})(e)},t[13]||(t[13]=[f("i",{class:"bi bi-trash"},null,-1)]),8,ni)])])])))),128)),0===a.value.length?(y(),b("tr",oi,t[14]||(t[14]=[f("td",{colspan:"5",class:"text-center"},"暂无数据",-1)]))):h("",!0)])])]),d.value>1?(y(),b("nav",ii,[f("ul",di,[f("li",{class:E(["page-item",{disabled:1===s.value}])},[f("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=w((e=>R(s.value-1)),["prevent"]))},"上一页")],2),(y(!0),b($,null,T(u.value,(e=>(y(),b("li",{key:e,class:E(["page-item",{active:s.value===e}])},[f("a",{class:"page-link",href:"#",onClick:w((t=>R(e)),["prevent"])},k(e),9,ri)],2)))),128)),f("li",{class:E(["page-item",{disabled:s.value===d.value}])},[f("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=w((e=>R(s.value+1)),["prevent"]))},"下一页")],2)])])):h("",!0)])]),f("div",{class:"modal fade",id:"roleModal",tabindex:"-1",ref_key:"roleModal",ref:v},[f("div",ci,[f("div",ui,[f("div",mi,[f("h5",vi,k(S.value?"编辑角色":"添加角色"),1),t[16]||(t[16]=f("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),f("div",pi,[f("form",{onSubmit:w(O,["prevent"])},[f("div",bi,[t[17]||(t[17]=f("label",{for:"name",class:"form-label"},"角色名称",-1)),_(f("input",{type:"text",class:"form-control",id:"name","onUpdate:modelValue":t[3]||(t[3]=e=>I.value.name=e),required:""},null,512),[[x,I.value.name]])]),f("div",yi,[t[18]||(t[18]=f("label",{for:"description",class:"form-label"},"描述",-1)),_(f("textarea",{class:"form-control",id:"description","onUpdate:modelValue":t[4]||(t[4]=e=>I.value.description=e),rows:"3"},null,512),[[x,I.value.description]])]),t[19]||(t[19]=f("div",{class:"text-end"},[f("button",{type:"button",class:"btn btn-secondary me-2","data-bs-dismiss":"modal"},"取消"),f("button",{type:"submit",class:"btn btn-primary"},"保存")],-1))],32)])])])],512),f("div",{class:"modal fade",id:"assignPermissionsModal",tabindex:"-1",ref_key:"assignPermissionsModal",ref:D},[f("div",fi,[f("div",hi,[t[22]||(t[22]=f("div",{class:"modal-header"},[f("h5",{class:"modal-title"},"分配权限"),f("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),f("div",gi,[f("div",ki,[f("label",wi,"角色: "+k(null==(n=V.value)?void 0:n.name),1)]),f("div",_i,[t[20]||(t[20]=f("label",{class:"form-label"},"权限列表",-1)),f("div",xi,[(y(!0),b($,null,T(P.value,(e=>(y(),b("div",{key:e.id,class:"permission-module"},[f("div",Di,[_(f("input",{class:"form-check-input",type:"checkbox",id:"module-"+e.id,value:e.id,"onUpdate:modelValue":t[5]||(t[5]=e=>L.value=e),onChange:t=>(e=>{const t=L.value.includes(e.id),a=[];e.children.forEach((e=>{a.push(e.id),e.children&&e.children.length>0&&e.children.forEach((e=>{a.push(e.id)}))})),t?a.forEach((e=>{L.value.includes(e)||L.value.push(e)})):L.value=L.value.filter((e=>!a.includes(e)))})(e)},null,40,Ci),[[z,L.value]]),f("label",{class:"form-check-label fw-bold",for:"module-"+e.id},k(e.name),9,Ii)]),f("div",Si,[(y(!0),b($,null,T(e.children,(e=>(y(),b("div",{key:e.id,class:"permission-menu mb-2"},[f("div",Vi,[_(f("input",{class:"form-check-input",type:"checkbox",id:"menu-"+e.id,value:e.id,"onUpdate:modelValue":t[6]||(t[6]=e=>L.value=e),onChange:t=>(e=>{const t=L.value.includes(e.id),a=e.children?e.children.map((e=>e.id)):[];t?a.forEach((e=>{L.value.includes(e)||L.value.push(e)})):L.value=L.value.filter((e=>!a.includes(e)))})(e)},null,40,Pi),[[z,L.value]]),f("label",{class:"form-check-label fw-bold",for:"menu-"+e.id},k(e.name),9,Li)]),e.children&&e.children.length>0?(y(),b("div",qi,[(y(!0),b($,null,T(e.children,(e=>(y(),b("div",{key:e.id,class:"form-check"},[_(f("input",{class:"form-check-input",type:"checkbox",id:"button-"+e.id,value:e.id,"onUpdate:modelValue":t[7]||(t[7]=e=>L.value=e)},null,8,Mi),[[z,L.value]]),f("label",{class:"form-check-label",for:"button-"+e.id},k(e.name),9,Ui)])))),128))])):h("",!0)])))),128))])])))),128))])]),f("div",{class:"text-end"},[t[21]||(t[21]=f("button",{type:"button",class:"btn btn-secondary me-2","data-bs-dismiss":"modal"},"取消",-1)),f("button",{type:"button",class:"btn btn-primary",onClick:Y},"保存")])])])])],512),f("div",{class:"modal fade",id:"deleteConfirmModal",tabindex:"-1",ref_key:"deleteConfirmModal",ref:C},[f("div",Ei,[f("div",Ni,[t[24]||(t[24]=f("div",{class:"modal-header"},[f("h5",{class:"modal-title"},"确认删除"),f("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),f("div",Ai,[f("p",null,'确定要删除角色 "'+k(null==(o=V.value)?void 0:o.name)+'" 吗？此操作不可撤销。',1)]),f("div",{class:"modal-footer"},[t[23]||(t[23]=f("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),f("button",{type:"button",class:"btn btn-danger",onClick:K},"删除")])])])],512)])}}},[["__scopeId","data-v-30072988"]]),meta:{requiresAuth:!0,permission:"system:role:view"}},{path:"/system/permission",component:re({__name:"Permission",setup(e){const t=r([]),a=r([]),l={children:"children",label:"name"},s=r(!1),n=r(!1),o=r(null),d=r({name:"",code:"",type:"2",parent_id:"0"}),u={name:[{required:!0,message:"请输入权限名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入权限标识",trigger:"blur"},{pattern:/^[a-z0-9:]+$/,message:"权限标识只能包含小写字母、数字和冒号",trigger:"blur"}],type:[{required:!0,message:"请选择权限类型",trigger:"change"}]},v=r(!1),p=r(null),h=r([]),w=r(""),x=r([]),D=()=>i(this,null,(function*(){var e,l;try{const e=yield c.get("/api/system/permission/tree");a.value=e.data.data;const l=yield c.get("/api/system/permission/list");t.value=l.data.data}catch(s){X.error("加载权限列表失败: "+((null==(l=null==(e=s.response)?void 0:e.data)?void 0:l.message)||s.message))}})),C=()=>i(this,null,(function*(){var e,t;try{const e=(yield c.get("/api/system/permission/list")).data.data;if(v.value&&p.value){const t=I(e,p.value.id);h.value=e.filter((e=>!t.includes(e.id)))}else h.value=e}catch(a){X.error("加载父级权限失败: "+((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||a.message))}x.value=h.value})),I=(e,t)=>{if(!t)return[];const a=[t],l=t=>{t&&e.forEach((e=>{e.parent_id&&e.parent_id.toString()===t.toString()&&(a.push(e.id),l(e.id))}))};return l(t),a},q=()=>i(this,null,(function*(){v.value=!1,d.value={name:"",code:"",type:"2",parent_id:"0"},yield C(),s.value=!0})),U=e=>i(this,null,(function*(){v.value=!0,p.value=e,d.value={id:e.id,name:e.name||"",code:e.code||"",type:null!==e.type&&void 0!==e.type?e.type.toString():"3",parent_id:null!==e.parent_id&&void 0!==e.parent_id?e.parent_id.toString():"0"},yield C(),s.value=!0})),E=()=>i(this,null,(function*(){var e,t;try{v.value?(yield c.put(`/api/system/permission/update/${d.value.id}`,d.value),X.success("权限更新成功")):(yield c.post("/api/system/permission/add",d.value),X.success("权限添加成功")),s.value=!1,D()}catch(a){X.error("操作失败: "+((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||a.message))}})),N=()=>i(this,null,(function*(){var e,t;try{yield c.delete(`/api/system/permission/delete/${p.value.id}`),X.success("权限删除成功"),n.value=!1,D()}catch(a){X.error("删除失败: "+((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||a.message))}})),A=()=>i(this,null,(function*(){if(!d.value.name)return void X.warning("请先输入权限名称");let e="";if(d.value.parent_id&&"0"!==d.value.parent_id){const t=h.value.find((e=>e.id.toString()===d.value.parent_id));if(!t)return void X.warning("找不到所选的父级权限");e=t.code}const t=d.value.name.toLowerCase().replace(/[^\w\s]/gi,"").replace(/\s+/g,"_");d.value.code=e?`${e}:${t}`:t})),O=()=>{if(!w.value)return void(x.value=h.value);const e=w.value.toLowerCase();x.value=h.value.filter((t=>t.name.toLowerCase().includes(e)||t.code.toLowerCase().includes(e)))},Y=e=>({1:"模块",2:"菜单",3:"按钮",4:"数据",5:"接口"}[e]||"未知");return m((()=>{D()})),(e,t)=>{const i=S("el-tag"),r=S("el-icon"),c=S("el-button"),m=S("el-tree"),h=S("el-input"),D=S("el-form-item"),C=S("el-option"),I=S("el-select"),j=S("el-form"),K=S("el-dialog"),z=M("permission");return y(),b("div",$i,[f("div",Ti,[f("div",Oi,[t[11]||(t[11]=f("h5",null,"权限管理",-1)),f("div",Yi,[_((y(),b("button",{class:"btn btn-primary",onClick:q},t[10]||(t[10]=[f("i",{class:"bi bi-plus-lg"},null,-1),g(" 添加权限 ")]))),[[z,"system:permission:add"]])])]),_((y(),b("div",ji,[f("div",Ki,[P(m,{data:a.value,props:l,"node-key":"id","default-expanded-keys":[],"expand-on-click-node":!1,"highlight-current":""},{default:L((({node:e,data:t})=>{return[f("div",zi,[f("div",Ri,[f("span",Hi,k(t.name),1),P(i,{size:"small",type:(a=t.type,{1:"primary",2:"success",3:"info",4:"warning",5:"danger"}[a]||"info"),class:"ml-2"},{default:L((()=>[g(k(Y(t.type)),1)])),_:2},1032,["type"]),f("span",Fi,k(t.code),1)]),f("div",Bi,[_((y(),V(c,{type:"primary",size:"small",circle:"",onClick:e=>U(t)},{default:L((()=>[P(r,null,{default:L((()=>[P(H(F))])),_:1})])),_:2},1032,["onClick"])),[[z,"system:permission:edit"]]),_((y(),V(c,{type:"danger",size:"small",circle:"",onClick:e=>{return a=t,p.value=a,void(n.value=!0);var a}},{default:L((()=>[P(r,null,{default:L((()=>[P(H(B))])),_:1})])),_:2},1032,["onClick"])),[[z,"system:permission:delete"]])])])];var a})),_:1},8,["data"])])])),[[z,"system:permission:view"]])]),P(K,{modelValue:s.value,"onUpdate:modelValue":t[7]||(t[7]=e=>s.value=e),title:v.value?"编辑权限":"添加权限",width:"500px"},{footer:L((()=>[f("span",Wi,[P(c,{onClick:t[6]||(t[6]=e=>s.value=!1)},{default:L((()=>t[24]||(t[24]=[g("取消")]))),_:1}),P(c,{type:"primary",onClick:E,loading:e.submitting},{default:L((()=>[g(k(v.value?"更新":"添加"),1)])),_:1},8,["loading"])])])),default:L((()=>[P(j,{model:d.value,"label-width":"100px",rules:u,ref_key:"permissionFormRef",ref:o},{default:L((()=>[P(D,{label:"权限名称",prop:"name"},{default:L((()=>[P(h,{modelValue:d.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value.name=e),placeholder:"请输入权限名称"},null,8,["modelValue"])])),_:1}),P(D,{label:"权限标识",prop:"code"},{default:L((()=>[P(h,{modelValue:d.value.code,"onUpdate:modelValue":t[1]||(t[1]=e=>d.value.code=e),placeholder:"请输入权限标识"},{append:L((()=>[P(c,{onClick:A,title:"根据父级权限和名称自动生成权限标识"},{default:L((()=>[P(r,null,{default:L((()=>[P(H(J))])),_:1})])),_:1})])),_:1},8,["modelValue"]),t[12]||(t[12]=f("div",{class:"el-form-item-helper"},"例如：system:user:view",-1))])),_:1}),P(D,{label:"权限类型",prop:"type"},{default:L((()=>[P(I,{modelValue:d.value.type,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value.type=e),placeholder:"请选择权限类型",class:"w-100"},{default:L((()=>[P(C,{label:"模块",value:"1"}),P(C,{label:"菜单",value:"2"}),P(C,{label:"按钮",value:"3"}),P(C,{label:"数据",value:"4"}),P(C,{label:"接口",value:"5"})])),_:1},8,["modelValue"]),f("div",Ji,[P(i,{size:"small",type:"primary",class:"me-1"},{default:L((()=>t[13]||(t[13]=[g("模块")]))),_:1}),t[18]||(t[18]=g(": 顶级功能模块 ")),P(i,{size:"small",type:"success",class:"me-1 ms-2"},{default:L((()=>t[14]||(t[14]=[g("菜单")]))),_:1}),t[19]||(t[19]=g(": 可导航的菜单项 ")),P(i,{size:"small",type:"info",class:"me-1 ms-2"},{default:L((()=>t[15]||(t[15]=[g("按钮")]))),_:1}),t[20]||(t[20]=g(": 页面上的操作按钮 ")),P(i,{size:"small",type:"warning",class:"me-1 ms-2"},{default:L((()=>t[16]||(t[16]=[g("数据")]))),_:1}),t[21]||(t[21]=g(": 数据访问权限 ")),P(i,{size:"small",type:"danger",class:"me-1 ms-2"},{default:L((()=>t[17]||(t[17]=[g("接口")]))),_:1}),t[22]||(t[22]=g(": API接口调用权限 "))])])),_:1}),P(D,{label:"父级权限",prop:"parent_id"},{default:L((()=>[P(h,{modelValue:w.value,"onUpdate:modelValue":t[4]||(t[4]=e=>w.value=e),placeholder:"搜索权限...",onInput:O,class:"mb-2"},{append:L((()=>[P(c,{onClick:t[3]||(t[3]=e=>{w.value="",O()})},{default:L((()=>[P(r,null,{default:L((()=>[P(H(W))])),_:1})])),_:1})])),_:1},8,["modelValue"]),P(I,{modelValue:d.value.parent_id,"onUpdate:modelValue":t[5]||(t[5]=e=>d.value.parent_id=e),placeholder:"请选择父级权限",class:"w-100"},{default:L((()=>[P(C,{label:"无 (作为顶级权限)",value:"0"}),(y(!0),b($,null,T(x.value,(e=>(y(),V(C,{key:e.id,label:"│".repeat(e.level)+(e.level>0?"├─ ":"")+e.name+" ("+Y(e.type)+")",value:e.id.toString()},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),t[23]||(t[23]=f("div",{class:"el-form-item-helper"}," 选择适当的父级权限，建立清晰的权限层级结构。模块通常作为顶级权限，菜单作为模块的子权限，按钮作为菜单的子权限。 ",-1))])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"]),P(K,{modelValue:n.value,"onUpdate:modelValue":t[9]||(t[9]=e=>n.value=e),title:"确认删除",width:"400px"},{footer:L((()=>[f("span",Xi,[P(c,{onClick:t[8]||(t[8]=e=>n.value=!1)},{default:L((()=>t[28]||(t[28]=[g("取消")]))),_:1}),P(c,{type:"danger",onClick:N,loading:e.submitting},{default:L((()=>t[29]||(t[29]=[g(" 确认删除 ")]))),_:1},8,["loading"])])])),default:L((()=>{var e;return[f("div",null,[t[25]||(t[25]=g(" 确定要删除权限 ")),f("strong",null,k(null==(e=p.value)?void 0:e.name),1),t[26]||(t[26]=g(" 吗？ ")),t[27]||(t[27]=f("p",{class:"text-danger mt-2"},[f("i",{class:"el-icon-warning"}),g(" 此操作将同时删除该权限下的所有子权限，且不可恢复！ ")],-1))])]})),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-6b65585f"]]),meta:{requiresAuth:!0,permission:"system:permission:view"}},{path:"/system/holder",component:()=>oe((()=>import("./Holder-qx6hFr6R.js")),__vite__mapDeps([4,1])),meta:{requiresAuth:!0,permission:"system:holder:view"}},{path:"/:pathMatch(.*)*",name:"NotFound",component:Gn,meta:{title:"页面未找到",requiresAuth:!1}}],Gi=Z({history:G("/"),routes:Zi});Gi.beforeEach(((e,t,a)=>i(void 0,null,(function*(){document.title=e.meta.title||"股票交易系统";if(!e.matched.some((e=>!1!==e.meta.requiresAuth)))return a();const t="true"===localStorage.getItem("isLoggedIn");let l=!1;try{const e=localStorage.getItem("user");if(l=e&&"undefined"!==e&&"null"!==e,l){const t=JSON.parse(e);l=t&&t.username}}catch(i){l=!1,localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn")}if(!(t&&l))return a({name:"Login",query:{redirect:e.fullPath}});let s=!1;try{const e=JSON.parse(localStorage.getItem("user")||"{}");s="alan"===e.username||"admin"===e.username}catch(i){}if(s&&e.path.startsWith("/system"))return a();const n=ie();if(!n.loaded)try{yield n.loadPermissions()}catch(d){return e.meta.permission?a({name:"Home"}):a()}const o=e.meta.permission;if(o&&!n.hasPermission(o))return a({name:"Home"});a()})))),Gi.afterEach((()=>{}));const Qi={mounted(e,t){const a=ie(),l=t.value;l&&!a.hasPermission(l)&&e.parentNode&&e.parentNode.removeChild(e)}},ed={mounted(e,t){const a=ie(),l=t.value;l&&!a.hasRole(l)&&e.parentNode&&e.parentNode.removeChild(e)}},td={install(e){e.directive("permission",Qi),e.directive("role",ed)}};window.bootstrap=Q,document.addEventListener("DOMContentLoaded",(()=>{window.bootstrap||(window.bootstrap=Q),setTimeout((()=>{const e=document.querySelectorAll(".dropdown-toggle");e.length>0&&e.forEach(((e,t)=>{new ee(e)}));const t=document.querySelectorAll(".modal");t.length>0&&t.forEach(((e,t)=>{new j(e)}))}),500)})),c.defaults.baseURL="http://127.0.0.1:9099",c.defaults.withCredentials=!0,c.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",c.interceptors.request.use((e=>{var t;const a=localStorage.getItem("token");a&&(e.headers.Authorization=`Bearer ${a}`);const l=null==(t=document.querySelector('meta[name="csrf-token"]'))?void 0:t.getAttribute("content");return l&&(e.headers["X-CSRF-TOKEN"]=l),e}));const ad=te(We);ad.use(ae,{locale:le}),ad.config.globalProperties.$axios=c,ad.config.globalProperties.$bootstrap=Q,ad.use(se()),ad.use(Gi),ad.use(td),ad.mount("#app");export{tl as S,re as _,de as u};
