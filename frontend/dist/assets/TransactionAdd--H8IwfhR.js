var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,d=(e,a,t)=>new Promise(((l,s)=>{var n=e=>{try{d(t.next(e))}catch(a){s(a)}},o=e=>{try{d(t.throw(e))}catch(a){s(a)}},d=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,o);d((t=t.apply(e,a)).next())}));import{u as c,r,k as i,o as u,n as v,E as p,_ as m,a as f,y as _,j as y,f as k,e as b,g,A as h,v as w,t as q,h as K,z as R,K as x,w as $,i as U,F as M,D,M as S}from"./vendor-BeeV2Y_X.js";import{_ as C,u as F}from"./index-CkM21um_.js";const V={class:"card"},H={class:"card-body"},A={class:"row mb-4"},I={class:"col-md-4"},B={class:"date-input"},j={class:"invalid-feedback","data-testid":"transaction-date-error"},E={class:"col-md-4"},O={class:"position-relative"},P={class:"stock-input-wrapper"},N=["onKeydown"],Y={key:0,class:"selected-stock","data-testid":"selected-stock-info"},L={class:"invalid-feedback","data-testid":"stock-code-error"},W={key:0,class:"stock-list","data-testid":"stock-search-list"},T=["onClick","onMouseover","data-testid"],z={class:"col-md-4"},G={class:"invalid-feedback","data-testid":"transaction-code-error"},J={class:"row mb-4"},Q={class:"col-md-4"},X={class:"invalid-feedback","data-testid":"transaction-type-error"},Z={class:"mb-4"},ee={class:"d-flex justify-content-between align-items-center mb-2"},ae={class:"border rounded p-3","data-testid":"transaction-details-container"},te=["data-testid"],le={class:"col-md-5"},se=["data-testid"],ne=["onUpdate:modelValue","onKeydown","data-testid"],oe={class:"col-md-5"},de=["data-testid"],ce=["onUpdate:modelValue","onKeydown","data-testid"],re=["data-testid"],ie={class:"col-md-2 d-flex align-items-end"},ue=["onClick","disabled","data-testid"],ve={class:"mb-4"},pe={class:"border rounded p-3","data-testid":"fees-container"},me={class:"row g-3"},fe={class:"col-md-4"},_e={class:"col-md-4"},ye={class:"col-md-4"},ke={class:"col-md-4"},be={class:"col-md-4"},ge={class:"d-flex justify-content-end gap-2"},he=["disabled"],we={key:0,class:"spinner-border spinner-border-sm me-1"},qe=["disabled"],Ke={key:0,class:"spinner-border spinner-border-sm me-1"},Re={class:"modal-dialog"},xe={class:"modal-content"},$e={class:"modal-body"},Ue={class:"mb-3"},Me=["onKeydown"],De={class:"invalid-feedback","data-testid":"new-stock-code-error"},Se={class:"mb-3"},Ce={class:"invalid-feedback","data-testid":"new-stock-market-error"},Fe={class:"mb-3"},Ve={class:"invalid-feedback","data-testid":"new-stock-name-error"},He={class:"mb-3"},Ae={class:"mb-3"},Ie=["value"],Be={class:"modal-footer"},je=["disabled"],Ee={key:0,class:"spinner-border spinner-border-sm me-1"},Oe=C({__name:"TransactionAdd",setup(e){const C=c(),Oe=F(),Pe=r(!1),Ne=r(!1),Ye=r({transaction_date:"",stock_code:"",stock_name:"",transaction_code:"",transaction_type:"",details:[{quantity:null,price:null}],broker_fee:"",transaction_levy:"",stamp_duty:"",trading_fee:"",deposit_fee:"",market:"HK"}),Le=r(!1),We=r({}),Te={transaction_date:r(null),stock_code:r(null),transaction_code:r(null),transaction_type:r(null),broker_fee:r(null),transaction_levy:r(null),stamp_duty:r(null),trading_fee:r(null),deposit_fee:r(null),cancelBtn:r(null),saveBtn:r(null),saveAndAddBtn:r(null),addDetailBtn:r(null),quantityRefs:[],priceRefs:[]},ze=r(!1),Ge=r([]),Je=r(-1),Qe=r(null),Xe=r({market:"HK",code:"",name:"",full_name:"",current_price:null,alertMessage:""}),Ze=r(!1),ea=()=>{Ye.value.details.push({quantity:null,price:null})},aa=e=>{const a=new Date(e);return a instanceof Date&&!isNaN(a)},ta=e=>{const a=e.target.value.trim();if(!a)return void(Ye.value.transaction_date="");let t=null;if(/^\d{1,2}$/.test(a)){const e=a.padStart(2,"0"),l=new Date;t=`${l.getFullYear()}-${(l.getMonth()+1).toString().padStart(2,"0")}-${e}`}else if(/^\d{1,2}-\d{1,2}$/.test(a)){const[e,l]=a.split("-").map((e=>e.padStart(2,"0")));t=`${(new Date).getFullYear()}-${e}-${l}`}else if(/^\d{1,2}-\d{1,2}-\d{2}$/.test(a)){const[e,l,s]=a.split("-").map((e=>e.padStart(2,"0")));t=`20${s}-${e}-${l}`}else{const e=new Date(a);aa(e)&&(t=(e=>{const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`})(e))}t&&aa(t)?(Ye.value.transaction_date=t,delete We.value.transaction_date):We.value.transaction_date="请输入有效的交易日期"};i((()=>Ye.value.transaction_type),(()=>{"buy"===Ye.value.transaction_type&&(Ye.value.stamp_duty="")}));const la=e=>{const a=e.target.value.toUpperCase();Ye.value.transaction_code=a,a.startsWith("P")?Ye.value.transaction_type="buy":a.startsWith("S")&&(Ye.value.transaction_type="sell")},sa=e=>d(this,null,(function*(){const a=Ye.value.transaction_code.trim();if(a)try{(yield f.get(`/api/stock/transactions/check-code?code=${encodeURIComponent(a)}`)).data.exists?(We.value.transaction_code="交易编号已存在，请重新输入",e.target.focus()):delete We.value.transaction_code}catch(t){Oe.error("检查交易编号失败，请重试")}})),na=()=>{if(ze.value&&Ge.value.length>0){const e=Je.value>=0&&Je.value<Ge.value.length?Ge.value[Je.value]:Ge.value[0];oa(e)}},oa=e=>{e&&e.code&&f.get(`/api/stock/stocks/search?query=${encodeURIComponent(e.code)}`).then((a=>{if(a.data.success&&a.data.data.length>0){const t=a.data.data.find((a=>a.code===e.code));t?(Ye.value.stock_code=t.code,Ye.value.stock_name=t.name||"",Ye.value.market=t.market||"HK",Le.value=!0):(Oe.warning("该股票可能已被删除，请重新选择"),Ye.value.stock_code="",Ye.value.stock_name="",Le.value=!1)}})).catch((e=>{Oe.error("验证股票失败，请重新选择")})),setTimeout((()=>{ze.value=!1,Ge.value=[],Je.value=-1}),100)},da=()=>d(this,null,(function*(){var e,a;try{if(!(()=>{We.value={};let e=!0;return Ye.value.transaction_date&&aa(Ye.value.transaction_date)||(We.value.transaction_date="请输入有效的交易日期",e=!1),Ye.value.stock_code||(We.value.stock_code="请选择股票",e=!1),Ye.value.transaction_code||(We.value.transaction_code="请输入交易编号",e=!1),Ye.value.transaction_type||(We.value.transaction_type="请选择交易类型",e=!1),Ye.value.details.forEach(((a,t)=>{const l=parseFloat(a.price);(isNaN(l)||l<=0)&&(We.value[`price_${t}`]="请输入有效的价格",e=!1);const s=parseFloat(a.quantity);(isNaN(s)||s<=0)&&(We.value[`quantity_${t}`]="请输入有效的数量",e=!1)})),e})()||Pe.value)return;Pe.value=!0;const e=Ye.value.details.reduce(((e,a)=>e+(parseFloat(a.quantity)||0)),0),a=Ye.value.details.reduce(((e,a)=>e+(parseFloat(a.quantity)||0)*(parseFloat(a.price)||0)),0),t={transaction_date:Ye.value.transaction_date,stock_code:Ye.value.stock_code,market:Ye.value.market,transaction_type:Ye.value.transaction_type.toLowerCase(),transaction_code:Ye.value.transaction_code,details:Ye.value.details.map((e=>({quantity:parseFloat(e.quantity)||0,price:parseFloat(e.price)||0}))),total_quantity:e,total_amount:a,broker_fee:parseFloat(Ye.value.broker_fee)||0,transaction_levy:parseFloat(Ye.value.transaction_levy)||0,stamp_duty:parseFloat(Ye.value.stamp_duty)||0,trading_fee:parseFloat(Ye.value.trading_fee)||0,deposit_fee:parseFloat(Ye.value.deposit_fee)||0},l=yield f.post("/api/stock/transactions",t);if(!l.data.success)throw new Error(l.data.message||"操作失败");Ne.value?(ra(),Ne.value=!1,Oe.success("交易记录添加成功"),yield v(),Te.transaction_date.value&&Te.transaction_date.value.focus()):(Oe.success("交易记录添加成功"),C.push("/transactions"))}catch(t){Oe.error((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||t.message||"操作失败，请稍后重试")}finally{Pe.value=!1}})),ca=()=>{Ne.value=!0,da()},ra=()=>{Ye.value={transaction_date:"",stock_code:"",stock_name:"",transaction_code:"",transaction_type:"",details:[{quantity:null,price:null}],broker_fee:"",transaction_levy:"",stamp_duty:"",trading_fee:"",deposit_fee:"",market:"HK"},We.value={},Le.value=!1};u((()=>{var e;v((()=>{document.querySelectorAll("input:not([disabled]), button:not([disabled])");Ye.value.details.forEach(((e,a)=>{}))})),document.addEventListener("click",ma),null==(e=Qe.value)||e.addEventListener("hidden.bs.modal",(()=>{Xe.value={market:"HK",code:"",name:"",full_name:"",current_price:null,alertMessage:""}}))})),p((()=>{document.removeEventListener("click",ma)}));i((()=>Ye.value.details.length),(e=>{v((()=>{Te.quantityRefs||(Te.quantityRefs=[]),Te.priceRefs||(Te.priceRefs=[]),Te.quantityRefs.length=e,Te.priceRefs.length=e;for(let a=0;a<e;a++)Te.quantityRefs[a]||(Te.quantityRefs[a]=null),Te.priceRefs[a]||(Te.priceRefs[a]=null)}))}));const ia=(e,a)=>{if("Enter"===e.key){if(e.preventDefault(),a.startsWith("quantity_")){const e=parseInt(a.split("_")[1]),t=Te.priceRefs[e];return void(t&&t.focus())}if(a.startsWith("price_")){if(parseInt(a.split("_")[1])===Ye.value.details.length-1){const e=Te.broker_fee.value;e&&e.focus()}return}const t={transaction_date:()=>{var e;return null==(e=Te.stock_code.value)?void 0:e.focus()},stock_code:()=>{var e;return null==(e=Te.transaction_code.value)?void 0:e.focus()},transaction_code:()=>{const e=Te.quantityRefs[0];e&&e.focus()},broker_fee:()=>{var e;return null==(e=Te.transaction_levy.value)?void 0:e.focus()},transaction_levy:()=>{var e;return null==(e=Te.stamp_duty.value)?void 0:e.focus()},stamp_duty:()=>{var e;return null==(e=Te.trading_fee.value)?void 0:e.focus()},trading_fee:()=>{var e;return null==(e=Te.deposit_fee.value)?void 0:e.focus()},deposit_fee:()=>{const e=Te.saveAndAddBtn.value;e&&e.click()}}[a];t&&t()}if("Tab"===e.key){if(e.preventDefault(),a.startsWith("quantity_")){const e=parseInt(a.split("_")[1]),t=Te.priceRefs[e];return void(t&&t.focus())}if(a.startsWith("price_"))return ea(),void v((()=>{const e=Ye.value.details.length-1,a=Te.quantityRefs[e];a&&a.focus()}));const t={transaction_date:()=>{var e;return null==(e=Te.stock_code.value)?void 0:e.focus()},stock_code:()=>{var e;return null==(e=Te.transaction_code.value)?void 0:e.focus()},transaction_code:()=>{const e=Te.quantityRefs[0];e&&e.focus()},broker_fee:()=>{var e;return null==(e=Te.transaction_levy.value)?void 0:e.focus()},transaction_levy:()=>{var e;return null==(e=Te.stamp_duty.value)?void 0:e.focus()},stamp_duty:()=>{var e;return null==(e=Te.trading_fee.value)?void 0:e.focus()},trading_fee:()=>{var e;return null==(e=Te.deposit_fee.value)?void 0:e.focus()},deposit_fee:()=>{var e;return null==(e=Te.cancelBtn.value)?void 0:e.focus()}}[a];t&&t()}},ua=m.debounce((e=>d(this,null,(function*(){const a=e.target.value.trim();if(!a)return ze.value=!1,void(Ge.value=[]);try{const e=yield f.get(`/api/stock/stocks/search?query=${encodeURIComponent(a)}`,{params:{timestamp:(new Date).getTime()}});e.data.success&&Array.isArray(e.data.data)?(Ge.value=e.data.data,ze.value=Ge.value.length>0,Je.value=-1,0===Ge.value.length&&Oe.info("未找到匹配的股票")):(Ge.value=[],ze.value=!1,Oe.warning("获取股票列表失败"))}catch(t){Ge.value=[],ze.value=!1,Oe.error("搜索股票失败，请重试")}}))),300),va=e=>{ze.value&&0!==Ge.value.length&&(Je.value="up"===e?Je.value<=0?Ge.value.length-1:Je.value-1:Je.value>=Ge.value.length-1?0:Je.value+1)},pa=()=>{ze.value=!1,Je.value=-1},ma=e=>{e.target.closest(".position-relative")||pa()},fa=e=>d(this,null,(function*(){setTimeout((()=>d(this,null,(function*(){const e=Ye.value.stock_code;if(e){if(!Le.value||!Ye.value.stock_name)try{const a=yield f.get(`/api/stock/stocks/search?query=${encodeURIComponent(e)}`);if(a.data.success&&Array.isArray(a.data.data)){const t=a.data.data.find((a=>a.code===e));if(t)return Ye.value.stock_code=t.code,Ye.value.stock_name=t.name,Ye.value.market=t.market,void(Le.value=!0)}const t=yield f.get(`/api/stock/search_stock?code=${encodeURIComponent(e)}`);if(t.data.success&&t.data.data.length>0){const e=t.data.data[0];Xe.value={market:"HK"===e.market||"HKG"===e.exchange?"HK":"USA",code:e.code,name:e.code_name||"",google_code:e.query,current_price:e.price,alertMessage:""};new S(Qe.value).show()}else{Xe.value={market:"HK",code:e,name:"",google_code:"",current_price:null,alertMessage:"未找到股票信息，请手动输入股票详情"};new S(Qe.value).show()}}catch(a){Xe.value={market:"HK",code:e,name:"",google_code:"",current_price:null,alertMessage:"搜索股票失败，请手动输入股票详情"};new S(Qe.value).show()}}else Le.value=!1}))),200)}));i((()=>Ye.value.stock_code),(e=>{e||(Ye.value.stock_name="",Ye.value.market="HK",Le.value=!1)}));const _a=e=>d(this,null,(function*(){if(e.preventDefault(),Xe.value.code){We.value={},Xe.value.alertMessage="";try{const e=yield f.get(`/api/stock/search_stock?code=${encodeURIComponent(Xe.value.code)}`);if(e.data.success&&e.data.data.length>0){const r=e.data.data[0],i=yield f.get("/api/stock/stocks",{params:{search:r.code}});if(i.data.success&&i.data.data.items.length>0){const e=i.data.data.items.find((e=>e.code===r.code));if(e)return Xe.value=(d=((e,a)=>{for(var t in a||(a={}))s.call(a,t)&&o(e,t,a[t]);if(l)for(var t of l(a))n.call(a,t)&&o(e,t,a[t]);return e})({},e),c={current_price:r.price},a(d,t(c))),void(Le.value=!0)}Xe.value={code:r.code,market:r.market,name:r.code_name||"",google_code:r.query,current_price:r.price},Xe.value.name&&(Le.value=!0),Xe.value.name||(We.value.name="未能获取公司名称")}else Xe.value.alertMessage="未找到股票信息，请检查股票代码是否正确",ya()}catch(r){Xe.value.alertMessage="查询失败，请检查股票代码是否正确",ya()}var d,c}})),ya=()=>{const e=Xe.value.code;Xe.value={market:"",code:e,name:"",google_code:"",current_price:null,alertMessage:""},We.value={}},ka=()=>d(this,null,(function*(){var e,a;if(Ze.value)return;We.value={};let t=!0;if(Xe.value.code||(We.value.code="请输入股票代码",t=!1),Xe.value.market||(We.value.market="无法确定股票市场",t=!1),Xe.value.name||(We.value.name="未能获取股票名称",t=!1),Xe.value.current_price||(We.value.code="未能获取股票价格，请确认股票代码是否正确",t=!1),t)try{Ze.value=!0;const e=yield f.get("/api/stock/stocks",{params:{search:Xe.value.code}});if(e.data.success&&e.data.data.items.length>0){if(e.data.data.items.find((e=>e.code===Xe.value.code)))return Oe.warning("该股票代码已存在"),Xe.value.current_price=null,void(Ze.value=!1)}const a={code:Xe.value.code,market:Xe.value.market,code_name:Xe.value.name,google_name:Xe.value.google_code,currency:"HK"===Xe.value.market?"HKD":"USD"},t=yield f.post("/api/stock/stocks",a);if(t.data.success){Oe.success("股票添加成功"),Ye.value.stock_code=Xe.value.code,Ye.value.stock_name=Xe.value.name,Ye.value.market=Xe.value.market;try{if(Qe.value){const e=S.getInstance(Qe.value);if(e)e.hide();else{Qe.value.classList.remove("show"),Qe.value.style.display="none",document.body.classList.remove("modal-open");const e=document.querySelector(".modal-backdrop");e&&e.parentNode&&e.parentNode.removeChild(e)}}}catch(l){}Xe.value={market:"HK",code:"",name:"",full_name:"",current_price:null,alertMessage:""}}else Oe.error(t.data.message||"添加股票失败"),Xe.value.current_price=null}catch(s){Oe.error((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||s.message||"添加股票失败，请重试"),Xe.value.current_price=null}finally{Ze.value=!1}})),ba=()=>{Ye.value.stock_code=""};return(e,a)=>{const t=_("permission");return y((k(),b("div",V,[a[47]||(a[47]=g("div",{class:"card-header"},[g("h5",{class:"mb-0","data-testid":"transaction-add-title"},"添加交易记录")],-1)),g("div",H,[g("div",A,[g("div",I,[a[26]||(a[26]=g("label",{class:"form-label","data-testid":"transaction-date-label"},"交易日期",-1)),g("div",B,[y(g("input",{type:"text",class:h(["form-control",{"is-invalid":We.value.transaction_date}]),"onUpdate:modelValue":a[0]||(a[0]=e=>Ye.value.transaction_date=e),onBlur:ta,onKeydown:a[1]||(a[1]=e=>ia(e,"transaction_date")),placeholder:"YYYY-MM-DD",ref:e=>Te.transaction_date.value=e,"data-testid":"transaction-date-input"},null,34),[[w,Ye.value.transaction_date]]),g("div",j,q(We.value.transaction_date),1)])]),g("div",E,[a[27]||(a[27]=g("label",{class:"form-label","data-testid":"stock-code-label"},"股票代码",-1)),g("div",O,[g("div",P,[y(g("input",{type:"text",class:h(["form-control",{"is-invalid":We.value.stock_code}]),"onUpdate:modelValue":a[2]||(a[2]=e=>Ye.value.stock_code=e),ref:e=>Te.stock_code.value=e,onInput:a[3]||(a[3]=(...e)=>x(ua)&&x(ua)(...e)),onBlur:fa,onFocus:ba,onKeydown:[a[4]||(a[4]=e=>ia(e,"stock_code")),a[5]||(a[5]=R($((e=>va("down")),["prevent"]),["down"])),a[6]||(a[6]=R($((e=>va("up")),["prevent"]),["up"])),R($(na,["prevent"]),["enter"]),R(pa,["esc"])],placeholder:"输入代码或名称搜索","data-testid":"stock-code-input"},null,42,N),[[w,Ye.value.stock_code]]),Ye.value.stock_code&&Ye.value.stock_name?(k(),b("span",Y,[g("span",{class:h(["market-tag","HK"===Ye.value.market?"hk":"usa"]),"data-testid":"selected-stock-market"},q(Ye.value.market),3),U(" "+q(Ye.value.stock_code)+" "+q(Ye.value.stock_name),1)])):K("",!0)]),g("div",L,q(We.value.stock_code),1),ze.value&&Ge.value.length>0?(k(),b("div",W,[(k(!0),b(M,null,D(Ge.value,((e,a)=>(k(),b("a",{key:e.code,href:"#",class:h(["stock-item",{active:a===Je.value}]),onClick:$((a=>oa(e)),["prevent"]),onMouseover:e=>Je.value=a,"data-testid":"stock-item-"+e.code},[g("span",{class:h(["market-tag","HK"===e.market?"hk":"usa"])},q(e.market),3),U(" "+q(e.code)+" - "+q(e.name),1)],42,T)))),128))])):K("",!0)])]),g("div",z,[a[28]||(a[28]=g("label",{class:"form-label","data-testid":"transaction-code-label"},"交易编号",-1)),y(g("input",{type:"text",class:h(["form-control",{"is-invalid":We.value.transaction_code}]),"onUpdate:modelValue":a[7]||(a[7]=e=>Ye.value.transaction_code=e),ref:e=>Te.transaction_code.value=e,onInput:la,onBlur:sa,onKeydown:a[8]||(a[8]=e=>ia(e,"transaction_code")),"data-testid":"transaction-code-input"},null,34),[[w,Ye.value.transaction_code]]),g("div",G,q(We.value.transaction_code),1)])]),g("div",J,[g("div",Q,[a[29]||(a[29]=g("label",{class:"form-label","data-testid":"transaction-type-label"},"交易类型",-1)),y(g("input",{type:"text",class:h(["form-control",{"is-invalid":We.value.transaction_type}]),"onUpdate:modelValue":a[9]||(a[9]=e=>Ye.value.transaction_type=e),ref:e=>Te.transaction_type.value=e,onKeydown:a[10]||(a[10]=e=>ia(e,"transaction_type")),placeholder:"P-买入 S-卖出","data-testid":"transaction-type-input"},null,34),[[w,Ye.value.transaction_type]]),g("div",X,q(We.value.transaction_type),1)])]),g("div",Z,[g("div",ee,[a[30]||(a[30]=g("label",{class:"form-label mb-0","data-testid":"transaction-details-label"},"成交明细",-1)),g("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:ea,ref:e=>Te.addDetailBtn.value=e,"data-testid":"add-detail-button"}," 添加成交记录 ",512)]),g("div",ae,[(k(!0),b(M,null,D(Ye.value.details,((e,a)=>(k(),b("div",{key:a,class:"row g-2 mb-2","data-testid":"detail-row-"+a},[g("div",le,[g("label",{class:"form-label","data-testid":"quantity-label-"+a},"数量",8,se),y(g("input",{type:"text",class:"form-control","onUpdate:modelValue":a=>e.quantity=a,ref_for:!0,ref:e=>((e,a)=>{for(Te.quantityRefs||(Te.quantityRefs=[]);Te.quantityRefs.length<=a;)Te.quantityRefs.push(null);Te.quantityRefs[a]=e})(e,a),onKeydown:e=>ia(e,`quantity_${a}`),"data-testid":"quantity-input-"+a},null,40,ne),[[w,e.quantity]])]),g("div",oe,[g("label",{class:"form-label","data-testid":"price-label-"+a},"价格",8,de),y(g("input",{type:"text",class:h(["form-control",{"is-invalid":We.value[`price_${a}`]}]),"onUpdate:modelValue":a=>e.price=a,ref_for:!0,ref:e=>((e,a)=>{for(Te.priceRefs||(Te.priceRefs=[]);Te.priceRefs.length<=a;)Te.priceRefs.push(null);Te.priceRefs[a]=e})(e,a),onKeydown:e=>ia(e,`price_${a}`),"data-testid":"price-input-"+a},null,42,ce),[[w,e.price]]),g("div",{class:"invalid-feedback","data-testid":"price-error-"+a},q(We.value[`price_${a}`]),9,re)]),g("div",ie,[g("button",{type:"button",class:"btn btn-outline-danger w-100",onClick:e=>(e=>{Ye.value.details.length>1&&Ye.value.details.splice(e,1)})(a),disabled:1===Ye.value.details.length,"data-testid":"remove-detail-button-"+a}," 删除 ",8,ue)])],8,te)))),128))])]),g("div",ve,[a[36]||(a[36]=g("label",{class:"form-label","data-testid":"fees-label"},"费用明细",-1)),g("div",pe,[g("div",me,[g("div",fe,[a[31]||(a[31]=g("label",{class:"form-label","data-testid":"broker-fee-label"},"经纪佣金",-1)),y(g("input",{type:"text",class:"form-control","onUpdate:modelValue":a[11]||(a[11]=e=>Ye.value.broker_fee=e),ref:e=>Te.broker_fee.value=e,onKeydown:a[12]||(a[12]=e=>ia(e,"broker_fee")),"data-testid":"broker-fee-input"},null,544),[[w,Ye.value.broker_fee]])]),g("div",_e,[a[32]||(a[32]=g("label",{class:"form-label","data-testid":"transaction-levy-label"},"交易征费",-1)),y(g("input",{type:"text",class:"form-control","onUpdate:modelValue":a[13]||(a[13]=e=>Ye.value.transaction_levy=e),ref:e=>Te.transaction_levy.value=e,onKeydown:a[14]||(a[14]=e=>ia(e,"transaction_levy")),"data-testid":"transaction-levy-input"},null,544),[[w,Ye.value.transaction_levy]])]),g("div",ye,[a[33]||(a[33]=g("label",{class:"form-label","data-testid":"stamp-duty-label"},"印花税",-1)),y(g("input",{type:"text",class:"form-control","onUpdate:modelValue":a[15]||(a[15]=e=>Ye.value.stamp_duty=e),ref:e=>Te.stamp_duty.value=e,onKeydown:a[16]||(a[16]=e=>ia(e,"stamp_duty")),"data-testid":"stamp-duty-input"},null,544),[[w,Ye.value.stamp_duty]])]),g("div",ke,[a[34]||(a[34]=g("label",{class:"form-label","data-testid":"trading-fee-label"},"交易费",-1)),y(g("input",{type:"text",class:"form-control","onUpdate:modelValue":a[17]||(a[17]=e=>Ye.value.trading_fee=e),ref:e=>Te.trading_fee.value=e,onKeydown:a[18]||(a[18]=e=>ia(e,"trading_fee")),"data-testid":"trading-fee-input"},null,544),[[w,Ye.value.trading_fee]])]),g("div",be,[a[35]||(a[35]=g("label",{class:"form-label","data-testid":"deposit-fee-label"},"存入证券费",-1)),y(g("input",{type:"text",class:"form-control","onUpdate:modelValue":a[19]||(a[19]=e=>Ye.value.deposit_fee=e),ref:e=>Te.deposit_fee.value=e,onKeydown:a[20]||(a[20]=e=>ia(e,"deposit_fee")),"data-testid":"deposit-fee-input"},null,544),[[w,Ye.value.deposit_fee]])])])])]),g("div",ge,[g("button",{type:"button",class:"btn btn-secondary",onClick:a[21]||(a[21]=a=>e.$router.back()),ref:e=>Te.cancelBtn.value=e,"data-testid":"cancel-button"}," 取消 ",512),g("button",{type:"button",class:"btn btn-primary",disabled:Pe.value,ref:e=>Te.saveBtn.value=e,onClick:da,"data-testid":"save-button"},[Pe.value?(k(),b("span",we)):K("",!0),a[37]||(a[37]=U(" 保存 "))],8,he),g("button",{type:"button",class:"btn btn-success",disabled:Pe.value,onClick:ca,ref:e=>Te.saveAndAddBtn.value=e,"data-testid":"save-and-add-button"},[Pe.value?(k(),b("span",Ke)):K("",!0),a[38]||(a[38]=U(" 保存并添加下一条 "))],8,qe)])]),g("div",{class:"modal fade",id:"addStockModal",tabindex:"-1",ref_key:"addStockModal",ref:Qe,"data-testid":"add-stock-modal"},[g("div",Re,[g("div",xe,[a[46]||(a[46]=g("div",{class:"modal-header"},[g("h5",{class:"modal-title","data-testid":"add-stock-modal-title"},"添加新股票"),g("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","data-testid":"add-stock-modal-close"})],-1)),g("div",$e,[g("form",{onSubmit:$(ka,["prevent"])},[g("div",Ue,[a[39]||(a[39]=g("label",{class:"form-label","data-testid":"new-stock-code-label"},"股票代码",-1)),y(g("input",{type:"text",class:h(["form-control",{"is-invalid":We.value.code}]),"onUpdate:modelValue":a[22]||(a[22]=e=>Xe.value.code=e),placeholder:"输入股票代码后将自动查询股票信息",onKeydown:[R($(_a,["prevent"]),["enter"]),R($(_a,["prevent"]),["tab"])],"data-testid":"new-stock-code-input"},null,42,Me),[[w,Xe.value.code]]),g("div",De,q(We.value.code),1)]),g("div",Se,[a[40]||(a[40]=g("label",{class:"form-label","data-testid":"new-stock-market-label"},"市场",-1)),y(g("input",{type:"text",class:h(["form-control",{"is-invalid":We.value.market}]),"onUpdate:modelValue":a[23]||(a[23]=e=>Xe.value.market=e),readonly:"","data-testid":"new-stock-market-input"},null,2),[[w,Xe.value.market]]),g("div",Ce,q(We.value.market),1)]),g("div",Fe,[a[41]||(a[41]=g("label",{class:"form-label","data-testid":"new-stock-name-label"},"股票名称",-1)),y(g("input",{type:"text",class:h(["form-control",{"is-invalid":We.value.name}]),"onUpdate:modelValue":a[24]||(a[24]=e=>Xe.value.name=e),readonly:"","data-testid":"new-stock-name-input"},null,2),[[w,Xe.value.name]]),g("div",Ve,q(We.value.name),1)]),g("div",He,[a[42]||(a[42]=g("label",{class:"form-label","data-testid":"new-stock-google-code-label"},"谷歌查询代码",-1)),y(g("input",{type:"text",class:"form-control","onUpdate:modelValue":a[25]||(a[25]=e=>Xe.value.google_code=e),readonly:"","data-testid":"new-stock-google-code-input"},null,512),[[w,Xe.value.google_code]])]),g("div",Ae,[a[43]||(a[43]=g("label",{class:"form-label","data-testid":"new-stock-price-label"},"当前股价",-1)),g("input",{type:"text",class:"form-control",value:Xe.value.current_price,readonly:"","data-testid":"new-stock-price-input"},null,8,Ie),Xe.value.alertMessage?(k(),b("div",{key:0,class:h({"text-danger":Xe.value.alertMessage.includes("已存在"),"text-primary":Xe.value.alertMessage.includes("查询失败")}),"data-testid":"new-stock-alert-message"},q(Xe.value.alertMessage),3)):K("",!0)])],32)]),g("div",Be,[a[45]||(a[45]=g("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal","data-testid":"add-stock-modal-cancel"},"取消",-1)),g("button",{type:"button",class:"btn btn-primary",onClick:ka,disabled:Ze.value,"data-testid":"add-stock-modal-submit"},[Ze.value?(k(),b("span",Ee)):K("",!0),a[44]||(a[44]=U(" 确认添加 "))],8,je)])])])],512)])),[[t,"transaction:records:add"]])}}},[["__scopeId","data-v-1d36ba41"]]);export{Oe as default};
