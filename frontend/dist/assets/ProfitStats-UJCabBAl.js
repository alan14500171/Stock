var t=Object.defineProperty,e=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(e,a,s)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,n=(t,n)=>{for(var o in n||(n={}))a.call(n,o)&&l(t,o,n[o]);if(e)for(var o of e(n))s.call(n,o)&&l(t,o,n[o]);return t},o=(t,e,a)=>new Promise(((s,l)=>{var n=t=>{try{c(a.next(t))}catch(e){l(e)}},o=t=>{try{c(a.throw(t))}catch(e){l(e)}},c=t=>t.done?s(t.value):Promise.resolve(t.value).then(n,o);c((a=a.apply(t,e)).next())}));import{r as c,u as r,b as i,c as d,o as u,e as _,f as p,g as v,j as f,i as b,A as y,t as m,B as h,w as x,z as g,C as k,q as w,F as D,D as C,h as z,a as $,T as S}from"./vendor-BeeV2Y_X.js";import{_ as q,S as I}from"./index-CkM21um_.js";function L(t=""){const e=c(t),a=c(t),s=t=>t instanceof Date&&!isNaN(t)?t.toISOString().split("T")[0]:"",l=t=>t instanceof Date&&!isNaN(t);return{displayValue:a,handleInput:t=>{const s=t.target.value;return e.value=s,a.value=s,s},handleBlur:()=>{if(!e.value)return{isValid:!0,value:""};const t=e.value.trim();if(/^[a-zA-Z]+$/.test(t)){const e=new Date;switch(t.toLowerCase()){case"t":case"today":return a.value=s(e),{isValid:!0,value:a.value};case"y":case"yday":return e.setDate(e.getDate()-1),a.value=s(e),{isValid:!0,value:a.value};case"tm":case"tmr":return e.setDate(e.getDate()+1),a.value=s(e),{isValid:!0,value:a.value}}}if(/^[+-]\d+$/.test(t)){const e=parseInt(t),l=new Date;return l.setDate(l.getDate()+e),a.value=s(l),{isValid:!0,value:a.value}}if(/^\d{3,4}$/.test(t)){const e=(new Date).getFullYear();let n,o;if(3===t.length?(n=parseInt(t[0]),o=parseInt(t.slice(1))):(n=parseInt(t.slice(0,2)),o=parseInt(t.slice(2))),n>=1&&n<=12&&o>=1&&o<=31){const t=new Date(e,n-1,o);if(l(t))return a.value=s(t),{isValid:!0,value:a.value}}}const n=["-",".","/"];for(const e of n)if(t.includes(e)){const[n,o]=t.split(e).map(Number),c=(new Date).getFullYear();if(n>=1&&n<=12&&o>=1&&o<=31){const t=new Date(c,n-1,o);if(l(t))return a.value=s(t),{isValid:!0,value:a.value}}}const o=new Date(t);return l(o)?(a.value=s(o),{isValid:!0,value:a.value}):{isValid:!1,value:e.value}},setToday:()=>{const t=(new Date).toISOString().split("T")[0];return e.value=t,a.value=t,t}}}const N={class:"card"},j={class:"card-header d-flex justify-content-between align-items-center"},O={class:"btn-group"},V=["disabled"],Y={class:"card-body border-bottom"},F={class:"col-auto"},E=["value"],M={class:"col-auto"},T=["value"],A={class:"col-auto"},H={class:"col-auto",style:{"min-width":"200px","max-width":"300px"}},K={class:"col-auto d-flex align-items-end",style:{"min-width":"80px"}},P=["disabled"],B={class:"card-body p-0"},U={class:"table-responsive"},Z={class:"table table-hover table-sm mb-0"},W={class:"market-row"},G=["onClick"],J={class:"text-end"},Q={class:"text-end"},R={class:"text-end text-danger"},X={class:"text-end text-success"},tt={class:"text-end"},et={key:0,class:"holding-stats-row"},at={class:"text-end"},st={class:"text-end text-danger"},lt={class:"text-end text-success"},nt={class:"text-end"},ot={key:1,class:"closed-stats-row"},ct={class:"text-end"},rt={class:"text-end text-danger"},it={class:"text-end text-success"},dt={class:"text-end"},ut={class:"holding-group-row"},_t=["onClick"],pt={class:"stock-row"},vt=["onClick"],ft={class:"company-name",style:{display:"inline-block","font-size":"14px",color:"#6c757d","margin-left":"4px"}},bt={class:"text-end"},yt={class:"text-end"},mt={class:"text-end text-danger"},ht={class:"text-end"},xt={class:"text-end text-success"},gt={class:"text-end"},kt={class:"text-end"},wt={key:0},Dt={colspan:"13",class:"p-0"},Ct={class:"transaction-details"},zt={class:"table table-sm mb-0"},$t={class:"transaction-info"},St={class:"transaction-code"},qt={class:"quantity-price"},It={class:"text-end amount"},Lt={class:"text-end cost"},Nt={class:"text-end amount"},jt={class:"text-end fees"},Ot={class:"text-end"},Vt={key:1},Yt={class:"closed-group-row"},Ft=["onClick"],Et={class:"stock-row"},Mt=["onClick"],Tt={class:"company-name",style:{display:"inline-block","font-size":"14px",color:"#6c757d","margin-left":"4px"}},At={class:"text-end"},Ht={class:"text-end"},Kt={class:"text-end text-danger"},Pt={class:"text-end text-success"},Bt={class:"text-end"},Ut={class:"text-end"},Zt={key:0},Wt={colspan:"13",class:"p-0"},Gt={class:"transaction-details"},Jt={class:"table table-sm mb-0"},Qt={class:"transaction-info"},Rt={class:"transaction-code"},Xt={class:"quantity-price"},te={class:"text-end amount"},ee={class:"text-end cost"},ae={class:"text-end amount"},se={class:"text-end fees"},le={class:"text-end"},ne={key:1},oe=q({__name:"ProfitStats",setup(t){const e=r(),a=c(!1),s=c(!1),l=c(!0),q=c(new Set),oe=c(new Set),ce=c(new Set),re=c(new Set),ie=c({}),de=c({}),ue=c({}),_e=c([]),pe=i({startDate:"",endDate:"",market:"",stockCodes:[]}),ve=c(null),fe=c(null),be=c(null),ye=(t,e)=>{var a,s;switch(t.preventDefault(),e){case"endDate":null==(a=fe.value)||a.focus();break;case"market":null==(s=be.value)||s.focus();break;case"search":Oe()}},me={calculateMarketStats:(t,e=[])=>{const a={};return Object.entries(t).forEach((([t,s])=>{const[l]=t.split("-"),n=t.split("-")[1];e.length>0&&!e.includes(n)||(a[l]||(a[l]={total_stocks:0,transaction_count:0,total_buy:0,total_sell:0,total_fees:0,realized_profit:0,market_value:0,holding_profit:0,total_profit:0,profit_rate:0,holding_stats:{count:0,total_buy:0,total_sell:0,total_fees:0,realized_profit:0,market_value:0,holding_profit:0,total_profit:0,profit_rate:0},closed_stats:{count:0,total_buy:0,total_sell:0,total_fees:0,realized_profit:0,profit_rate:0}}),a[l].transaction_count+=s.transaction_count||0,a[l].total_buy+=s.total_buy||0,a[l].total_sell+=s.total_sell||0,a[l].total_fees+=s.total_fees||0,a[l].realized_profit+=s.realized_profit||0,a[l].market_value+=s.market_value||0,a[l].holding_profit+=s.holding_profit||0,s.current_quantity>0?(a[l].total_stocks+=1,a[l].holding_stats.count++,a[l].holding_stats.total_buy+=s.total_buy||0,a[l].holding_stats.total_sell+=s.total_sell||0,a[l].holding_stats.total_fees+=s.total_fees||0,a[l].holding_stats.realized_profit+=s.realized_profit||0,a[l].holding_stats.market_value+=s.market_value||0,a[l].holding_stats.holding_profit+=s.holding_profit||0):(a[l].total_stocks+=1,a[l].closed_stats.count++,a[l].closed_stats.total_buy+=s.total_buy||0,a[l].closed_stats.total_sell+=s.total_sell||0,a[l].closed_stats.total_fees+=s.total_fees||0,a[l].closed_stats.realized_profit+=s.realized_profit||0))})),Object.values(a).forEach((t=>{t.holding_stats.total_profit=(t.holding_stats.realized_profit||0)+(t.holding_stats.holding_profit||0),t.holding_stats.profit_rate=t.holding_stats.total_buy>0?(t.holding_stats.total_profit||0)/t.holding_stats.total_buy*100:0,t.closed_stats.profit_rate=t.closed_stats.total_buy>0?(t.closed_stats.realized_profit||0)/t.closed_stats.total_buy*100:0,t.total_profit=(t.realized_profit||0)+(t.holding_profit||0),t.profit_rate=t.total_buy>0?t.total_profit/t.total_buy*100:0})),a},getHoldingStocks:(t,e,a=[])=>Object.entries(t).filter((([t,s])=>{const[l]=t.split("-"),n=t.split("-")[1];return a.length>0?l===e&&s.current_quantity>0&&a.includes(n):l===e&&s.current_quantity>0})).map((([t,e])=>n({code:t.split("-")[1]},e))).sort(((t,e)=>{const a=new Date(t.last_transaction_date||0);return new Date(e.last_transaction_date||0)-a})),getClosedStocks:(t,e,a=[])=>Object.entries(t).filter((([t,s])=>{const[l]=t.split("-"),n=t.split("-")[1];return a.length>0?l===e&&s.current_quantity<=0&&a.includes(n):l===e&&s.current_quantity<=0})).map((([t,e])=>n({code:t.split("-")[1]},e))).sort(((t,e)=>{const a=new Date(t.last_transaction_date||0);return new Date(e.last_transaction_date||0)-a}))},he=d((()=>me.calculateMarketStats(de.value,pe.stockCodes||[]))),xe=t=>me.getHoldingStocks(de.value,t,pe.stockCodes||[]),ge=t=>me.getClosedStocks(de.value,t,pe.stockCodes||[]),ke=d((()=>Object.keys(he.value).sort())),we=(t,e=2)=>null==t?"-":Number(t).toLocaleString("zh-HK",{minimumFractionDigits:e,maximumFractionDigits:e}),De=t=>null==t?"-":t.toFixed(2)+"%",Ce=t=>t?new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"):"-",ze=t=>t?t>0?"text-success":t<0?"text-danger":"":"",$e=t=>q.value.has(t),Se=t=>oe.value.has(t),qe=t=>ce.value.has(t),Ie=(t,e)=>{const a=`${t}-${e}`;return re.value.has(a)},Le=(t,e)=>{const a=`${t}-${e}`;re.value.has(a)?re.value.delete(a):re.value.add(a)},Ne=()=>{l.value=!l.value},je=t=>{const e=new S(Object.assign(document.createElement("div"),{className:"toast position-fixed top-0 end-0 m-3",innerHTML:`\n        <div class="toast-header">\n          <strong class="me-auto">提示</strong>\n          <button type="button" class="btn-close" data-bs-dismiss="toast"></button>\n        </div>\n        <div class="toast-body">${t}</div>\n      `}));document.body.appendChild(e._element),e.show(),setTimeout((()=>{e._element.remove()}),3e3)},Oe=()=>o(this,null,(function*(){var t;a.value=!0;try{const e={};pe.startDate&&(e.start_date=pe.startDate),pe.endDate&&(e.end_date=pe.endDate),pe.market&&(e.market=pe.market),(null==(t=pe.stockCodes)?void 0:t.length)>0&&(e.stock_codes=pe.stockCodes);const a=yield $.get("/api/profit/",{params:e});a.data.success&&(de.value=a.data.data.stock_stats||{},ue.value=a.data.data.transaction_details||{},q.value.clear(),oe.value.clear(),ce.value.clear(),re.value.clear(),Object.keys(he.value).forEach((t=>{q.value.add(t),oe.value.add(t)})))}catch(e){je("查询失败，请稍后重试")}finally{a.value=!1}})),Ve=()=>{pe.startDate="",pe.endDate="",pe.market="",pe.stockCodes=[],Oe()},Ye=()=>o(this,null,(function*(){if(!s.value){s.value=!0;try{const t=yield $.post("/api/profit/refresh_prices");if(t.data.success){const{items:e,success_count:a,failed_count:s}=t.data.data;e.forEach((t=>{const e=`${t.market}-${t.code}`;de.value[e]&&(de.value[e].current_price=t.current_price,de.value[e].market_value=t.market_value,de.value[e].holding_profit=t.holding_profit,de.value[e].total_profit=t.total_profit,de.value[e].profit_rate=t.profit_rate)})),ie.value=me.calculateMarketStats(de.value,pe.stockCodes||[]),je(`市值更新完成：${a} 个成功，${s} 个失败`)}}catch(t){je("刷新市值失败，请稍后重试")}finally{s.value=!1}}})),Fe=()=>{e.push("/transactions/add")};L();const Ee=c(""),Me=c(""),Te=t=>{const e=t.target.value;Ee.value=e,pe.startDate=e},Ae=()=>{if(!Ee.value)return void(pe.startDate="");const t=Ee.value.trim();let e=null;if(/^[a-zA-Z]+$/.test(t)){const a=new Date;switch(t.toLowerCase()){case"t":case"today":e=Ce(a);break;case"y":case"yday":a.setDate(a.getDate()-1),e=Ce(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),e=Ce(a)}}if(/^[+-]\d+$/.test(t)){const a=parseInt(t),s=new Date;s.setDate(s.getDate()+a),e=Ce(s)}if(/^\d{3,4}$/.test(t)){const a=(new Date).getFullYear();let s,l;if(3===t.length?(s=parseInt(t[0]),l=parseInt(t.slice(1))):(s=parseInt(t.slice(0,2)),l=parseInt(t.slice(2))),s>=1&&s<=12&&l>=1&&l<=31){const t=new Date(a,s-1,l);Pe(t)&&(e=Ce(t))}}const a=["-",".","/"];for(const s of a)if(t.includes(s)){const[a,l]=t.split(s).map(Number),n=(new Date).getFullYear();if(a>=1&&a<=12&&l>=1&&l<=31){const t=new Date(n,a-1,l);if(Pe(t)){e=Ce(t);break}}}if(!e){const a=new Date(t);Pe(a)&&(e=Ce(a))}e&&(Ee.value=e,pe.startDate=e,pe.endDate&&e>pe.endDate&&(pe.endDate=e,Me.value=e))},He=t=>{const e=t.target.value;Me.value=e,pe.endDate=e},Ke=()=>{if(!Me.value)return void(pe.endDate="");const t=Me.value.trim();let e=null;if(/^[a-zA-Z]+$/.test(t)){const a=new Date;switch(t.toLowerCase()){case"t":case"today":e=Ce(a);break;case"y":case"yday":a.setDate(a.getDate()-1),e=Ce(a);break;case"tm":case"tmr":a.setDate(a.getDate()+1),e=Ce(a)}}if(/^[+-]\d+$/.test(t)){const a=parseInt(t),s=new Date;s.setDate(s.getDate()+a),e=Ce(s)}if(/^\d{3,4}$/.test(t)){const a=(new Date).getFullYear();let s,l;if(3===t.length?(s=parseInt(t[0]),l=parseInt(t.slice(1))):(s=parseInt(t.slice(0,2)),l=parseInt(t.slice(2))),s>=1&&s<=12&&l>=1&&l<=31){const t=new Date(a,s-1,l);Pe(t)&&(e=Ce(t))}}const a=["-",".","/"];for(const s of a)if(t.includes(s)){const[a,l]=t.split(s).map(Number),n=(new Date).getFullYear();if(a>=1&&a<=12&&l>=1&&l<=31){const t=new Date(n,a-1,l);if(Pe(t)){e=Ce(t);break}}}if(!e){const a=new Date(t);Pe(a)&&(e=Ce(a))}e&&(Me.value=e,pe.endDate=e,pe.startDate&&e<pe.startDate&&(pe.startDate=e,Ee.value=e))},Pe=t=>t instanceof Date&&!isNaN(t),Be=t=>{if("sell"!==t.transaction_type.toLowerCase())return 0;const e=Number(t.total_amount),a=Number(t.total_quantity)*Number(t.prev_avg_cost),s=Number(t.total_fees);return Number((e-a-s).toFixed(2))},Ue=t=>{if("sell"!==t.transaction_type.toLowerCase())return 0;const e=Be(t),a=Number(t.total_quantity)*Number(t.prev_avg_cost);return a>0?Number((e/a*100).toFixed(2)):0},Ze=()=>o(this,null,(function*(){try{const t=yield $.get("/api/stock/stocks");t.data.success&&(_e.value=t.data.data.items)}catch(t){}})),We=t=>t?[...t].sort(((t,e)=>{const a=new Date(t.transaction_date).getTime(),s=new Date(e.transaction_date).getTime();return a!==s?s-a:e.id-t.id})):[];return u((()=>{Ze(),Oe()})),(t,e)=>(p(),_("div",N,[v("div",j,[e[10]||(e[10]=v("h4",{class:"mb-0"},"盈利统计",-1)),v("div",O,[v("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:Ne},[v("i",{class:y(["bi",l.value?"bi-chevron-up":"bi-search"])},null,2),b(" "+m(l.value?"收起":"搜索"),1)]),v("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:Ye,disabled:s.value},[v("i",{class:y(["bi",s.value?"bi-arrow-clockwise bi-spin":"bi-arrow-clockwise"])},null,2),e[8]||(e[8]=b(" 刷新市值 "))],8,V),v("button",{type:"button",class:"btn btn-sm btn-primary",onClick:Fe},e[9]||(e[9]=[v("i",{class:"bi bi-plus-lg"},null,-1),b(" 添加记录 ")]))])]),f(v("div",Y,[v("form",{onSubmit:x(Oe,["prevent"]),class:"row g-2 align-items-end"},[v("div",F,[e[11]||(e[11]=v("label",{class:"form-label small"},"开始日期",-1)),v("input",{type:"text",class:"form-control form-control-sm",style:{width:"130px"},value:Ee.value,onInput:Te,onBlur:Ae,onKeydown:[e[0]||(e[0]=g(x((t=>ye(t,"endDate")),["prevent"]),["enter"])),e[1]||(e[1]=g((t=>ye(t,"endDate")),["tab"]))],placeholder:"YYYY-MM-DD",ref_key:"startDate",ref:ve},null,40,E)]),v("div",M,[e[12]||(e[12]=v("label",{class:"form-label small"},"结束日期",-1)),v("input",{type:"text",class:"form-control form-control-sm",style:{width:"130px"},value:Me.value,onInput:He,onBlur:Ke,onKeydown:[e[2]||(e[2]=g(x((t=>ye(t,"market")),["prevent"]),["enter"])),e[3]||(e[3]=g((t=>ye(t,"market")),["tab"]))],placeholder:"YYYY-MM-DD",ref_key:"endDate",ref:fe},null,40,T)]),v("div",A,[e[14]||(e[14]=v("label",{class:"form-label small"},"市场",-1)),f(v("select",{class:"form-select form-select-sm",style:{width:"100px"},"onUpdate:modelValue":e[4]||(e[4]=t=>pe.market=t),ref_key:"market",ref:be,onKeydown:[e[5]||(e[5]=g(x((t=>ye(t,"search")),["prevent"]),["enter"])),e[6]||(e[6]=g((t=>ye(t,"search")),["tab"]))]},e[13]||(e[13]=[v("option",{value:""},"全部",-1),v("option",{value:"HK"},"HK",-1),v("option",{value:"USA"},"USA",-1)]),544),[[k,pe.market]])]),v("div",H,[e[15]||(e[15]=v("label",{class:"form-label small"},"股票代码",-1)),w(I,{modelValue:pe.stockCodes,"onUpdate:modelValue":e[7]||(e[7]=t=>pe.stockCodes=t),stocks:_e.value,market:pe.market,class:"stock-selector-sm"},null,8,["modelValue","stocks","market"])]),e[18]||(e[18]=v("div",{class:"col-auto flex-grow-1",style:{"max-width":"50px"}},null,-1)),v("div",K,[v("button",{type:"submit",class:"btn btn-sm btn-primary w-100 border border-primary text-white",style:{"background-color":"#0D6EFD"},disabled:a.value,ref:"searchBtn"},e[16]||(e[16]=[v("i",{class:"bi bi-search me-1"},null,-1),b("查询 ")]),8,P)]),v("div",{class:"col-auto d-flex align-items-end",style:{"min-width":"80px"}},[v("button",{type:"button",class:"btn btn-sm btn-outline-secondary w-100",onClick:Ve},e[17]||(e[17]=[v("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),b("重置 ")]))])],32)],512),[[h,l.value]]),v("div",B,[v("div",U,[v("table",Z,[e[44]||(e[44]=v("thead",{class:"table-light"},[v("tr",null,[v("th"),v("th",null,"市场"),v("th",{class:"text-end"},"股票数量"),v("th",{class:"text-end"},"笔数"),v("th",{class:"text-end"},"买入总额"),v("th",{class:"text-end",title:"移动加权平均价"},"平均价格"),v("th",{class:"text-end"},"卖出总额"),v("th",{class:"text-end"},"费用"),v("th",{class:"text-end"},"已实现盈亏"),v("th",{class:"text-end"},"现价"),v("th",{class:"text-end"},"持仓盈亏"),v("th",{class:"text-end"},"总盈亏"),v("th",{class:"text-end"},"盈亏率")])],-1)),v("tbody",null,[(p(!0),_(D,null,C(ke.value,(t=>(p(),_(D,{key:t},[v("tr",W,[v("td",null,[v("button",{onClick:e=>(t=>{q.value.has(t)?(q.value.delete(t),oe.value.delete(t),ce.value.delete(t),Object.keys(de.value).filter((e=>e.startsWith(t))).forEach((t=>{re.value.delete(t)}))):(q.value.add(t),oe.value.add(t))})(t),class:"btn btn-sm btn-outline-primary"},[v("i",{class:y(["bi bi-chevron-right",{"rotate-90":$e(t)}])},null,2)],8,G)]),v("td",null,m(t),1),v("td",J,m(we(he.value[t].total_stocks,0)),1),v("td",Q,m(he.value[t].transaction_count),1),v("td",R,m(we(he.value[t].total_buy)),1),e[19]||(e[19]=v("td",{class:"text-end"},"-",-1)),v("td",X,m(we(he.value[t].total_sell)),1),v("td",tt,m(we(he.value[t].total_fees)),1),v("td",{class:y(["text-end",ze(he.value[t].realized_profit)])},m(we(he.value[t].realized_profit)),3),e[20]||(e[20]=v("td",{class:"text-end"},"-",-1)),v("td",{class:y(["text-end",ze(he.value[t].holding_profit)])},m(we(he.value[t].holding_profit)),3),v("td",{class:y(["text-end",ze(he.value[t].total_profit)])},m(we(he.value[t].total_profit)),3),v("td",{class:y(["text-end",ze(he.value[t].profit_rate)])},m(De(he.value[t].profit_rate)),3)]),$e(t)?(p(),_("tr",et,[e[21]||(e[21]=v("td",null,null,-1)),e[22]||(e[22]=v("td",null,[v("strong",null,"持仓统计")],-1)),v("td",at,m(he.value[t].holding_stats.count),1),e[23]||(e[23]=v("td",{class:"text-end"},"-",-1)),v("td",st,m(we(he.value[t].holding_stats.total_buy)),1),e[24]||(e[24]=v("td",{class:"text-end"},"-",-1)),v("td",lt,m(we(he.value[t].holding_stats.total_sell)),1),v("td",nt,m(we(he.value[t].holding_stats.total_fees)),1),v("td",{class:y(["text-end",ze(he.value[t].holding_stats.realized_profit)])},m(we(he.value[t].holding_stats.realized_profit)),3),e[25]||(e[25]=v("td",{class:"text-end"},"-",-1)),v("td",{class:y(["text-end",ze(he.value[t].holding_stats.holding_profit)])},m(we(he.value[t].holding_stats.holding_profit)),3),v("td",{class:y(["text-end",ze(he.value[t].holding_stats.total_profit)])},m(we(he.value[t].holding_stats.total_profit)),3),v("td",{class:y(["text-end",ze(he.value[t].holding_stats.profit_rate)])},m(De(he.value[t].holding_stats.profit_rate)),3)])):z("",!0),$e(t)?(p(),_("tr",ot,[e[26]||(e[26]=v("td",null,null,-1)),e[27]||(e[27]=v("td",null,[v("strong",null,"已清仓统计")],-1)),v("td",ct,m(he.value[t].closed_stats.count),1),e[28]||(e[28]=v("td",{class:"text-end"},"-",-1)),v("td",rt,m(we(he.value[t].closed_stats.total_buy)),1),e[29]||(e[29]=v("td",{class:"text-end"},"-",-1)),v("td",it,m(we(he.value[t].closed_stats.total_sell)),1),v("td",dt,m(we(he.value[t].closed_stats.total_fees)),1),v("td",{class:y(["text-end",ze(he.value[t].closed_stats.realized_profit)])},m(we(he.value[t].closed_stats.realized_profit)),3),e[30]||(e[30]=v("td",{class:"text-end"},"-",-1)),e[31]||(e[31]=v("td",{class:"text-end"},"-",-1)),e[32]||(e[32]=v("td",{class:"text-end"},"-",-1)),v("td",{class:y(["text-end",ze(he.value[t].closed_stats.profit_rate)])},m(De(he.value[t].closed_stats.profit_rate)),3)])):z("",!0),$e(t)?(p(),_(D,{key:2},[v("tr",ut,[v("td",null,[v("button",{onClick:e=>(t=>{oe.value.has(t)?oe.value.delete(t):oe.value.add(t)})(t),class:"btn btn-sm btn-outline-secondary"},[v("i",{class:y(["bi bi-chevron-right",{"rotate-90":Se(t)}])},null,2)],8,_t)]),e[33]||(e[33]=v("td",{colspan:"12"},[v("strong",null,"持仓股票")],-1))]),Se(t)?(p(!0),_(D,{key:0},C(xe(t),(a=>(p(),_(D,{key:a.code},[v("tr",pt,[v("td",null,[v("button",{onClick:e=>Le(t,a.code),class:"btn btn-sm btn-outline-secondary"},[v("i",{class:y(["bi bi-chevron-right",{"rotate-90":Ie(t,a.code)}])},null,2)],8,vt)]),v("td",null,[b(m(a.code)+" ",1),v("span",ft,m(a.stock_name),1)]),v("td",bt,m(we(a.current_quantity,0)),1),v("td",yt,m(a.transaction_count),1),v("td",mt,m(we(a.total_buy)),1),v("td",ht,m(we(a.average_cost,3)),1),v("td",xt,m(we(a.total_sell)),1),v("td",gt,m(we(a.total_fees)),1),v("td",{class:y(["text-end",ze(a.realized_profit)])},m(we(a.realized_profit)),3),v("td",kt,m(a.current_quantity>0?we(a.current_price,3):"-"),1),v("td",{class:y(["text-end",ze(a.holding_profit)])},m(a.current_quantity>0?we(a.holding_profit):"-"),3),v("td",{class:y(["text-end",ze(a.total_profit)])},m(we(a.total_profit)),3),v("td",{class:y(["text-end",ze(a.profit_rate)])},m(De(a.profit_rate)),3)]),Ie(t,a.code)?(p(),_("tr",wt,[v("td",Dt,[v("div",Ct,[v("table",zt,[e[37]||(e[37]=v("thead",{class:"table-light"},[v("tr",null,[v("th",{class:"transaction-info"},"交易日期"),v("th",{class:"quantity-price"},"数量@单价"),v("th",{class:"text-end amount"},"买入金额"),v("th",{class:"text-end cost",title:"移动加权平均价"},"平均价格"),v("th",{class:"text-end amount"},"卖出金额"),v("th",{class:"text-end fees"},"费用"),v("th",{class:"text-end profit"},"盈亏"),v("th",{class:"text-end current-price"},"盈亏率"),v("th",{class:"text-end holding-value"},"持有人"),v("th",{class:"text-end total-profit"}),v("th",{class:"text-end profit-rate"})])],-1)),v("tbody",null,[ue.value[`${t}-${a.code}`]?(p(!0),_(D,{key:0},C(We(ue.value[`${t}-${a.code}`]),(t=>(p(),_("tr",{key:t.id},[v("td",$t,[b(m(Ce(t.transaction_date))+" ",1),v("span",{class:y(["transaction-type-badge","buy"===t.transaction_type.toLowerCase()?"buy":"sell"])},m("buy"===t.transaction_type.toLowerCase()?"买入":"卖出"),3),v("span",St,m(t.transaction_code.trim()),1)]),v("td",qt,m(we(t.total_quantity,0))+" @ "+m(we(t.total_amount/t.total_quantity,3)),1),v("td",It,m("buy"===t.transaction_type.toLowerCase()?we(t.total_amount):""),1),v("td",Lt,["buy"===t.transaction_type.toLowerCase()?(p(),_(D,{key:0},[b(m(we(t.current_avg_cost,3)),1)],64)):(p(),_(D,{key:1},[b(m(we(t.prev_avg_cost,3)),1)],64))]),v("td",Nt,m("sell"===t.transaction_type.toLowerCase()?we(t.total_amount):""),1),v("td",jt,m(we(t.total_fees)),1),v("td",{class:y(["text-end",ze(Be(t))])},m("sell"===t.transaction_type.toLowerCase()?we(Be(t)):"-"),3),v("td",{class:y(["text-end",ze(Ue(t))])},m("sell"===t.transaction_type.toLowerCase()?De(Ue(t)):"-"),3),v("td",Ot,m(t.holder_name||"-"),1),e[34]||(e[34]=v("td",{class:"text-end"},"-",-1)),e[35]||(e[35]=v("td",{class:"text-end"},"-",-1))])))),128)):(p(),_("tr",Vt,e[36]||(e[36]=[v("td",{colspan:"11",class:"text-center py-2"},[v("small",{class:"text-muted"},"暂无交易明细数据")],-1)])))])])])])])):z("",!0)],64)))),128)):z("",!0),v("tr",Yt,[v("td",null,[v("button",{onClick:e=>(t=>{ce.value.has(t)?ce.value.delete(t):ce.value.add(t)})(t),class:"btn btn-sm btn-outline-secondary"},[v("i",{class:y(["bi bi-chevron-right",{"rotate-90":qe(t)}])},null,2)],8,Ft)]),e[38]||(e[38]=v("td",{colspan:"12"},[v("strong",null,"已清仓股票")],-1))]),qe(t)?(p(!0),_(D,{key:1},C(ge(t),(a=>(p(),_(D,{key:a.code},[v("tr",Et,[v("td",null,[v("button",{onClick:e=>Le(t,a.code),class:"btn btn-sm btn-outline-secondary"},[v("i",{class:y(["bi bi-chevron-right",{"rotate-90":Ie(t,a.code)}])},null,2)],8,Mt)]),v("td",null,[b(m(a.code)+" ",1),v("span",Tt,m(a.stock_name),1)]),v("td",At,m(a.quantity||"-"),1),v("td",Ht,m(a.transaction_count),1),v("td",Kt,m(we(a.total_buy)),1),e[39]||(e[39]=v("td",{class:"text-end"},"-",-1)),v("td",Pt,m(we(a.total_sell)),1),v("td",Bt,m(we(a.total_fees)),1),v("td",{class:y(["text-end",ze(a.realized_profit)])},m(we(a.realized_profit)),3),v("td",Ut,m(a.current_quantity>0?we(a.current_price,3):"-"),1),v("td",{class:y(["text-end",ze(a.holding_profit)])},m(a.current_quantity>0?we(a.holding_profit):"-"),3),v("td",{class:y(["text-end",ze(a.total_profit)])},m(we(a.total_profit)),3),v("td",{class:y(["text-end",ze(a.profit_rate)])},m(De(a.profit_rate)),3)]),Ie(t,a.code)?(p(),_("tr",Zt,[v("td",Wt,[v("div",Gt,[v("table",Jt,[e[43]||(e[43]=v("thead",{class:"table-light"},[v("tr",null,[v("th",{class:"transaction-info"},"交易日期"),v("th",{class:"quantity-price"},"数量@单价"),v("th",{class:"text-end amount"},"买入金额"),v("th",{class:"text-end cost",title:"移动加权平均价"},"平均价格"),v("th",{class:"text-end amount"},"卖出金额"),v("th",{class:"text-end fees"},"费用"),v("th",{class:"text-end profit"},"盈亏"),v("th",{class:"text-end current-price"},"盈亏率"),v("th",{class:"text-end holding-value"},"持有人"),v("th",{class:"text-end total-profit"}),v("th",{class:"text-end profit-rate"})])],-1)),v("tbody",null,[ue.value[`${t}-${a.code}`]?(p(!0),_(D,{key:0},C(We(ue.value[`${t}-${a.code}`]),(t=>(p(),_("tr",{key:t.id},[v("td",Qt,[b(m(Ce(t.transaction_date))+" ",1),v("span",{class:y(["transaction-type-badge","buy"===t.transaction_type.toLowerCase()?"buy":"sell"])},m("buy"===t.transaction_type.toLowerCase()?"买入":"卖出"),3),v("span",Rt,m(t.transaction_code.trim()),1)]),v("td",Xt,m(we(t.total_quantity,0))+" @ "+m(we(t.total_amount/t.total_quantity,3)),1),v("td",te,m("buy"===t.transaction_type.toLowerCase()?we(t.total_amount):""),1),v("td",ee,["buy"===t.transaction_type.toLowerCase()?(p(),_(D,{key:0},[b(m(we(t.current_avg_cost,3)),1)],64)):(p(),_(D,{key:1},[b(m(we(t.prev_avg_cost,3)),1)],64))]),v("td",ae,m("sell"===t.transaction_type.toLowerCase()?we(t.total_amount):""),1),v("td",se,m(we(t.total_fees)),1),v("td",{class:y(["text-end",ze(Be(t))])},m("sell"===t.transaction_type.toLowerCase()?we(Be(t)):"-"),3),v("td",{class:y(["text-end",ze(Ue(t))])},m("sell"===t.transaction_type.toLowerCase()?De(Ue(t)):"-"),3),v("td",le,m(t.holder_name||"-"),1),e[40]||(e[40]=v("td",{class:"text-end"},"-",-1)),e[41]||(e[41]=v("td",{class:"text-end"},"-",-1))])))),128)):(p(),_("tr",ne,e[42]||(e[42]=[v("td",{colspan:"11",class:"text-center py-2"},[v("small",{class:"text-muted"},"暂无交易明细数据")],-1)])))])])])])])):z("",!0)],64)))),128)):z("",!0)],64)):z("",!0)],64)))),128))])])])])]))}},[["__scopeId","data-v-bbd6b550"]]);export{oe as default};
